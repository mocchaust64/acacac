{"ast":null,"code":"var _jsxFileName = \"/Users/tai/Documents/MoonWallet/moonwallet/frontend_test/src/components/TransferForm.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { web3 } from '@coral-xyz/anchor';\nimport { LAMPORTS_PER_SOL } from '@solana/web3.js';\nimport { programID, SECP256R1_PROGRAM_ID, verifySecp256r1Signature } from '../utils/transactionUtils';\nimport { getWebAuthnAssertion } from '../utils/webauthnUtils';\nimport { getGuardianPDA, getMultisigPDA } from '../utils/credentialUtils';\nimport { getWalletByCredentialId } from '../firebase/webAuthnService';\nimport { Buffer } from 'buffer';\nimport BN from 'bn.js';\n\n// Hằng số cho chuẩn hóa signature\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SECP256R1_ORDER = new BN('FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551', 16);\nconst SECP256R1_HALF_ORDER = SECP256R1_ORDER.shrn(1);\n\n/**\n * Chuẩn hóa chữ ký về dạng Low-S\n * @param signature - Chữ ký raw\n * @returns Chữ ký đã chuẩn hóa\n */\nfunction normalizeSignatureToLowS(signature) {\n  const r = signature.slice(0, 32);\n  const s = signature.slice(32, 64);\n  const sBN = new BN(s);\n\n  // Kiểm tra nếu s > half_order\n  if (sBN.gt(SECP256R1_HALF_ORDER)) {\n    console.log(\"Chuẩn hóa signature về dạng Low-S\");\n    // Tính s' = order - s\n    const sNormalized = SECP256R1_ORDER.sub(sBN);\n    const sNormalizedBuffer = sNormalized.toArrayLike(Buffer, 'be', 32);\n    return Buffer.concat([r, sNormalizedBuffer]);\n  }\n  console.log(\"Signature đã ở dạng Low-S\");\n  return signature;\n}\n\n// Hàm chuyển đổi chữ ký DER sang raw (r, s) format\nconst convertDERtoRaw = derSignature => {\n  // Đảm bảo đây là DER signature\n  if (derSignature[0] !== 0x30) {\n    console.error('Chữ ký không phải định dạng DER');\n    return new Uint8Array(64); // Trả về buffer rỗng nếu không đúng định dạng\n  }\n\n  // Parse DER format\n  // Format: 0x30 [total-length] 0x02 [r-length] [r] 0x02 [s-length] [s]\n  const rLength = derSignature[3];\n  const rStart = 4;\n  const rEnd = rStart + rLength;\n  const sLength = derSignature[rEnd + 1];\n  const sStart = rEnd + 2;\n  const sEnd = sStart + sLength;\n\n  // Trích xuất r và s\n  let r = derSignature.slice(rStart, rEnd);\n  let s = derSignature.slice(sStart, sEnd);\n\n  // Cần đảm bảo r và s đúng 32 bytes\n  // - Nếu dài hơn 32 bytes, cắt bớt (thường r và s có thể có padding)\n  // - Nếu ngắn hơn 32 bytes, thêm padding 0 vào đầu\n  const rPadded = new Uint8Array(32);\n  const sPadded = new Uint8Array(32);\n  if (r.length <= 32) {\n    // Trường hợp r ngắn hơn 32 bytes, thêm padding\n    rPadded.set(r, 32 - r.length);\n  } else {\n    // Trường hợp r dài hơn 32 bytes, cắt bớt (thường là byte đầu tiên là 0)\n    rPadded.set(r.slice(r.length - 32));\n  }\n  if (s.length <= 32) {\n    // Trường hợp s ngắn hơn 32 bytes, thêm padding\n    sPadded.set(s, 32 - s.length);\n  } else {\n    // Trường hợp s dài hơn 32 bytes, cắt bớt (thường là byte đầu tiên là 0)\n    sPadded.set(s.slice(s.length - 32));\n  }\n\n  // Nối r và s lại\n  const rawSignature = new Uint8Array(64);\n  rawSignature.set(rPadded);\n  rawSignature.set(sPadded, 32);\n  console.log('Đã chuyển đổi signature từ DER sang raw format:');\n  console.log('- DER length:', derSignature.length);\n  console.log('- Raw length:', rawSignature.length);\n  return rawSignature;\n};\n\n// Enum cho các trạng thái xác minh\nvar VerificationStatus = /*#__PURE__*/function (VerificationStatus) {\n  VerificationStatus[\"IDLE\"] = \"idle\";\n  VerificationStatus[\"PREPARING\"] = \"preparing\";\n  VerificationStatus[\"SIGNING\"] = \"signing\";\n  VerificationStatus[\"VERIFYING\"] = \"verifying\";\n  VerificationStatus[\"SUCCESS\"] = \"success\";\n  VerificationStatus[\"ERROR\"] = \"error\";\n  return VerificationStatus;\n}(VerificationStatus || {}); // Interface cho props của component\nexport const TransferForm = ({\n  walletAddress,\n  credentialId,\n  guardianId,\n  connection,\n  pdaBalance = 0\n}) => {\n  _s();\n  // State\n  const [message, setMessage] = useState(\"\");\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n  const [status, setStatus] = useState(VerificationStatus.IDLE);\n  const [isMoonWalletAvailable, setIsMoonWalletAvailable] = useState(false);\n  const [connectionEndpoint, setConnectionEndpoint] = useState('');\n  const [signatureResult, setSignatureResult] = useState('');\n\n  // State mới cho các tùy chọn xác minh\n  const [messageData, setMessageData] = useState({\n    messageBytes: new Uint8Array(),\n    messageHash: new Uint8Array(),\n    webAuthnPubKey: null,\n    signature: null,\n    feePayer: null\n  });\n  const [shouldUseHashedMessage, setShouldUseHashedMessage] = useState(false);\n  const [shouldFlipPublicKey, setShouldFlipPublicKey] = useState(false);\n\n  // Kiểm tra chương trình\n  useEffect(() => {\n    const checkPrograms = async () => {\n      try {\n        // Lấy endpoint của connection để hiển thị\n        const endpoint = connection.rpcEndpoint;\n        setConnectionEndpoint(endpoint);\n        console.log(\"Đang kết nối đến:\", endpoint);\n\n        // Kiểm tra chương trình MoonWallet\n        try {\n          const moonWalletInfo = await connection.getAccountInfo(programID);\n          setIsMoonWalletAvailable(moonWalletInfo !== null);\n          if (moonWalletInfo === null) {\n            console.warn(\"Chương trình MoonWallet không tồn tại trên validator này!\");\n          } else {\n            console.log(\"Đã tìm thấy chương trình MoonWallet:\", programID.toString());\n          }\n        } catch (error) {\n          console.error(\"Lỗi khi kiểm tra chương trình MoonWallet:\", error);\n          setIsMoonWalletAvailable(false);\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi kiểm tra chương trình:\", error);\n      }\n    };\n    checkPrograms();\n  }, [connection]);\n\n  // Xử lý khi nhập message\n  const handleMessageChange = e => {\n    setMessage(e.target.value);\n    setError('');\n    setSuccess('');\n    setStatus(VerificationStatus.IDLE);\n    setSignatureResult('');\n  };\n\n  // Xử lý khi đổi tùy chọn\n  const handleHashedMessageChange = e => {\n    setShouldUseHashedMessage(e.target.checked);\n  };\n  const handleFlipPublicKeyChange = e => {\n    setShouldFlipPublicKey(e.target.checked);\n  };\n\n  // Xử lý khi submit form\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setIsProcessing(true);\n    setError('');\n    setSuccess('');\n    setSignatureResult('');\n    setStatus(VerificationStatus.PREPARING);\n    try {\n      // Kiểm tra đầu vào\n      if (!message) {\n        throw new Error('Vui lòng nhập tin nhắn cần ký');\n      }\n\n      // Chuyển message thành bytes\n      const messageBytes = new TextEncoder().encode(message);\n      console.log('Message bytes (UTF-8):', Array.from(messageBytes));\n      console.log('Message bytes (hex):', Array.from(messageBytes).map(b => b.toString(16).padStart(2, '0')).join(''));\n\n      // Tính hash của message\n      const messageHash = new Uint8Array(await crypto.subtle.digest('SHA-256', messageBytes));\n      console.log('Message hash (SHA-256):', Array.from(messageHash).map(b => b.toString(16).padStart(2, '0')).join(''));\n\n      // Lấy PDA từ credential ID\n      const multisigPDA = await getMultisigPDA(credentialId);\n      console.log('MultisigPDA:', multisigPDA.toBase58());\n\n      // Lấy PDA của guardian\n      const guardianPDA = await getGuardianPDA(multisigPDA, guardianId);\n      console.log('GuardianPDA:', guardianPDA.toBase58());\n\n      // Ký message bằng WebAuthn\n      setStatus(VerificationStatus.SIGNING);\n\n      // Hiển thị thông báo\n      console.log('Đang yêu cầu xác thực WebAuthn...');\n      setError(''); // Xóa thông báo lỗi trước đó\n      setSuccess('Đang hiển thị danh sách khóa WebAuthn, vui lòng chọn khóa để xác thực...');\n\n      // Sử dụng trực tiếp message gốc làm dữ liệu để ký với WebAuthn\n      // WebAuthn sẽ tự động hash dữ liệu này với SHA-256 trước khi ký\n      const assertion = await getWebAuthnAssertion(null, message, true);\n      if (!assertion) {\n        throw new Error('Lỗi khi ký message bằng WebAuthn hoặc người dùng đã hủy xác thực');\n      }\n      console.log('Đã ký thành công bằng WebAuthn');\n      console.log('ClientDataJSON:', new TextDecoder().decode(assertion.clientDataJSON));\n\n      // Phân tích clientDataJSON để hiểu cách WebAuthn hash message\n      try {\n        const clientDataObj = JSON.parse(new TextDecoder().decode(assertion.clientDataJSON));\n        console.log('ClientData object:', clientDataObj);\n      } catch (e) {\n        console.error('Lỗi khi phân tích clientDataJSON:', e);\n      }\n      setSuccess(''); // Xóa thông báo thành công tạm thời\n\n      // Lấy chữ ký từ WebAuthn assertion và chuyển đổi từ DER sang raw format\n      console.log('Signature từ WebAuthn (DER format):', Buffer.from(assertion.signature).toString('hex'));\n      console.log('Độ dài signature ban đầu:', assertion.signature.byteLength);\n\n      // Chuyển đổi signature từ DER sang raw format (r, s)\n      const rawSignature = convertDERtoRaw(assertion.signature);\n      const signature = Buffer.from(rawSignature);\n      console.log('Signature sau khi chuyển đổi (raw format):', signature.toString('hex'));\n      console.log('Độ dài signature sau khi chuyển đổi:', signature.length);\n\n      // Thêm bước chuẩn hóa signature về dạng Low-S\n      const normalizedSignature = normalizeSignatureToLowS(signature);\n      console.log(\"Signature sau khi chuẩn hóa (Low-S format):\", normalizedSignature.toString(\"hex\"));\n\n      // LẤY WEBAUTHN PUBLIC KEY TỪ FIREBASE\n      console.log('Lấy WebAuthn public key từ Firebase...');\n      const credentialMapping = await getWalletByCredentialId(credentialId);\n      if (!credentialMapping || !credentialMapping.guardianPublicKey || credentialMapping.guardianPublicKey.length === 0) {\n        throw new Error('Không tìm thấy public key cho credential ID này');\n      }\n\n      // Sử dụng WebAuthn public key từ Firebase\n      console.log('Đã tìm thấy WebAuthn public key trong Firebase:', credentialMapping.guardianPublicKey);\n      // Chuyển đổi từ mảng số về Buffer\n      const webAuthnPubKey = Buffer.from(new Uint8Array(credentialMapping.guardianPublicKey));\n\n      // Kiểm tra độ dài khóa\n      if (webAuthnPubKey.length !== 33) {\n        console.warn(`WebAuthn public key từ Firebase có độ dài không đúng: ${webAuthnPubKey.length} bytes, cần 33 bytes`);\n      }\n\n      // Xác minh chữ ký\n      setStatus(VerificationStatus.VERIFYING);\n\n      // Tạo ví tạm để trả phí giao dịch\n      const feePayer = web3.Keypair.generate();\n\n      // Xin SOL airdrop để trả phí\n      try {\n        const airdropSignature = await connection.requestAirdrop(feePayer.publicKey, web3.LAMPORTS_PER_SOL / 50 // 0.02 SOL để trả phí\n        );\n        await connection.confirmTransaction(airdropSignature);\n\n        // Kiểm tra số dư sau khi airdrop\n        const feePayerBalance = await connection.getBalance(feePayer.publicKey);\n        console.log(`Fee payer balance: ${feePayerBalance / LAMPORTS_PER_SOL} SOL`);\n        if (feePayerBalance === 0) {\n          throw new Error('Không thể airdrop SOL cho fee payer');\n        }\n      } catch (airdropError) {\n        console.warn('Không thể airdrop SOL để trả phí:', airdropError);\n        // Tiếp tục thực hiện vì có thể account đã có sẵn SOL\n      }\n\n      // Lưu lại dữ liệu để có thể dùng lại khi thay đổi tùy chọn\n      setMessageData({\n        messageBytes,\n        messageHash,\n        webAuthnPubKey,\n        signature: normalizedSignature,\n        feePayer\n      });\n\n      // Sử dụng hàm verifySecp256r1Signature để kiểm tra chữ ký\n      try {\n        // Chọn message gốc hoặc đã hash dựa vào tùy chọn\n        const messageToUse = shouldUseHashedMessage ? Buffer.from(messageHash) : Buffer.from(messageBytes);\n        const txid = await verifySecp256r1Signature(connection, messageToUse, webAuthnPubKey, normalizedSignature, feePayer, shouldFlipPublicKey);\n        setStatus(VerificationStatus.SUCCESS);\n        setSuccess('Xác minh chữ ký thành công!');\n        setSignatureResult(txid);\n        console.log('Kết quả xác minh chữ ký:', txid);\n      } catch (verifyError) {\n        throw new Error(`Lỗi khi xác minh chữ ký: ${verifyError.message}`);\n      }\n    } catch (error) {\n      console.error('Lỗi khi xác minh chữ ký:', error);\n      setError(error.message || 'Đã xảy ra lỗi khi xác minh chữ ký');\n      setStatus(VerificationStatus.ERROR);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Hàm thử lại với các tùy chọn khác nhau\n  const handleRetry = async () => {\n    // Đảm bảo đã có dữ liệu cần thiết\n    if (!messageData.webAuthnPubKey || !messageData.signature || !messageData.feePayer) {\n      setError('Vui lòng ký tin nhắn trước khi thử lại');\n      return;\n    }\n    setIsProcessing(true);\n    setError('');\n    setSuccess('');\n    setSignatureResult('');\n    setStatus(VerificationStatus.VERIFYING);\n    try {\n      // Chọn message gốc hoặc đã hash dựa vào tùy chọn\n      const messageToUse = shouldUseHashedMessage ? Buffer.from(messageData.messageHash) : Buffer.from(messageData.messageBytes);\n      console.log(`Thử lại xác minh với ${shouldUseHashedMessage ? 'message đã hash' : 'message gốc'} và ${shouldFlipPublicKey ? 'đảo' : 'không đảo'} public key`);\n      const txid = await verifySecp256r1Signature(connection, messageToUse, messageData.webAuthnPubKey, messageData.signature, messageData.feePayer, shouldFlipPublicKey);\n      setStatus(VerificationStatus.SUCCESS);\n      setSuccess('Xác minh chữ ký thành công!');\n      setSignatureResult(txid);\n      console.log('Kết quả xác minh chữ ký:', txid);\n    } catch (verifyError) {\n      console.error('Lỗi khi xác minh chữ ký:', verifyError);\n      setError(`Lỗi khi xác minh chữ ký: ${verifyError.message}`);\n      setStatus(VerificationStatus.ERROR);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Render status message dựa trên status\n  const renderStatusMessage = () => {\n    switch (status) {\n      case VerificationStatus.PREPARING:\n        return 'Đang chuẩn bị xác minh chữ ký...';\n      case VerificationStatus.SIGNING:\n        return 'Vui lòng xác thực bằng WebAuthn (vân tay hoặc Face ID) khi được yêu cầu...';\n      case VerificationStatus.VERIFYING:\n        return 'Đang xác minh chữ ký trên blockchain...';\n      case VerificationStatus.SUCCESS:\n        return 'Xác minh chữ ký thành công!';\n      case VerificationStatus.ERROR:\n        return 'Xác minh chữ ký thất bại!';\n      default:\n        return '';\n    }\n  };\n\n  // Hiển thị ghi chú về validator cục bộ\n  const renderValidatorNote = () => {\n    if (connectionEndpoint.includes('localhost') || connectionEndpoint.includes('127.0.0.1')) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"info-note\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"L\\u01B0u \\xFD:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 434,\n            columnNumber: 14\n          }, this), \" B\\u1EA1n \\u0111ang k\\u1EBFt n\\u1ED1i \\u0111\\u1EBFn validator c\\u1EE5c b\\u1ED9.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 9\n      }, this);\n    }\n    return null;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"verify-signature-form\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"X\\xE1c minh ch\\u1EEF k\\xFD WebAuthn - Secp256r1\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wallet-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"K\\u1EBFt n\\u1ED1i \\u0111\\u1EBFn: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: connectionEndpoint\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Credential ID: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: [credentialId.substring(0, 8), \"...\", credentialId.substring(credentialId.length - 8)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 27\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: !isMoonWalletAvailable ? \"warning-message\" : \"info-message\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Tr\\u1EA1ng th\\xE1i ch\\u01B0\\u01A1ng tr\\xECnh:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 14\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 451,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: isMoonWalletAvailable ? \"status-ok\" : \"status-error\",\n              children: isMoonWalletAvailable ? '✅' : '❌'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 454,\n              columnNumber: 15\n            }, this), \"MoonWallet: \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: programID.toString()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 457,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"status-ok\",\n              children: \"\\u2705\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 460,\n              columnNumber: 15\n            }, this), \"Secp256r1SigVerify: \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: SECP256R1_PROGRAM_ID.toString()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 461,\n              columnNumber: 35\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"program-note\",\n              children: \"Ch\\u01B0\\u01A1ng tr\\xECnh native Secp256r1SigVerify lu\\xF4n c\\xF3 s\\u1EB5n tr\\xEAn c\\xE1c validator Solana\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 462,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 459,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 452,\n          columnNumber: 11\n        }, this), renderValidatorNote()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 450,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"message\",\n          children: \"Tin nh\\u1EAFn c\\u1EA7n k\\xFD v\\xE0 x\\xE1c minh:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          id: \"message\",\n          value: message,\n          onChange: handleMessageChange,\n          placeholder: \"Nh\\u1EADp tin nh\\u1EAFn c\\u1EA7n k\\xFD v\\xE0 x\\xE1c minh\",\n          disabled: isProcessing,\n          required: true,\n          rows: 4\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 473,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-options\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"T\\xF9y ch\\u1ECDn x\\xE1c minh\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 485,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"option-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              checked: shouldUseHashedMessage,\n              onChange: handleHashedMessageChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 488,\n              columnNumber: 15\n            }, this), \"S\\u1EED d\\u1EE5ng message \\u0111\\xE3 hash (SHA-256)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"option-description\",\n            children: \"WebAuthn \\u0111\\xE3 hash message, n\\xEAn n\\u1EBFu b\\u1EADt t\\xF9y ch\\u1ECDn n\\xE0y, message s\\u1EBD b\\u1ECB hash 2 l\\u1EA7n. N\\u1EBFu t\\u1EAFt, s\\u1EED d\\u1EE5ng message g\\u1ED1c.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"option-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              checked: shouldFlipPublicKey,\n              onChange: handleFlipPublicKeyChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 503,\n              columnNumber: 15\n            }, this), \"\\u0110\\u1EA3o bit parity c\\u1EE7a public key\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 502,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"option-description\",\n            children: \"\\u0110\\u1EA3o bit \\u0111\\u1EA7u ti\\xEAn c\\u1EE7a public key t\\u1EEB 0x02 th\\xE0nh 0x03 ho\\u1EB7c ng\\u01B0\\u1EE3c l\\u1EA1i. \\u0110\\xF4i khi c\\u1EA7n thi\\u1EBFt v\\xEC s\\u1EF1 kh\\xE1c nhau gi\\u1EEFa c\\xE1c th\\u01B0 vi\\u1EC7n.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 510,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 9\n      }, this), success && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-message\",\n        children: success\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 21\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 19\n      }, this), status !== VerificationStatus.IDLE && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"status-message\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: renderStatusMessage()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 522,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 521,\n        columnNumber: 11\n      }, this), signatureResult && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-result\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"K\\u1EBFt qu\\u1EA3 x\\xE1c minh\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 528,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Transaction ID: \", /*#__PURE__*/_jsxDEV(\"a\", {\n            href: `https://explorer.solana.com/tx/${signatureResult}`,\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            children: [signatureResult.slice(0, 8), \"...\", signatureResult.slice(-8)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 529,\n            columnNumber: 32\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 529,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Ch\\u1EEF k\\xFD \\u0111\\xE3 \\u0111\\u01B0\\u1EE3c x\\xE1c minh th\\xE0nh c\\xF4ng tr\\xEAn blockchain!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 530,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 527,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"button-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"primary-button\",\n          disabled: isProcessing,\n          children: isProcessing ? 'Đang xử lý...' : 'Ký và xác minh chữ ký'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 11\n        }, this), messageData.signature && /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"secondary-button\",\n          onClick: handleRetry,\n          disabled: isProcessing,\n          children: \"Th\\u1EED l\\u1EA1i v\\u1EDBi t\\xF9y ch\\u1ECDn hi\\u1EC7n t\\u1EA1i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 534,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n          .verify-signature-form {\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n          }\n          \n          .form-group {\n            margin-bottom: 15px;\n          }\n          \n          label {\n            display: block;\n            margin-bottom: 8px;\n            font-weight: bold;\n          }\n          \n          textarea {\n            width: 100%;\n            padding: 10px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            font-family: monospace;\n            margin-bottom: 15px;\n            font-size: 14px;\n          }\n          \n          .primary-button {\n            background-color: #2196F3;\n            color: white;\n            border: none;\n            padding: 10px 15px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-weight: bold;\n            transition: background-color 0.3s;\n          }\n          \n          .primary-button:hover {\n            background-color: #0b7dda;\n          }\n          \n          .primary-button:disabled {\n            background-color: #cccccc;\n            cursor: not-allowed;\n          }\n\n          .secondary-button {\n            background-color: #f1f1f1;\n            color: #333;\n            border: 1px solid #ccc;\n            padding: 10px 15px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-weight: bold;\n            margin-left: 10px;\n            transition: background-color 0.3s;\n          }\n          \n          .secondary-button:hover {\n            background-color: #e6e6e6;\n          }\n          \n          .secondary-button:disabled {\n            background-color: #f5f5f5;\n            color: #aaa;\n            cursor: not-allowed;\n          }\n          \n          .success-message, .error-message, .warning-message, .info-message {\n            margin: 12px 0;\n            padding: 10px;\n            border-radius: 4px;\n            font-weight: 500;\n          }\n          \n          .success-message {\n            background-color: rgba(0, 200, 83, 0.1);\n            color: #00C853;\n            border: 1px solid #00C853;\n          }\n          \n          .error-message {\n            background-color: rgba(255, 87, 34, 0.1);\n            color: #FF5722;\n            border: 1px solid #FF5722;\n          }\n          \n          .warning-message {\n            background-color: rgba(255, 152, 0, 0.1);\n            color: #FF9800;\n            border: 1px solid #FF9800;\n          }\n          \n          .info-message {\n            background-color: rgba(33, 150, 243, 0.1);\n            color: #333;\n            border: 1px solid #2196F3;\n          }\n          \n          .status-message {\n            margin: 12px 0;\n            padding: 10px;\n            background-color: rgba(33, 150, 243, 0.1);\n            border: 1px solid #2196F3;\n            border-radius: 4px;\n            color: #2196F3;\n          }\n          \n          .verification-result {\n            margin: 20px 0;\n            padding: 15px;\n            background-color: rgba(0, 200, 83, 0.1);\n            border: 1px solid #00C853;\n            border-radius: 4px;\n          }\n          \n          .verification-result h3 {\n            margin-top: 0;\n            color: #00C853;\n          }\n          \n          .verification-result a {\n            color: #2196F3;\n            text-decoration: none;\n          }\n          \n          .verification-result a:hover {\n            text-decoration: underline;\n          }\n          \n          .status-ok {\n            color: #00C853;\n          }\n          \n          .status-error {\n            color: #FF5722;\n          }\n          \n          .info-note {\n            margin-top: 12px;\n            padding: 8px;\n            background-color: #f8f9fa;\n            border-left: 4px solid #2196F3;\n            font-size: 0.9em;\n          }\n          \n          .program-note {\n            margin: 4px 0 0 20px;\n            font-size: 0.85em;\n            font-style: italic;\n            color: #666;\n          }\n          \n          code {\n            font-family: monospace;\n            background-color: #f5f5f5;\n            padding: 2px 4px;\n            border-radius: 2px;\n          }\n\n          .verification-options {\n            margin: 20px 0;\n            padding: 15px;\n            background-color: #f8f9fa;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n          }\n\n          .verification-options h3 {\n            margin-top: 0;\n            margin-bottom: 10px;\n            font-size: 16px;\n            color: #333;\n          }\n\n          .option-item {\n            margin-bottom: 12px;\n          }\n\n          .option-item label {\n            display: flex;\n            align-items: center;\n            font-weight: 500;\n            margin-bottom: 4px;\n          }\n\n          .option-item input[type=\"checkbox\"] {\n            margin-right: 8px;\n          }\n\n          .option-description {\n            margin-left: 24px;\n            font-size: 0.85em;\n            color: #666;\n          }\n\n          .button-group {\n            display: flex;\n            margin-top: 20px;\n          }\n        `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 556,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 442,\n    columnNumber: 5\n  }, this);\n};\n_s(TransferForm, \"5b9PoKR/Z8fOk4OC9GjPJa6Qels=\");\n_c = TransferForm;\nvar _c;\n$RefreshReg$(_c, \"TransferForm\");","map":{"version":3,"names":["React","useState","useEffect","web3","LAMPORTS_PER_SOL","programID","SECP256R1_PROGRAM_ID","verifySecp256r1Signature","getWebAuthnAssertion","getGuardianPDA","getMultisigPDA","getWalletByCredentialId","Buffer","BN","jsxDEV","_jsxDEV","SECP256R1_ORDER","SECP256R1_HALF_ORDER","shrn","normalizeSignatureToLowS","signature","r","slice","s","sBN","gt","console","log","sNormalized","sub","sNormalizedBuffer","toArrayLike","concat","convertDERtoRaw","derSignature","error","Uint8Array","rLength","rStart","rEnd","sLength","sStart","sEnd","rPadded","sPadded","length","set","rawSignature","VerificationStatus","TransferForm","walletAddress","credentialId","guardianId","connection","pdaBalance","_s","message","setMessage","isProcessing","setIsProcessing","setError","success","setSuccess","status","setStatus","IDLE","isMoonWalletAvailable","setIsMoonWalletAvailable","connectionEndpoint","setConnectionEndpoint","signatureResult","setSignatureResult","messageData","setMessageData","messageBytes","messageHash","webAuthnPubKey","feePayer","shouldUseHashedMessage","setShouldUseHashedMessage","shouldFlipPublicKey","setShouldFlipPublicKey","checkPrograms","endpoint","rpcEndpoint","moonWalletInfo","getAccountInfo","warn","toString","handleMessageChange","e","target","value","handleHashedMessageChange","checked","handleFlipPublicKeyChange","handleSubmit","preventDefault","PREPARING","Error","TextEncoder","encode","Array","from","map","b","padStart","join","crypto","subtle","digest","multisigPDA","toBase58","guardianPDA","SIGNING","assertion","TextDecoder","decode","clientDataJSON","clientDataObj","JSON","parse","byteLength","normalizedSignature","credentialMapping","guardianPublicKey","VERIFYING","Keypair","generate","airdropSignature","requestAirdrop","publicKey","confirmTransaction","feePayerBalance","getBalance","airdropError","messageToUse","txid","SUCCESS","verifyError","ERROR","handleRetry","renderStatusMessage","renderValidatorNote","includes","className","children","fileName","_jsxFileName","lineNumber","columnNumber","substring","onSubmit","htmlFor","id","onChange","placeholder","disabled","required","rows","type","href","rel","onClick","_c","$RefreshReg$"],"sources":["/Users/tai/Documents/MoonWallet/moonwallet/frontend_test/src/components/TransferForm.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { PublicKey, Connection, SendTransactionError } from '@solana/web3.js';\nimport { web3 } from '@coral-xyz/anchor';\nimport { LAMPORTS_PER_SOL } from '@solana/web3.js';\nimport { \n  createSecp256r1Instruction,\n  programID,\n  SECP256R1_PROGRAM_ID,\n  verifySecp256r1Signature\n} from '../utils/transactionUtils';\nimport { getWebAuthnAssertion } from '../utils/webauthnUtils';\nimport { getGuardianPDA, getMultisigPDA } from '../utils/credentialUtils';\nimport { getWalletByCredentialId } from '../firebase/webAuthnService';\nimport { Buffer } from 'buffer';\nimport BN from 'bn.js';\n\n// Hằng số cho chuẩn hóa signature\nconst SECP256R1_ORDER = new BN('FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551', 16);\nconst SECP256R1_HALF_ORDER = SECP256R1_ORDER.shrn(1);\n\n/**\n * Chuẩn hóa chữ ký về dạng Low-S\n * @param signature - Chữ ký raw\n * @returns Chữ ký đã chuẩn hóa\n */\nfunction normalizeSignatureToLowS(signature: Buffer): Buffer {\n  const r = signature.slice(0, 32);\n  const s = signature.slice(32, 64);\n  \n  const sBN = new BN(s);\n  \n  // Kiểm tra nếu s > half_order\n  if (sBN.gt(SECP256R1_HALF_ORDER)) {\n    console.log(\"Chuẩn hóa signature về dạng Low-S\");\n    // Tính s' = order - s\n    const sNormalized = SECP256R1_ORDER.sub(sBN);\n    const sNormalizedBuffer = sNormalized.toArrayLike(Buffer, 'be', 32);\n    return Buffer.concat([r, sNormalizedBuffer]);\n  }\n  \n  console.log(\"Signature đã ở dạng Low-S\");\n  return signature;\n}\n\n// Hàm chuyển đổi chữ ký DER sang raw (r, s) format\nconst convertDERtoRaw = (derSignature: Uint8Array): Uint8Array => {\n  // Đảm bảo đây là DER signature\n  if (derSignature[0] !== 0x30) {\n    console.error('Chữ ký không phải định dạng DER');\n    return new Uint8Array(64); // Trả về buffer rỗng nếu không đúng định dạng\n  }\n  \n  // Parse DER format\n  // Format: 0x30 [total-length] 0x02 [r-length] [r] 0x02 [s-length] [s]\n  const rLength = derSignature[3];\n  const rStart = 4;\n  const rEnd = rStart + rLength;\n  \n  const sLength = derSignature[rEnd + 1];\n  const sStart = rEnd + 2;\n  const sEnd = sStart + sLength;\n  \n  // Trích xuất r và s\n  let r = derSignature.slice(rStart, rEnd);\n  let s = derSignature.slice(sStart, sEnd);\n  \n  // Cần đảm bảo r và s đúng 32 bytes\n  // - Nếu dài hơn 32 bytes, cắt bớt (thường r và s có thể có padding)\n  // - Nếu ngắn hơn 32 bytes, thêm padding 0 vào đầu\n  const rPadded = new Uint8Array(32);\n  const sPadded = new Uint8Array(32);\n  \n  if (r.length <= 32) {\n    // Trường hợp r ngắn hơn 32 bytes, thêm padding\n    rPadded.set(r, 32 - r.length);\n  } else {\n    // Trường hợp r dài hơn 32 bytes, cắt bớt (thường là byte đầu tiên là 0)\n    rPadded.set(r.slice(r.length - 32));\n  }\n  \n  if (s.length <= 32) {\n    // Trường hợp s ngắn hơn 32 bytes, thêm padding\n    sPadded.set(s, 32 - s.length);\n  } else {\n    // Trường hợp s dài hơn 32 bytes, cắt bớt (thường là byte đầu tiên là 0)\n    sPadded.set(s.slice(s.length - 32));\n  }\n  \n  // Nối r và s lại\n  const rawSignature = new Uint8Array(64);\n  rawSignature.set(rPadded);\n  rawSignature.set(sPadded, 32);\n  \n  console.log('Đã chuyển đổi signature từ DER sang raw format:');\n  console.log('- DER length:', derSignature.length);\n  console.log('- Raw length:', rawSignature.length);\n  \n  return rawSignature;\n};\n\n// Enum cho các trạng thái xác minh\nenum VerificationStatus {\n  IDLE = 'idle',\n  PREPARING = 'preparing',\n  SIGNING = 'signing',\n  VERIFYING = 'verifying',\n  SUCCESS = 'success',\n  ERROR = 'error'\n}\n\n// Interface cho props của component\ninterface VerifySignatureFormProps {\n  walletAddress: string;  \n  credentialId: string;   \n  guardianId: number;\n  connection: Connection;\n  pdaBalance?: number;\n}\n\nexport const TransferForm: React.FC<VerifySignatureFormProps> = ({\n  walletAddress,\n  credentialId,\n  guardianId,\n  connection,\n  pdaBalance = 0\n}) => {\n  // State\n  const [message, setMessage] = useState<string>(\"\");\n  const [isProcessing, setIsProcessing] = useState<boolean>(false);\n  const [error, setError] = useState<string>('');\n  const [success, setSuccess] = useState<string>('');\n  const [status, setStatus] = useState<VerificationStatus>(VerificationStatus.IDLE);\n  const [isMoonWalletAvailable, setIsMoonWalletAvailable] = useState<boolean>(false);\n  const [connectionEndpoint, setConnectionEndpoint] = useState<string>('');\n  const [signatureResult, setSignatureResult] = useState<string>('');\n  \n  // State mới cho các tùy chọn xác minh\n  const [messageData, setMessageData] = useState<{\n    messageBytes: Uint8Array,\n    messageHash: Uint8Array,\n    webAuthnPubKey: Buffer | null,\n    signature: Buffer | null,\n    feePayer: Keypair | null\n  }>({\n    messageBytes: new Uint8Array(),\n    messageHash: new Uint8Array(),\n    webAuthnPubKey: null,\n    signature: null,\n    feePayer: null\n  });\n\n  const [shouldUseHashedMessage, setShouldUseHashedMessage] = useState<boolean>(false);\n  const [shouldFlipPublicKey, setShouldFlipPublicKey] = useState<boolean>(false);\n  \n  // Kiểm tra chương trình\n  useEffect(() => {\n    const checkPrograms = async () => {\n      try {\n        // Lấy endpoint của connection để hiển thị\n        const endpoint = connection.rpcEndpoint;\n        setConnectionEndpoint(endpoint);\n        console.log(\"Đang kết nối đến:\", endpoint);\n        \n        // Kiểm tra chương trình MoonWallet\n        try {\n          const moonWalletInfo = await connection.getAccountInfo(programID);\n          setIsMoonWalletAvailable(moonWalletInfo !== null);\n          \n          if (moonWalletInfo === null) {\n            console.warn(\"Chương trình MoonWallet không tồn tại trên validator này!\");\n          } else {\n            console.log(\"Đã tìm thấy chương trình MoonWallet:\", programID.toString());\n          }\n        } catch (error) {\n          console.error(\"Lỗi khi kiểm tra chương trình MoonWallet:\", error);\n          setIsMoonWalletAvailable(false);\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi kiểm tra chương trình:\", error);\n      }\n    };\n    \n    checkPrograms();\n  }, [connection]);\n  \n  // Xử lý khi nhập message\n  const handleMessageChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setMessage(e.target.value);\n    setError('');\n    setSuccess('');\n    setStatus(VerificationStatus.IDLE);\n    setSignatureResult('');\n  };\n\n  // Xử lý khi đổi tùy chọn\n  const handleHashedMessageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setShouldUseHashedMessage(e.target.checked);\n  };\n\n  const handleFlipPublicKeyChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setShouldFlipPublicKey(e.target.checked);\n  };\n  \n  // Xử lý khi submit form\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    setIsProcessing(true);\n    setError('');\n    setSuccess('');\n    setSignatureResult('');\n    setStatus(VerificationStatus.PREPARING);\n    \n    try {\n      // Kiểm tra đầu vào\n      if (!message) {\n        throw new Error('Vui lòng nhập tin nhắn cần ký');\n      }\n      \n      // Chuyển message thành bytes\n      const messageBytes = new TextEncoder().encode(message);\n      console.log('Message bytes (UTF-8):', Array.from(messageBytes));\n      console.log('Message bytes (hex):', Array.from(messageBytes).map(b => b.toString(16).padStart(2, '0')).join(''));\n      \n      // Tính hash của message\n      const messageHash = new Uint8Array(await crypto.subtle.digest('SHA-256', messageBytes));\n      console.log('Message hash (SHA-256):', Array.from(messageHash).map(b => b.toString(16).padStart(2, '0')).join(''));\n\n      // Lấy PDA từ credential ID\n      const multisigPDA = await getMultisigPDA(credentialId);\n      console.log('MultisigPDA:', multisigPDA.toBase58());\n      \n      // Lấy PDA của guardian\n      const guardianPDA = await getGuardianPDA(multisigPDA, guardianId);\n      console.log('GuardianPDA:', guardianPDA.toBase58());\n      \n      // Ký message bằng WebAuthn\n      setStatus(VerificationStatus.SIGNING);\n      \n      // Hiển thị thông báo\n      console.log('Đang yêu cầu xác thực WebAuthn...');\n      setError(''); // Xóa thông báo lỗi trước đó\n      setSuccess('Đang hiển thị danh sách khóa WebAuthn, vui lòng chọn khóa để xác thực...');\n      \n      // Sử dụng trực tiếp message gốc làm dữ liệu để ký với WebAuthn\n      // WebAuthn sẽ tự động hash dữ liệu này với SHA-256 trước khi ký\n      const assertion = await getWebAuthnAssertion(null, message, true);\n      \n      if (!assertion) {\n        throw new Error('Lỗi khi ký message bằng WebAuthn hoặc người dùng đã hủy xác thực');\n      }\n      \n      console.log('Đã ký thành công bằng WebAuthn');\n      console.log('ClientDataJSON:', new TextDecoder().decode(assertion.clientDataJSON));\n      \n      // Phân tích clientDataJSON để hiểu cách WebAuthn hash message\n      try {\n        const clientDataObj = JSON.parse(new TextDecoder().decode(assertion.clientDataJSON));\n        console.log('ClientData object:', clientDataObj);\n      } catch (e) {\n        console.error('Lỗi khi phân tích clientDataJSON:', e);\n      }\n      \n      setSuccess(''); // Xóa thông báo thành công tạm thời\n      \n      // Lấy chữ ký từ WebAuthn assertion và chuyển đổi từ DER sang raw format\n      console.log('Signature từ WebAuthn (DER format):', Buffer.from(assertion.signature).toString('hex'));\n      console.log('Độ dài signature ban đầu:', assertion.signature.byteLength);\n      \n      // Chuyển đổi signature từ DER sang raw format (r, s)\n      const rawSignature = convertDERtoRaw(assertion.signature);\n      const signature = Buffer.from(rawSignature);\n      \n      console.log('Signature sau khi chuyển đổi (raw format):', signature.toString('hex'));\n      console.log('Độ dài signature sau khi chuyển đổi:', signature.length);\n      \n      // Thêm bước chuẩn hóa signature về dạng Low-S\n      const normalizedSignature = normalizeSignatureToLowS(signature);\n      console.log(\"Signature sau khi chuẩn hóa (Low-S format):\", normalizedSignature.toString(\"hex\"));\n      \n      // LẤY WEBAUTHN PUBLIC KEY TỪ FIREBASE\n      console.log('Lấy WebAuthn public key từ Firebase...');\n      const credentialMapping = await getWalletByCredentialId(credentialId);\n      \n      if (!credentialMapping || !credentialMapping.guardianPublicKey || credentialMapping.guardianPublicKey.length === 0) {\n        throw new Error('Không tìm thấy public key cho credential ID này');\n      }\n      \n      // Sử dụng WebAuthn public key từ Firebase\n      console.log('Đã tìm thấy WebAuthn public key trong Firebase:', credentialMapping.guardianPublicKey);\n      // Chuyển đổi từ mảng số về Buffer\n      const webAuthnPubKey = Buffer.from(new Uint8Array(credentialMapping.guardianPublicKey));\n      \n      // Kiểm tra độ dài khóa\n      if (webAuthnPubKey.length !== 33) {\n        console.warn(`WebAuthn public key từ Firebase có độ dài không đúng: ${webAuthnPubKey.length} bytes, cần 33 bytes`);\n      }\n      \n      // Xác minh chữ ký\n      setStatus(VerificationStatus.VERIFYING);\n      \n      // Tạo ví tạm để trả phí giao dịch\n      const feePayer = web3.Keypair.generate();\n      \n      // Xin SOL airdrop để trả phí\n      try {\n        const airdropSignature = await connection.requestAirdrop(\n          feePayer.publicKey,\n          web3.LAMPORTS_PER_SOL / 50 // 0.02 SOL để trả phí\n        );\n        await connection.confirmTransaction(airdropSignature);\n        \n        // Kiểm tra số dư sau khi airdrop\n        const feePayerBalance = await connection.getBalance(feePayer.publicKey);\n        console.log(`Fee payer balance: ${feePayerBalance / LAMPORTS_PER_SOL} SOL`);\n        \n        if (feePayerBalance === 0) {\n          throw new Error('Không thể airdrop SOL cho fee payer');\n        }\n      } catch (airdropError) {\n        console.warn('Không thể airdrop SOL để trả phí:', airdropError);\n        // Tiếp tục thực hiện vì có thể account đã có sẵn SOL\n      }\n\n      // Lưu lại dữ liệu để có thể dùng lại khi thay đổi tùy chọn\n      setMessageData({\n        messageBytes,\n        messageHash,\n        webAuthnPubKey,\n        signature: normalizedSignature,\n        feePayer\n      });\n      \n      // Sử dụng hàm verifySecp256r1Signature để kiểm tra chữ ký\n      try {\n        // Chọn message gốc hoặc đã hash dựa vào tùy chọn\n        const messageToUse = shouldUseHashedMessage \n          ? Buffer.from(messageHash) \n          : Buffer.from(messageBytes);\n        \n        const txid = await verifySecp256r1Signature(\n          connection,\n          messageToUse,\n          webAuthnPubKey,\n          normalizedSignature,\n          feePayer,\n          shouldFlipPublicKey\n        );\n        \n        setStatus(VerificationStatus.SUCCESS);\n        setSuccess('Xác minh chữ ký thành công!');\n        setSignatureResult(txid);\n        console.log('Kết quả xác minh chữ ký:', txid);\n      } catch (verifyError: any) {\n        throw new Error(`Lỗi khi xác minh chữ ký: ${verifyError.message}`);\n      }\n      \n    } catch (error: any) {\n      console.error('Lỗi khi xác minh chữ ký:', error);\n      setError(error.message || 'Đã xảy ra lỗi khi xác minh chữ ký');\n      setStatus(VerificationStatus.ERROR);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Hàm thử lại với các tùy chọn khác nhau\n  const handleRetry = async () => {\n    // Đảm bảo đã có dữ liệu cần thiết\n    if (!messageData.webAuthnPubKey || !messageData.signature || !messageData.feePayer) {\n      setError('Vui lòng ký tin nhắn trước khi thử lại');\n      return;\n    }\n\n    setIsProcessing(true);\n    setError('');\n    setSuccess('');\n    setSignatureResult('');\n    setStatus(VerificationStatus.VERIFYING);\n\n    try {\n      // Chọn message gốc hoặc đã hash dựa vào tùy chọn\n      const messageToUse = shouldUseHashedMessage \n        ? Buffer.from(messageData.messageHash) \n        : Buffer.from(messageData.messageBytes);\n      \n      console.log(`Thử lại xác minh với ${shouldUseHashedMessage ? 'message đã hash' : 'message gốc'} và ${shouldFlipPublicKey ? 'đảo' : 'không đảo'} public key`);\n\n      const txid = await verifySecp256r1Signature(\n        connection,\n        messageToUse,\n        messageData.webAuthnPubKey,\n        messageData.signature,\n        messageData.feePayer,\n        shouldFlipPublicKey\n      );\n      \n      setStatus(VerificationStatus.SUCCESS);\n      setSuccess('Xác minh chữ ký thành công!');\n      setSignatureResult(txid);\n      console.log('Kết quả xác minh chữ ký:', txid);\n    } catch (verifyError: any) {\n      console.error('Lỗi khi xác minh chữ ký:', verifyError);\n      setError(`Lỗi khi xác minh chữ ký: ${verifyError.message}`);\n      setStatus(VerificationStatus.ERROR);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  \n  // Render status message dựa trên status\n  const renderStatusMessage = () => {\n    switch (status) {\n      case VerificationStatus.PREPARING:\n        return 'Đang chuẩn bị xác minh chữ ký...';\n      case VerificationStatus.SIGNING:\n        return 'Vui lòng xác thực bằng WebAuthn (vân tay hoặc Face ID) khi được yêu cầu...';\n      case VerificationStatus.VERIFYING:\n        return 'Đang xác minh chữ ký trên blockchain...';\n      case VerificationStatus.SUCCESS:\n        return 'Xác minh chữ ký thành công!';\n      case VerificationStatus.ERROR:\n        return 'Xác minh chữ ký thất bại!';\n      default:\n        return '';\n    }\n  };\n  \n  // Hiển thị ghi chú về validator cục bộ\n  const renderValidatorNote = () => {\n    if (connectionEndpoint.includes('localhost') || connectionEndpoint.includes('127.0.0.1')) {\n      return (\n        <div className=\"info-note\">\n          <p><strong>Lưu ý:</strong> Bạn đang kết nối đến validator cục bộ.</p>\n        </div>\n      );\n    }\n    return null;\n  };\n  \n  return (\n    <div className=\"verify-signature-form\">\n      <h2>Xác minh chữ ký WebAuthn - Secp256r1</h2>\n      \n      <div className=\"wallet-info\">\n        <p>Kết nối đến: <strong>{connectionEndpoint}</strong></p>\n        <p>Credential ID: <strong>{credentialId.substring(0, 8)}...{credentialId.substring(credentialId.length - 8)}</strong></p>\n        \n        {/* Hiển thị trạng thái MoonWallet program */}\n        <div className={!isMoonWalletAvailable ? \"warning-message\" : \"info-message\"}>\n          <p><strong>Trạng thái chương trình:</strong></p>\n          <ul>\n            <li>\n              <span className={isMoonWalletAvailable ? \"status-ok\" : \"status-error\"}>\n                {isMoonWalletAvailable ? '✅' : '❌'}\n              </span> \n              MoonWallet: <code>{programID.toString()}</code>\n            </li>\n            <li>\n              <span className=\"status-ok\">✅</span> \n              Secp256r1SigVerify: <code>{SECP256R1_PROGRAM_ID.toString()}</code>\n              <p className=\"program-note\">Chương trình native Secp256r1SigVerify luôn có sẵn trên các validator Solana</p>\n            </li>\n          </ul>\n          \n          {renderValidatorNote()}\n        </div>\n      </div>\n      \n      <form onSubmit={handleSubmit}>\n        <div className=\"form-group\">\n          <label htmlFor=\"message\">Tin nhắn cần ký và xác minh:</label>\n          <textarea\n            id=\"message\"\n            value={message}\n            onChange={handleMessageChange}\n            placeholder=\"Nhập tin nhắn cần ký và xác minh\"\n            disabled={isProcessing}\n            required\n            rows={4}\n          />\n        </div>\n\n        <div className=\"verification-options\">\n          <h3>Tùy chọn xác minh</h3>\n          <div className=\"option-item\">\n            <label>\n              <input \n                type=\"checkbox\" \n                checked={shouldUseHashedMessage}\n                onChange={handleHashedMessageChange}\n              />\n              Sử dụng message đã hash (SHA-256)\n            </label>\n            <div className=\"option-description\">\n              WebAuthn đã hash message, nên nếu bật tùy chọn này, \n              message sẽ bị hash 2 lần. Nếu tắt, sử dụng message gốc.\n            </div>\n          </div>\n\n          <div className=\"option-item\">\n            <label>\n              <input \n                type=\"checkbox\" \n                checked={shouldFlipPublicKey}\n                onChange={handleFlipPublicKeyChange}\n              />\n              Đảo bit parity của public key\n            </label>\n            <div className=\"option-description\">\n              Đảo bit đầu tiên của public key từ 0x02 thành 0x03 hoặc ngược lại.\n              Đôi khi cần thiết vì sự khác nhau giữa các thư viện.\n            </div>\n          </div>\n        </div>\n        \n        {success && <div className=\"success-message\">{success}</div>}\n        {error && <div className=\"error-message\">{error}</div>}\n        \n        {status !== VerificationStatus.IDLE && (\n          <div className=\"status-message\">\n            <p>{renderStatusMessage()}</p>\n          </div>\n        )}\n        \n        {signatureResult && (\n          <div className=\"verification-result\">\n            <h3>Kết quả xác minh</h3>\n            <p>Transaction ID: <a href={`https://explorer.solana.com/tx/${signatureResult}`} target=\"_blank\" rel=\"noopener noreferrer\">{signatureResult.slice(0, 8)}...{signatureResult.slice(-8)}</a></p>\n            <p>Chữ ký đã được xác minh thành công trên blockchain!</p>\n          </div>\n        )}\n        \n        <div className=\"button-group\">\n          <button \n            type=\"submit\" \n            className=\"primary-button\" \n            disabled={isProcessing}\n          >\n            {isProcessing ? 'Đang xử lý...' : 'Ký và xác minh chữ ký'}\n          </button>\n\n          {messageData.signature && (\n            <button \n              type=\"button\" \n              className=\"secondary-button\" \n              onClick={handleRetry}\n              disabled={isProcessing}\n            >\n              Thử lại với tùy chọn hiện tại\n            </button>\n          )}\n        </div>\n      </form>\n      \n      <style>\n        {`\n          .verify-signature-form {\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n          }\n          \n          .form-group {\n            margin-bottom: 15px;\n          }\n          \n          label {\n            display: block;\n            margin-bottom: 8px;\n            font-weight: bold;\n          }\n          \n          textarea {\n            width: 100%;\n            padding: 10px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            font-family: monospace;\n            margin-bottom: 15px;\n            font-size: 14px;\n          }\n          \n          .primary-button {\n            background-color: #2196F3;\n            color: white;\n            border: none;\n            padding: 10px 15px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-weight: bold;\n            transition: background-color 0.3s;\n          }\n          \n          .primary-button:hover {\n            background-color: #0b7dda;\n          }\n          \n          .primary-button:disabled {\n            background-color: #cccccc;\n            cursor: not-allowed;\n          }\n\n          .secondary-button {\n            background-color: #f1f1f1;\n            color: #333;\n            border: 1px solid #ccc;\n            padding: 10px 15px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-weight: bold;\n            margin-left: 10px;\n            transition: background-color 0.3s;\n          }\n          \n          .secondary-button:hover {\n            background-color: #e6e6e6;\n          }\n          \n          .secondary-button:disabled {\n            background-color: #f5f5f5;\n            color: #aaa;\n            cursor: not-allowed;\n          }\n          \n          .success-message, .error-message, .warning-message, .info-message {\n            margin: 12px 0;\n            padding: 10px;\n            border-radius: 4px;\n            font-weight: 500;\n          }\n          \n          .success-message {\n            background-color: rgba(0, 200, 83, 0.1);\n            color: #00C853;\n            border: 1px solid #00C853;\n          }\n          \n          .error-message {\n            background-color: rgba(255, 87, 34, 0.1);\n            color: #FF5722;\n            border: 1px solid #FF5722;\n          }\n          \n          .warning-message {\n            background-color: rgba(255, 152, 0, 0.1);\n            color: #FF9800;\n            border: 1px solid #FF9800;\n          }\n          \n          .info-message {\n            background-color: rgba(33, 150, 243, 0.1);\n            color: #333;\n            border: 1px solid #2196F3;\n          }\n          \n          .status-message {\n            margin: 12px 0;\n            padding: 10px;\n            background-color: rgba(33, 150, 243, 0.1);\n            border: 1px solid #2196F3;\n            border-radius: 4px;\n            color: #2196F3;\n          }\n          \n          .verification-result {\n            margin: 20px 0;\n            padding: 15px;\n            background-color: rgba(0, 200, 83, 0.1);\n            border: 1px solid #00C853;\n            border-radius: 4px;\n          }\n          \n          .verification-result h3 {\n            margin-top: 0;\n            color: #00C853;\n          }\n          \n          .verification-result a {\n            color: #2196F3;\n            text-decoration: none;\n          }\n          \n          .verification-result a:hover {\n            text-decoration: underline;\n          }\n          \n          .status-ok {\n            color: #00C853;\n          }\n          \n          .status-error {\n            color: #FF5722;\n          }\n          \n          .info-note {\n            margin-top: 12px;\n            padding: 8px;\n            background-color: #f8f9fa;\n            border-left: 4px solid #2196F3;\n            font-size: 0.9em;\n          }\n          \n          .program-note {\n            margin: 4px 0 0 20px;\n            font-size: 0.85em;\n            font-style: italic;\n            color: #666;\n          }\n          \n          code {\n            font-family: monospace;\n            background-color: #f5f5f5;\n            padding: 2px 4px;\n            border-radius: 2px;\n          }\n\n          .verification-options {\n            margin: 20px 0;\n            padding: 15px;\n            background-color: #f8f9fa;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n          }\n\n          .verification-options h3 {\n            margin-top: 0;\n            margin-bottom: 10px;\n            font-size: 16px;\n            color: #333;\n          }\n\n          .option-item {\n            margin-bottom: 12px;\n          }\n\n          .option-item label {\n            display: flex;\n            align-items: center;\n            font-weight: 500;\n            margin-bottom: 4px;\n          }\n\n          .option-item input[type=\"checkbox\"] {\n            margin-right: 8px;\n          }\n\n          .option-description {\n            margin-left: 24px;\n            font-size: 0.85em;\n            color: #666;\n          }\n\n          .button-group {\n            display: flex;\n            margin-top: 20px;\n          }\n        `}\n      </style>\n    </div>\n  );\n}; "],"mappings":"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ACEiJ,IAAI,EAAC,QAAQ;UACbf,SAAS,EAAC,kBAAkB;UAC5BkB,OAAO,EAAEtB,WAAY;UACrBgB,QAAQ,EAAEnG,YAAa;UAAAwF,QAAA,EACxB;QAED;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CACT;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACF,CAAC,eAEPvI,OAAA;MAAAmI,QAAA,EACG;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IAAS;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACI,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEV,CAAC;AAAC/F,EAAA,CAloBWN,YAAgD;AAAAmH,EAAA,GAAhDnH,YAAgD;AAAA,IAAAmH,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}