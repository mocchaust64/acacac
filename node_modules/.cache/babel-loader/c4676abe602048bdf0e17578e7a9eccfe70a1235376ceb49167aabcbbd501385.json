{"ast":null,"code":"var _jsxFileName = \"/Users/tai/Documents/MoonWallet/moonwallet/frontend_test/src/App.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { Connection, PublicKey, Keypair, Transaction, SystemProgram, TransactionInstruction, LAMPORTS_PER_SOL, sendAndConfirmTransaction } from '@solana/web3.js';\nimport { Buffer } from 'buffer';\nimport './App.css';\nimport { createWebAuthnCredential, getWebAuthnAssertionForLogin } from './utils/webauthnUtils';\nimport { processCredentialIdForPDA, getMultisigPDA, getGuardianPDA } from './utils/credentialUtils';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { saveInvitation, getInvitation, getGuardianData, updateGuardianStatus, getPendingInvites, deleteGuardianData } from './firebase/guardianService';\nimport { getWalletByCredentialId } from './firebase/webAuthnService';\n// Thêm import TransferForm\nimport { TransferForm } from './components/TransferForm';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RPC_ENDPOINT = process.env.REACT_APP_RPC_ENDPOINT || 'http://127.0.0.1:8899'; // Localhost validator\nconst PROGRAM_ID_STRING = process.env.REACT_APP_PROGRAM_ID || 'DeN1rBfabZezHPvrq9q7BbzUbZkrjnHE1kQDrPK8kWQ3'; // Program ID mới triển khai\n\nexport const PROGRAM_ID = new PublicKey(PROGRAM_ID_STRING);\n\n// Tùy chọn kết nối\nconst connectionOptions = {\n  commitment: 'confirmed',\n  confirmTransactionInitialTimeout: 60000,\n  disableRetryOnRateLimit: false,\n  fetch: fetch\n};\n\n// Connection với validator\nconst connection = new Connection(RPC_ENDPOINT, connectionOptions);\n\n// Schema cho các struct của chương trình\nclass ActionParams {\n  constructor(props) {\n    this.amount = void 0;\n    this.destination = void 0;\n    this.tokenMint = void 0;\n    this.amount = props.amount;\n    this.destination = props.destination;\n    this.tokenMint = props.tokenMint;\n  }\n}\nfunction bufferToUint8Array(buffer) {\n  return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n}\nfunction concatUint8Arrays(...arrays) {\n  // Tính tổng độ dài\n  const totalLength = arrays.reduce((acc, arr) => acc + arr.length, 0);\n  const result = new Uint8Array(totalLength);\n  let offset = 0;\n  for (const arr of arrays) {\n    result.set(arr, offset);\n    offset += arr.length;\n  }\n  return result;\n}\nconst bigIntToLeBytes = (value, bytesLength = 8) => {\n  const result = new Uint8Array(bytesLength);\n  for (let i = 0; i < bytesLength; i++) {\n    result[i] = Number(value >> BigInt(8 * i) & BigInt(0xff));\n  }\n  return result;\n};\nconst calculateMultisigPDA = async (programId, credentialId) => {\n  const seedBuffer = processCredentialIdForPDA(credentialId);\n  console.log(\"Xử lý credential ID:\", credentialId);\n  console.log(\"Seed buffer để tính PDA:\", Buffer.from(seedBuffer).toString('hex'));\n  return PublicKey.findProgramAddressSync([Buffer.from(\"multisig\"), seedBuffer], programId);\n};\n\n// Hàm nén khóa công khai từ dạng uncompressed (65 bytes) sang compressed (33 bytes)\nconst compressPublicKey = uncompressedKey => {\n  // Đảm bảo khóa bắt đầu với byte 0x04 (không nén)\n  if (uncompressedKey[0] !== 0x04 || uncompressedKey.length !== 65) {\n    console.warn('Khóa không đúng định dạng không nén ECDSA, tạo khóa ngẫu nhiên');\n    // Tạo khóa random nếu không đúng định dạng\n    const randomKey = Buffer.alloc(33);\n    randomKey[0] = 0x02; // compressed, y is even\n\n    // Tạo dữ liệu ngẫu nhiên cho 32 bytes còn lại\n    const randomBytes = new Uint8Array(32);\n    crypto.getRandomValues(randomBytes);\n\n    // Sao chép vào buffer\n    for (let i = 0; i < 32; i++) {\n      randomKey[i + 1] = randomBytes[i];\n    }\n    return randomKey;\n  }\n\n  // Lấy tọa độ x và y\n  const x = new Uint8Array(uncompressedKey.slice(1, 33));\n  const y = new Uint8Array(uncompressedKey.slice(33, 65));\n\n  // Tính prefix: 0x02 nếu y chẵn, 0x03 nếu y lẻ\n  const prefix = (y[31] & 1) === 0 ? 0x02 : 0x03;\n\n  // Tạo khóa nén: prefix (1 byte) + x (32 bytes)\n  const compressedKey = Buffer.alloc(33);\n  compressedKey[0] = prefix;\n\n  // Copy x vào compressedKey từ vị trí 1\n  for (let i = 0; i < 32; i++) {\n    compressedKey[i + 1] = x[i];\n  }\n  return compressedKey;\n};\n\n// Hàm hash recovery phrase tại frontend\nconst hashRecoveryPhrase = async phrase => {\n  // Chuyển recovery phrase thành bytes\n  const phraseBytes = new TextEncoder().encode(phrase);\n\n  // Tạo buffer 32 bytes để lưu dữ liệu\n  const inputBytes = new Uint8Array(32);\n\n  // Sao chép dữ liệu từ phrase, đảm bảo không vượt quá 32 bytes\n  inputBytes.set(phraseBytes.slice(0, Math.min(phraseBytes.length, 32)));\n\n  // Hash bằng SHA-256\n  const hashBuffer = await crypto.subtle.digest('SHA-256', inputBytes);\n\n  // Chuyển kết quả thành Uint8Array\n  return new Uint8Array(hashBuffer);\n};\n\n// Chuyển đổi secret key từ chuỗi trong .env thành mảng số\nconst convertSecretKeyStringToUint8Array = secretKeyString => {\n  if (!secretKeyString) {\n    throw new Error('Fee payer secret key không được định nghĩa trong biến môi trường');\n  }\n\n  // Chuyển đổi chuỗi \"1,2,3,...\" thành mảng số\n  const numbers = secretKeyString.split(',').map(s => parseInt(s.trim(), 10));\n\n  // Kiểm tra kích thước hợp lệ (64 bytes cho ed25519)\n  if (numbers.length !== 64 && numbers.length !== 65) {\n    throw new Error(`Secret key phải có 64 hoặc 65 bytes, nhưng có ${numbers.length} bytes`);\n  }\n\n  // Nếu có 65 bytes, bỏ qua byte cuối cùng (thường là checksum)\n  const bytes = numbers.length === 65 ? numbers.slice(0, 64) : numbers;\n  return new Uint8Array(bytes);\n};\nconst hashCredentialId = async credentialId => {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(credentialId);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  return new Uint8Array(hashBuffer);\n};\nfunction App() {\n  _s();\n  const [walletKeypair, setWalletKeypair] = useState(null);\n  const [walletBalance, setWalletBalance] = useState(0);\n  const [multisigAddress, setMultisigAddress] = useState(null);\n  const [threshold, setThreshold] = useState(1);\n  const [guardianName, setGuardianName] = useState('Owner');\n  const [recoveryPhrase, setRecoveryPhrase] = useState('');\n  const [transactionStatus, setTransactionStatus] = useState('');\n  const [guardianPDA, setGuardianPDA] = useState(null);\n  const [isLoadingBalance, setIsLoadingBalance] = useState(false);\n  const [credentialId, setCredentialId] = useState('');\n  const [webauthnPubkey, setWebauthnPubkey] = useState('');\n  const [walletName, setWalletName] = useState('My Moon Wallet');\n  const [isUsingTempWallet, setIsUsingTempWallet] = useState(false);\n  // Thêm state cho new guardian\n  const [newGuardianName, setNewGuardianName] = useState('');\n  const [newRecoveryPhrase, setNewRecoveryPhrase] = useState('');\n  const [existingGuardians, setExistingGuardians] = useState([]); // Lưu các guardian ID đã tồn tại\n  const [showAddGuardianForm, setShowAddGuardianForm] = useState(false);\n  // Thêm state cho fee payer của dự án\n  const [projectFeePayerKeypair, setProjectFeePayerKeypair] = useState(null);\n  const [usingProjectFeePayer, setUsingProjectFeePayer] = useState(true);\n  const [feePayerBalance, setFeePayerBalance] = useState(0);\n  const [isLoadingFeePayerBalance, setIsLoadingFeePayerBalance] = useState(false);\n  // Thêm state cho số dư PDA\n  const [pdaBalance, setPdaBalance] = useState(0);\n  const [isLoadingPdaBalance, setIsLoadingPdaBalance] = useState(false);\n  // Thêm state cho việc chọn guardian ID\n  const [selectedGuardianId, setSelectedGuardianId] = useState(1);\n  // State cho form nạp tiền\n  const [depositAmount, setDepositAmount] = useState(0.1);\n  // State cho form rút tiền\n  const [withdrawAmount, setWithdrawAmount] = useState(0.05);\n  const [recipientAddress, setRecipientAddress] = useState('');\n  // State cho form đăng nhập ví\n  const [loginCredentialId, setLoginCredentialId] = useState('');\n  const [isLoggingIn, setIsLoggingIn] = useState(false);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [showLoginForm, setShowLoginForm] = useState(false);\n\n  // Thêm state cho chức năng tạo invitation\n  const [inviteLink, setInviteLink] = useState('');\n  const [inviteCode, setInviteCode] = useState('');\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [showInviteInput, setShowInviteInput] = useState(false);\n  const [pendingInvites, setPendingInvites] = useState([]);\n\n  // Tạo keypair mới khi component được mount\n  useEffect(() => {\n    const projectPayerPrivateKey = convertSecretKeyStringToUint8Array(process.env.REACT_APP_FEE_PAYER_SECRET_KEY);\n\n    // Sử dụng keypair cố định cho fee payer\n    const feePayerKeypair = Keypair.fromSecretKey(projectPayerPrivateKey);\n    setProjectFeePayerKeypair(feePayerKeypair);\n\n    // Load balance cho fee payer\n    loadFeePayerBalance(feePayerKeypair);\n  }, []);\n\n  // Thêm hàm để load balance của fee payer\n  const loadFeePayerBalance = async keypair => {\n    try {\n      setIsLoadingFeePayerBalance(true);\n      const balance = await connection.getBalance(keypair.publicKey);\n      console.log(`Fee payer balance: ${balance / 1000000000} SOL`);\n\n      // Nếu balance quá thấp, có thể gửi thông báo cảnh báo\n      if (balance < 100000000) {\n        // dưới 0.1 SOL\n        console.warn(\"Fee payer balance thấp, cần nạp thêm SOL\");\n      }\n      setFeePayerBalance(balance / 1000000000);\n    } catch (error) {\n      console.error(\"Lỗi khi load balance của fee payer:\", error);\n    } finally {\n      setIsLoadingFeePayerBalance(false);\n    }\n  };\n\n  // Tải balance với xử lý lỗi tốt hơn\n  const loadBalance = async keypair => {\n    const publicKey = (keypair === null || keypair === void 0 ? void 0 : keypair.publicKey) || (walletKeypair === null || walletKeypair === void 0 ? void 0 : walletKeypair.publicKey);\n    if (!publicKey) return;\n    setIsLoadingBalance(true);\n    try {\n      console.log(\"Đang tải balance cho địa chỉ:\", publicKey.toString());\n      const balance = await connection.getBalance(publicKey);\n      console.log(\"Balance đã tải thành công:\", balance / 1000000000);\n      setWalletBalance(balance / 1000000000); // Chuyển từ lamports sang SOL\n    } catch (error) {\n      console.error('Lỗi khi tải balance:', error);\n      // Không hiển thị lỗi cho người dùng, chỉ log ra console\n    } finally {\n      setIsLoadingBalance(false);\n    }\n  };\n\n  // Tạo ví với WebAuthn\n  const createWalletWithWebAuthn = async () => {\n    try {\n      // Kiểm tra xem người dùng đã nhập recovery phrase chưa\n      if (!recoveryPhrase || recoveryPhrase.trim().length < 8) {\n        setTransactionStatus('Vui lòng nhập recovery phrase (ít nhất 8 ký tự) trước khi tạo ví');\n        return;\n      }\n\n      // Kiểm tra xem có fee payer hay không\n      if (!projectFeePayerKeypair) {\n        setTransactionStatus('Không tìm thấy fee payer của dự án. Vui lòng thử lại sau.');\n        return;\n      }\n      setTransactionStatus('Đang tạo ví Moon Wallet...\\n\\nBước 1: Đang tạo khóa WebAuthn...');\n\n      // 1. Tạo khóa WebAuthn\n      const walletAddress = projectFeePayerKeypair.publicKey.toString(); // Sử dụng địa chỉ của fee payer\n      const result = await createWebAuthnCredential(walletAddress, walletName);\n\n      // Chuyển đổi rawId thành base64 để lưu trữ và sử dụng\n      const rawIdBase64 = Buffer.from(result.rawId).toString('base64');\n      setCredentialId(rawIdBase64);\n      setWebauthnPubkey(result.publicKey);\n      setTransactionStatus(prev => prev + `\\nĐã tạo khóa WebAuthn thành công!\\nCredential ID (base64): ${rawIdBase64.slice(0, 10)}...\\nPublic Key: ${result.publicKey.slice(0, 10)}...`);\n      const multisigPDA = getMultisigPDA(rawIdBase64);\n      console.log(\"Multisig PDA:\", multisigPDA.toString());\n      setMultisigAddress(multisigPDA);\n      setTransactionStatus(prev => prev + `\\n\\nBước 2: Đang khởi tạo ví multisig tại địa chỉ: ${multisigPDA.toString()}...`);\n      const existingAccount = await connection.getAccountInfo(multisigPDA);\n      if (existingAccount) {\n        setTransactionStatus(prev => prev + `\\n\\nLỖI: Ví multisig với credential ID này đã tồn tại. Điều này gần như không thể xảy ra vì credential ID luôn duy nhất.`);\n        return;\n      }\n      const guardianId = BigInt(1); // Owner có ID = 1\n\n      const guardianIdBytes = bigIntToLeBytes(guardianId);\n      const [guardianPDAAddress] = PublicKey.findProgramAddressSync([Buffer.from(\"guardian\").subarray(0), multisigPDA.toBuffer(), guardianIdBytes], PROGRAM_ID);\n      setGuardianPDA(guardianPDAAddress);\n\n      // 4. Tạo transaction tích hợp để khởi tạo multisig và thêm guardian owner\n      const transaction = new Transaction();\n\n      // 4.1 Khởi tạo Multisig\n      // Đây là discriminator cho initialize_multisig (sử dụng giá trị chính xác từ Anchor IDL)\n      const initMultisigDiscriminator = new Uint8Array([220, 130, 117, 21, 27, 227, 78, 213]);\n      const thresholdBytes = new Uint8Array([threshold]);\n      const credentialIdString = rawIdBase64;\n      const credentialIdBuffer = Buffer.from(credentialIdString);\n      console.log(\"Credential ID gửi đi (chuỗi gốc):\", credentialIdString);\n      const credentialIdLenBuffer = Buffer.alloc(4);\n      credentialIdLenBuffer.writeUInt32LE(credentialIdBuffer.length, 0);\n      const credentialIdLenBytes = bufferToUint8Array(credentialIdLenBuffer);\n      const credentialIdDataBytes = bufferToUint8Array(credentialIdBuffer);\n\n      // Tạo dữ liệu instruction theo đúng cấu trúc contract yêu cầu\n      const initData = concatUint8Arrays(initMultisigDiscriminator, thresholdBytes, credentialIdLenBytes, credentialIdDataBytes);\n\n      // Thêm instruction khởi tạo multisig vào transaction\n      transaction.add(new TransactionInstruction({\n        keys: [{\n          pubkey: multisigPDA,\n          isSigner: false,\n          isWritable: true\n        }, {\n          pubkey: projectFeePayerKeypair.publicKey,\n          isSigner: true,\n          isWritable: true\n        }, {\n          pubkey: SystemProgram.programId,\n          isSigner: false,\n          isWritable: false\n        }],\n        programId: PROGRAM_ID,\n        data: Buffer.from(initData)\n      }));\n\n      // Sign và gửi transaction\n      transaction.feePayer = projectFeePayerKeypair.publicKey;\n      transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n\n      // Thông báo cho người dùng\n      setTransactionStatus(prev => prev + '\\nĐang gửi transaction để khởi tạo ví và thêm guardian owner...');\n\n      // Log dữ liệu transaction để debug\n      console.log(\"Transaction data:\", {\n        instructions: transaction.instructions.map((ix, index) => ({\n          programId: ix.programId.toString(),\n          keys: ix.keys.map(k => ({\n            pubkey: k.pubkey.toString(),\n            isSigner: k.isSigner,\n            isWritable: k.isWritable\n          })),\n          data: index === 1 ? {\n            discriminator: Array.from(initMultisigDiscriminator),\n            threshold: threshold,\n            credentialIdLength: credentialIdBuffer.length,\n            credentialId: Array.from(credentialIdBuffer),\n            isOwner: true,\n            hasWebauthn: true,\n            webauthnPubkeyLength: result.publicKey.length\n          } : \"initMultisig\"\n        }))\n      });\n      const signature = await connection.sendTransaction(transaction, [projectFeePayerKeypair]);\n      await connection.confirmTransaction(signature);\n      setTransactionStatus(prev => prev + `\\nVí multisig đã được khởi tạo thành công! Signature: ${signature}`);\n\n      // 5. Thêm guardian đầu tiên (owner)\n      setTransactionStatus(prev => prev + '\\n\\nBước 3: Đang thêm guardian owner đầu tiên...');\n      try {\n        // Tính PDA cho guardian\n        const guardianId = BigInt(1); // Owner có ID = 1\n        const guardianIdBytes = bigIntToLeBytes(guardianId);\n\n        // 5.1 Tính PDA cho multisig với credential_id\n        const guardianMultisigPDA = multisigPDA;\n        console.log(\"Sử dụng PDA cho guardian với multisig PDA:\", guardianMultisigPDA.toString());\n\n        // 5.2 Tính PDA cho guardian\n        const guardianPDA = getGuardianPDA(guardianMultisigPDA, 1); // Owner có ID = 1\n\n        setGuardianPDA(guardianPDA);\n\n        // Hash recovery phrase tại frontend\n        console.log(\"Recovery phrase gốc:\", recoveryPhrase);\n        const hashedRecoveryBytes = await hashRecoveryPhrase(recoveryPhrase);\n        console.log(\"Recovery phrase sau khi hash tại frontend:\", Buffer.from(hashedRecoveryBytes).toString('hex'));\n\n        // Tạo discriminator cho add_guardian\n        const addGuardianDiscriminator = new Uint8Array([167, 189, 170, 27, 74, 240, 201, 241]);\n\n        // Chuyển guardian ID thành bytes\n        const guardianIdBigIntBytes = bigIntToLeBytes(guardianId);\n\n        // Chuẩn bị tên guardian\n        const guardianNameBuffer = Buffer.from(guardianName || 'Owner');\n        const guardianNameLenBuffer = Buffer.alloc(4);\n        guardianNameLenBuffer.writeUInt32LE(guardianNameBuffer.length, 0);\n\n        // Chuẩn bị recovery hash - sử dụng giá trị đã hash\n        const recoveryHashIntermediateBytes = hashedRecoveryBytes;\n\n        // Chuẩn bị các tham số khác\n        const isOwnerByte = new Uint8Array([1]); // true = 1\n\n        const uncompressedKeyBuffer = Buffer.from(result.publicKey, 'hex');\n        console.log(\"WebAuthn key (uncompressed, 65 bytes):\", result.publicKey);\n\n        // Nén khóa thành 33 bytes\n        const compressedKeyBuffer = compressPublicKey(uncompressedKeyBuffer);\n        console.log(\"WebAuthn key (compressed, 33 bytes):\", compressedKeyBuffer.toString('hex'));\n\n        // Nối tất cả lại với nhau\n        const addGuardianData = concatUint8Arrays(addGuardianDiscriminator,\n        // guardian_id (u64)\n        bufferToUint8Array(Buffer.from(guardianIdBigIntBytes)),\n        // guardian_name (string)\n        bufferToUint8Array(guardianNameLenBuffer), bufferToUint8Array(guardianNameBuffer),\n        // recovery_hash_intermediate ([u8; 32])\n        recoveryHashIntermediateBytes,\n        // is_owner (bool)\n        isOwnerByte,\n        // webauthn_pubkey (Option<[u8; 33]>)\n        new Uint8Array([1]),\n        // Some variant\n        bufferToUint8Array(compressedKeyBuffer) // Sử dụng khóa đã được nén\n        );\n\n        // Tạo transaction add guardian\n        const addGuardianTransaction = new Transaction();\n        addGuardianTransaction.add(new TransactionInstruction({\n          keys: [{\n            pubkey: multisigPDA,\n            isSigner: false,\n            isWritable: true\n          }, {\n            pubkey: guardianPDA,\n            isSigner: false,\n            isWritable: true\n          }, {\n            pubkey: projectFeePayerKeypair.publicKey,\n            isSigner: false,\n            isWritable: false\n          }, {\n            pubkey: projectFeePayerKeypair.publicKey,\n            isSigner: true,\n            isWritable: true\n          }, {\n            pubkey: SystemProgram.programId,\n            isSigner: false,\n            isWritable: false\n          }],\n          programId: PROGRAM_ID,\n          data: Buffer.from(addGuardianData)\n        }));\n\n        // Sign và gửi transaction\n        addGuardianTransaction.feePayer = projectFeePayerKeypair.publicKey;\n        addGuardianTransaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n        const addGuardianSignature = await connection.sendTransaction(addGuardianTransaction, [projectFeePayerKeypair]);\n        await connection.confirmTransaction(addGuardianSignature);\n        setTransactionStatus(prev => prev + `\\nGuardian owner đã được thêm thành công! Signature: ${addGuardianSignature}`);\n      } catch (error) {\n        console.error(\"Lỗi khi thêm guardian owner:\", error);\n        setTransactionStatus(prev => prev + `\\nLỗi khi thêm guardian owner: ${error.message}`);\n      }\n\n      // 6. Hoàn thành quá trình tạo ví\n      setTransactionStatus(prev => prev + '\\n\\n✅ VÍ MOON WALLET ĐÃ ĐƯỢC TẠO THÀNH CÔNG!\\n' + `Địa chỉ ví Multisig: ${multisigPDA.toString()}\\n` + `Recovery Phrase: ${recoveryPhrase}\\n` + 'Vui lòng lưu lại thông tin này để sử dụng sau này!');\n\n      // Kiểm tra số dư của ví PDA sau khi tạo\n      await loadPdaBalance(multisigPDA);\n    } catch (error) {\n      console.error('Lỗi trong quá trình tạo ví:', error);\n      setTransactionStatus(`Lỗi: ${error.message}`);\n    }\n  };\n  const loadPdaBalance = async address => {\n    try {\n      const balance = await connection.getBalance(address);\n      setPdaBalance(balance / LAMPORTS_PER_SOL);\n    } catch (error) {\n      setPdaBalance(0);\n    }\n  };\n  const getGuardianPda = guardianId => {\n    if (!multisigAddress) return null;\n    const [guardianPda] = PublicKey.findProgramAddressSync([Buffer.from('guardian'), multisigAddress.toBuffer(), Buffer.from(guardianId.toString())], PROGRAM_ID);\n    return guardianPda;\n  };\n  const checkGuardianExists = async guardianId => {\n    const guardianPda = getGuardianPda(guardianId);\n    if (!guardianPda) return false;\n    try {\n      const accountInfo = await connection.getAccountInfo(guardianPda);\n      return accountInfo !== null;\n    } catch (error) {\n      return false;\n    }\n  };\n\n  // Hàm để lấy danh sách guardian ID hiện có\n  const getGuardianIdsList = async () => {\n    if (!multisigAddress) return [];\n    try {\n      const existingIds = [];\n      for (let i = 1; i <= 8; i++) {\n        if (await checkGuardianExists(i)) {\n          existingIds.push(i);\n        }\n      }\n      return existingIds;\n    } catch (error) {\n      console.error(\"Lỗi khi lấy danh sách guardian:\", error);\n      return [];\n    }\n  };\n  const findGuardianAddress = async (guardianId = 1) => {\n    if (!multisigAddress) return null;\n    try {\n      const guardianIdBigInt = BigInt(guardianId);\n      const guardianIdBytes = bigIntToLeBytes(guardianIdBigInt);\n\n      // Tính PDA cho guardian trực tiếp từ multisigAddress\n      const [guardianPDA] = PublicKey.findProgramAddressSync([Buffer.from(\"guardian\"), multisigAddress.toBuffer(), guardianIdBytes], PROGRAM_ID);\n      if (guardianId === 1) {\n        setGuardianPDA(guardianPDA); // Chỉ set state cho guardian chính (ID=1)\n      }\n      return guardianPDA;\n    } catch (error) {\n      console.error(`Lỗi khi tính PDA cho guardian ID ${guardianId}:`, error);\n      return null;\n    }\n  };\n\n  // Airdrop SOL cho testing\n  const requestAirdrop = async () => {\n    if (!projectFeePayerKeypair) {\n      setTransactionStatus('Không tìm thấy fee payer của dự án.');\n      return;\n    }\n    try {\n      setTransactionStatus('Đang yêu cầu airdrop cho fee payer của dự án...');\n      const signature = await connection.requestAirdrop(projectFeePayerKeypair.publicKey, 2000000000 // 2 SOL\n      );\n      await connection.confirmTransaction(signature);\n      // Tải lại số dư của fee payer\n      await loadFeePayerBalance(projectFeePayerKeypair);\n      setTransactionStatus('Airdrop thành công! 2 SOL đã được thêm vào ví fee payer của dự án.');\n    } catch (error) {\n      console.error('Lỗi khi thực hiện airdrop:', error);\n      setTransactionStatus(`Lỗi airdrop: ${error.message}. Đang thử phương thức chuyển tiền trực tiếp...`);\n\n      // Thử phương pháp khác nếu airdrop thất bại\n      fundFromValidator(projectFeePayerKeypair);\n    }\n  };\n  const fundFromValidator = async keypair => {\n    try {\n      setTransactionStatus('Đang chuyển tiền từ validator vào fee payer...');\n\n      // Tạo kết nối với validator wallet (địa chỉ mặc định của validator)\n      const validatorKey = new PublicKey('E6mJJmCvg4PDhanmaBxxeyTczza9vKpMgirRUD6Qz5kv');\n\n      // Tạo transaction chuyển tiền\n      const transaction = new Transaction().add(SystemProgram.transfer({\n        fromPubkey: validatorKey,\n        toPubkey: keypair.publicKey,\n        lamports: 2000000000 // 2 SOL\n      }));\n\n      // Lấy các thông tin cần thiết cho transaction\n      transaction.feePayer = validatorKey;\n      transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n\n      // Không thể ký transaction vì không có private key của validator\n      // Thay vào đó, sử dụng phương thức sendTransactionWithRetry không cần chữ ký\n      const signature = await connection.sendTransaction(transaction, [] // Không cần signers khi gửi đến validator local\n      );\n      await connection.confirmTransaction(signature);\n\n      // Tải lại số dư\n      if (keypair === projectFeePayerKeypair) {\n        await loadFeePayerBalance(keypair);\n        setTransactionStatus('Chuyển tiền thành công! 2 SOL đã được thêm vào ví fee payer của dự án.');\n      } else {\n        await loadBalance(keypair);\n        setTransactionStatus('Chuyển tiền thành công! 2 SOL đã được thêm vào ví.');\n      }\n    } catch (error) {\n      console.error('Lỗi khi chuyển tiền từ validator:', error);\n      setTransactionStatus(`Lỗi khi chuyển tiền: ${error.message}. Hãy thử khởi động lại validator.`);\n    }\n  };\n  const getWalletInfo = async () => {\n    if (!multisigAddress) return;\n    try {\n      setTransactionStatus('Đang truy vấn thông tin ví...');\n\n      // Load balance trước\n      await loadPdaBalance(multisigAddress);\n      const multisigAccount = await connection.getAccountInfo(multisigAddress);\n      if (!multisigAccount) {\n        setTransactionStatus('Ví chưa được khởi tạo');\n        return;\n      }\n      const data = multisigAccount.data.slice(8);\n      const threshold = data[0];\n      const guardian_count = data[1];\n      const recovery_nonce = new DataView(data.buffer, data.byteOffset + 2, 8).getBigUint64(0, true);\n      const bump = data[10];\n      const transaction_nonce = new DataView(data.buffer, data.byteOffset + 11, 8).getBigUint64(0, true);\n      const last_transaction_timestamp = new DataView(data.buffer, data.byteOffset + 19, 8).getBigInt64(0, true);\n\n      // Hiển thị thông tin\n      setTransactionStatus(`Thông tin ví:\\n` + `- Threshold: ${threshold}\\n` + `- Guardian Count: ${guardian_count}\\n` + `- Recovery Nonce: ${recovery_nonce}\\n` + `- Bump: ${bump}\\n` + `- Transaction Nonce: ${transaction_nonce}\\n` + `- Last Transaction Timestamp: ${last_transaction_timestamp}`);\n    } catch (error) {\n      console.error('Lỗi khi truy vấn thông tin ví:', error);\n      setTransactionStatus(`Lỗi: ${error.message}`);\n    }\n  };\n\n  // Xem thông tin guardian\n  const getGuardianInfo = async () => {\n    if (!multisigAddress) {\n      setTransactionStatus('Vui lòng tạo ví trước khi xem thông tin guardian');\n      return;\n    }\n    try {\n      setTransactionStatus(`Đang truy vấn thông tin guardian ID=${selectedGuardianId}...`);\n\n      // Tính guardian PDA dựa trên ID được chọn\n      const guardianPDA = await findGuardianAddress(selectedGuardianId);\n      if (!guardianPDA) {\n        setTransactionStatus('Không thể tìm thấy địa chỉ Guardian');\n        return;\n      }\n      console.log(`Đang truy vấn thông tin guardian ID=${selectedGuardianId} với PDA: ${guardianPDA.toString()}`);\n      const guardianAccount = await connection.getAccountInfo(guardianPDA);\n      if (!guardianAccount) {\n        console.log(`Không tìm thấy thông tin account tại địa chỉ: ${guardianPDA.toString()}`);\n        setTransactionStatus(`Guardian với ID=${selectedGuardianId} chưa được khởi tạo hoặc không tồn tại`);\n        return;\n      }\n      console.log(`Đã tìm thấy account tại địa chỉ: ${guardianPDA.toString()}`);\n      console.log(`Data size: ${guardianAccount.data.length} bytes`);\n      console.log(`Owner: ${guardianAccount.owner.toString()}`);\n\n      // Kiểm tra xem account có thuộc về program của chúng ta không\n      if (!guardianAccount.owner.equals(PROGRAM_ID)) {\n        console.error(`Account không thuộc về program của chúng ta. Owner: ${guardianAccount.owner.toString()}`);\n        setTransactionStatus(`Guardian với ID=${selectedGuardianId} không thuộc về program của chúng ta`);\n        return;\n      }\n\n      // Bỏ qua 8 byte discriminator\n      const data = guardianAccount.data.slice(8);\n      console.log(`Data sau khi bỏ qua discriminator: ${data.length} bytes`);\n      console.log(`Raw data: ${Buffer.from(data).toString('hex').substring(0, 100)}...`);\n      try {\n        // Đọc wallet address (32 bytes)\n        const walletBytes = data.slice(0, 32);\n        const wallet = new PublicKey(walletBytes);\n        console.log(`Wallet address parsed: ${wallet.toString()}`);\n\n        // Đọc guardian_id (8 bytes - u64)\n        const guardianIdBytes = data.slice(32, 40);\n        let guardianId = BigInt(0);\n        for (let i = 0; i < 8; i++) {\n          guardianId |= BigInt(guardianIdBytes[i]) << BigInt(8 * i);\n        }\n        console.log(`Guardian ID parsed: ${guardianId}`);\n\n        // Đọc name (string dài tối đa 32 bytes)\n        const nameLength = new DataView(data.buffer, data.byteOffset + 40, 4).getUint32(0, true);\n        console.log(`Guardian name length: ${nameLength}`);\n        if (nameLength > 100) {\n          console.error(`Name length quá lớn: ${nameLength}, có thể không đúng cấu trúc dữ liệu`);\n          throw new Error(\"Lỗi parse dữ liệu guardian: Name length không hợp lệ\");\n        }\n\n        // Vị trí bắt đầu của name bytes\n        const nameOffset = 44;\n        const nameBytes = data.slice(nameOffset, nameOffset + nameLength);\n        const name = new TextDecoder().decode(nameBytes);\n        console.log(`Guardian name parsed: ${name}`);\n\n        // Vị trí tiếp theo sau name\n        let currentOffset = nameOffset + nameLength;\n\n        // Đọc is_active (1 byte)\n        const isActive = data[currentOffset] === 1;\n        console.log(`Is active byte: ${data[currentOffset]} (offset: ${currentOffset})`);\n        currentOffset += 1;\n\n        // Đọc recovery_hash (32 bytes)\n        const recoveryHash = data.slice(currentOffset, currentOffset + 32);\n        const recoveryHashHex = Buffer.from(recoveryHash).toString('hex');\n        console.log(`Recovery hash (hex): ${recoveryHashHex} (offset: ${currentOffset})`);\n        currentOffset += 32;\n\n        // Đọc is_owner (1 byte)\n        const isOwner = data[currentOffset] === 1;\n        console.log(`Is owner byte: ${data[currentOffset]} (offset: ${currentOffset})`);\n        currentOffset += 1;\n\n        // Đọc webauthn_pubkey (option, 1 byte discriminator + 33 bytes if Some)\n        const hasWebauthn = data[currentOffset] === 1;\n        console.log(`Has webauthn byte: ${data[currentOffset]} (offset: ${currentOffset})`);\n        currentOffset += 1;\n        let webauthnPubkey = null;\n        if (hasWebauthn) {\n          webauthnPubkey = data.slice(currentOffset, currentOffset + 33);\n          const webauthnHex = Buffer.from(webauthnPubkey).toString('hex');\n          console.log(`WebAuthn pubkey: ${webauthnHex} (offset: ${currentOffset})`);\n          // Log thêm thông tin về format của key\n          console.log(`WebAuthn key format byte: 0x${webauthnHex.slice(0, 2)} (${webauthnPubkey[0]})`);\n          currentOffset += 33;\n        }\n\n        // Đọc bump (1 byte)\n        const bump = data[currentOffset];\n        console.log(`Bump: ${bump} (offset: ${currentOffset})`);\n\n        // Hiển thị thông tin\n        setTransactionStatus(`Thông tin Guardian (ID=${guardianId}):\\n` + `- Loại Guardian: ${isOwner ? 'Owner (Quản trị viên)' : 'Regular (Thành viên)'}\\n` + `- Wallet: ${wallet.toString()}\\n` + `- Guardian ID: ${guardianId}\\n` + `- Name: ${name}\\n` + `- Active: ${isActive ? 'Có' : 'Không'}\\n` + `- Recovery Hash: ${recoveryHashHex.slice(0, 10)}...${recoveryHashHex.slice(-10)}\\n` + (hasWebauthn ? `- WebAuthn Key: ${Buffer.from(webauthnPubkey).toString('hex')}\\n` : '') + (hasWebauthn ? `- WebAuthn Key Format: ${webauthnPubkey[0] === 2 ? '02 (even y)' : webauthnPubkey[0] === 3 ? '03 (odd y)' : webauthnPubkey[0].toString()}\\n` : '') + (hasWebauthn ? `- Công dụng: ${isOwner ? 'Dùng để ký giao dịch và quản lý ví' : 'Dùng để xác thực từ thiết bị này'}\\n` : '') + `- Bump: ${bump}\\n` + `- PDA: ${guardianPDA.toString()}`);\n      } catch (parseError) {\n        console.error(\"Lỗi khi parse dữ liệu guardian:\", parseError);\n\n        // Hiển thị thông tin thô nếu không thể parse\n        setTransactionStatus(`Không thể parse dữ liệu guardian chi tiết. Dữ liệu thô:\\n` + `- PDA: ${guardianPDA.toString()}\\n` + `- Data size: ${guardianAccount.data.length} bytes\\n` + `- Raw data: ${Buffer.from(guardianAccount.data).toString('hex').substring(0, 100)}...\\n` + `- Error: ${parseError}`);\n      }\n    } catch (error) {\n      console.error('Lỗi khi truy vấn thông tin guardian:', error);\n      setTransactionStatus(`Lỗi: ${error.message}`);\n    }\n  };\n\n  // Hàm để lấy danh sách guardian ID hiện có\n  const getExistingGuardianIds = async () => {\n    if (!multisigAddress) return [];\n    try {\n      setTransactionStatus('Đang kiểm tra danh sách Guardian ID...');\n      const guardianIds = [];\n\n      // Kiểm tra guardian từ ID 1 đến 8\n      for (let i = 1; i <= 8; i++) {\n        try {\n          // Tính PDA cho guardian với ID i sử dụng hàm đã sửa\n          const guardianPDA = await findGuardianAddress(i);\n          if (!guardianPDA) {\n            console.log(`Guardian ID ${i}: Không tính được PDA`);\n            continue;\n          }\n\n          // Kiểm tra xem guardian với ID này có tồn tại không\n          console.log(`Đang kiểm tra Guardian ID ${i} tại địa chỉ: ${guardianPDA.toString()}`);\n          const guardianAccount = await connection.getAccountInfo(guardianPDA);\n          if (guardianAccount) {\n            guardianIds.push(i);\n            console.log(`Guardian ID ${i} đã tồn tại - PDA: ${guardianPDA.toString()}`);\n            console.log(`  - Owner: ${guardianAccount.owner.toString()}`);\n            console.log(`  - Data size: ${guardianAccount.data.length} bytes`);\n\n            // Kiểm tra discriminator (8 bytes đầu)\n            const discriminator = guardianAccount.data.slice(0, 8);\n            console.log(`  - Discriminator: ${Buffer.from(discriminator).toString('hex')}`);\n          } else {\n            console.log(`Guardian ID ${i}: Account không tồn tại tại địa chỉ ${guardianPDA.toString()}`);\n          }\n        } catch (error) {\n          console.error(`Lỗi khi kiểm tra guardian ID ${i}:`, error);\n        }\n      }\n      console.log(\"Danh sách guardian ID hiện tại:\", guardianIds);\n\n      // Nếu không có guardian nào, thêm ID 1 vào danh sách để có thể chọn\n      if (guardianIds.length === 0) {\n        guardianIds.push(1);\n        console.log(\"Không tìm thấy guardian nào, thêm ID 1 mặc định vào danh sách\");\n      }\n      setExistingGuardians(guardianIds);\n\n      // Đảm bảo selectedGuardianId nằm trong danh sách các ID hiện có\n      if (!guardianIds.includes(selectedGuardianId)) {\n        console.log(`Selected Guardian ID ${selectedGuardianId} không tồn tại, chuyển sang ID ${guardianIds[0]}`);\n        setSelectedGuardianId(guardianIds[0]);\n      }\n      setTransactionStatus(`Đã tìm thấy ${guardianIds.length} guardian. IDs: ${guardianIds.join(', ')}`);\n      return guardianIds;\n    } catch (error) {\n      console.error(\"Lỗi khi lấy danh sách guardian:\", error);\n      return [];\n    }\n  };\n\n  // Hàm sinh guardian ID mới không bị trùng\n  const generateNewGuardianId = existingIds => {\n    // Nếu không có ID nào tồn tại, bắt đầu từ 2 (vì ID 1 thường là owner)\n    if (existingIds.length === 0) return 2;\n\n    // Tìm ID nhỏ nhất không bị trùng\n    let newId = 1;\n    while (existingIds.includes(newId)) {\n      newId++;\n    }\n    return newId;\n  };\n\n  // Hàm thêm guardian mới với chữ ký WebAuthn riêng\n  const addNewGuardian = async () => {\n    try {\n      // Kiểm tra xem ví đã được tạo chưa\n      if (!multisigAddress) {\n        setTransactionStatus('Vui lòng tạo ví trước khi thêm guardian.');\n        return;\n      }\n\n      // Kiểm tra xem có fee payer hay không\n      if (!projectFeePayerKeypair) {\n        setTransactionStatus('Không tìm thấy fee payer của dự án. Vui lòng thử lại sau.');\n        return;\n      }\n\n      // Kiểm tra các trường bắt buộc\n      if (!newGuardianName || !newRecoveryPhrase || newRecoveryPhrase.length < 8) {\n        setTransactionStatus('Vui lòng nhập tên guardian và recovery phrase (ít nhất 8 ký tự).');\n        return;\n      }\n      setTransactionStatus('Đang thêm guardian mới...\\n\\nBước 1: Tạo khóa WebAuthn cho guardian mới...');\n\n      // Lấy danh sách guardian ID hiện tại\n      const existingIds = await getExistingGuardianIds();\n\n      // Sinh guardian ID mới không bị trùng\n      const newGuardianId = generateNewGuardianId(existingIds);\n      console.log(\"=== ADD GUARDIAN === Guardian ID mới được sinh:\", newGuardianId);\n\n      // 1. Tạo khóa WebAuthn cho guardian mới\n      try {\n        // Sử dụng một định danh duy nhất cho khóa mới\n        const guardianIdentifier = `${multisigAddress === null || multisigAddress === void 0 ? void 0 : multisigAddress.toString()}_guardian_${newGuardianId}`;\n        const webAuthnResult = await createWebAuthnCredential(guardianIdentifier, newGuardianName);\n\n        // Log thông tin WebAuthn\n        console.log(\"=== ADD GUARDIAN === WebAuthn credential mới đã được tạo:\");\n        console.log(\"=== ADD GUARDIAN === Credential ID:\", webAuthnResult.credentialId);\n        console.log(\"=== ADD GUARDIAN === Public Key:\", webAuthnResult.publicKey);\n        setTransactionStatus(prev => prev + `\\nĐã tạo khóa WebAuthn thành công!`);\n\n        // 2. Tính PDA cho guardian mới\n        const guardianPDA = await findGuardianAddress(newGuardianId);\n        if (!guardianPDA) {\n          setTransactionStatus('Không thể tính PDA cho guardian mới.');\n          return;\n        }\n        console.log(\"=== ADD GUARDIAN === Guardian PDA mới:\", guardianPDA.toString());\n\n        // Kiểm tra trước xem guardian account đã tồn tại chưa\n        const existingGuardian = await connection.getAccountInfo(guardianPDA);\n        if (existingGuardian) {\n          console.log(\"=== ADD GUARDIAN === Guardian account đã tồn tại!\", existingGuardian);\n          setTransactionStatus(`Guardian với ID=${newGuardianId} đã tồn tại rồi. Hãy chọn ID khác.`);\n          return;\n        }\n\n        // 3. Hash recovery phrase\n        const hashedRecoveryBytes = await hashRecoveryPhrase(newRecoveryPhrase);\n        console.log(\"=== ADD GUARDIAN === Recovery phrase sau khi hash:\", Buffer.from(hashedRecoveryBytes).toString('hex'));\n\n        // 4. Chuyển đổi guardian ID thành bytes (little-endian)\n        const guardianIdBigInt = BigInt(newGuardianId);\n        const guardianIdBytes = bigIntToLeBytes(guardianIdBigInt);\n\n        // 5. Nén khóa WebAuthn từ 65 bytes (uncompressed) thành 33 bytes (compressed)\n        const uncompressedKeyBuffer = Buffer.from(webAuthnResult.publicKey, 'hex');\n        console.log(\"=== ADD GUARDIAN === WebAuthn key (uncompressed, 65 bytes):\", webAuthnResult.publicKey);\n\n        // Nén khóa thành 33 bytes\n        const compressedKeyBuffer = compressPublicKey(uncompressedKeyBuffer);\n        console.log(\"=== ADD GUARDIAN === WebAuthn key (compressed, 33 bytes):\", compressedKeyBuffer.toString('hex'));\n\n        // 6. Tạo discriminator cho add_guardian\n        const addGuardianDiscriminator = new Uint8Array([167, 189, 170, 27, 74, 240, 201, 241]);\n\n        // 7. Chuẩn bị tên guardian\n        const guardianNameBuffer = Buffer.from(newGuardianName);\n        const guardianNameLenBuffer = Buffer.alloc(4);\n        guardianNameLenBuffer.writeUInt32LE(guardianNameBuffer.length, 0);\n\n        // 8. Đặt is_owner = false vì đây là guardian member, không phải owner\n        const isOwnerByte = new Uint8Array([0]); // false = 0\n\n        // 9. Cấu hình webauthn_pubkey là Some(compressed_key)\n        const hasWebauthn = new Uint8Array([1]); // Some variant\n\n        // 10. Tạo dữ liệu instruction\n        const addGuardianData = concatUint8Arrays(addGuardianDiscriminator,\n        // guardian_id (u64)\n        bufferToUint8Array(Buffer.from(guardianIdBytes)),\n        // guardian_name (string)\n        bufferToUint8Array(guardianNameLenBuffer), bufferToUint8Array(guardianNameBuffer),\n        // recovery_hash_intermediate ([u8; 32])\n        hashedRecoveryBytes,\n        // is_owner (bool)\n        isOwnerByte,\n        // webauthn_pubkey (Option<[u8; 33]>) - Some variant + compressed key\n        hasWebauthn, bufferToUint8Array(compressedKeyBuffer));\n\n        // Log dữ liệu instruction để debug\n        console.log(\"=== ADD GUARDIAN === Dữ liệu instruction:\", {\n          discriminator: Buffer.from(addGuardianDiscriminator).toString('hex'),\n          guardianId: newGuardianId.toString(),\n          guardianIdBytes: Buffer.from(guardianIdBytes).toString('hex'),\n          nameLength: guardianNameBuffer.length,\n          name: newGuardianName,\n          recoveryHashHex: Buffer.from(hashedRecoveryBytes).toString('hex'),\n          isOwner: false,\n          hasWebauthn: true,\n          webauthnPubkey: compressedKeyBuffer.toString('hex')\n        });\n        setTransactionStatus(prev => prev + `\\n\\nBước 2: Đang thêm guardian vào blockchain...`);\n\n        // 11. Tạo transaction add guardian\n        const addGuardianTransaction = new Transaction();\n        addGuardianTransaction.add(new TransactionInstruction({\n          keys: [{\n            pubkey: multisigAddress,\n            isSigner: false,\n            isWritable: true\n          }, {\n            pubkey: guardianPDA,\n            isSigner: false,\n            isWritable: true\n          }, {\n            pubkey: projectFeePayerKeypair.publicKey,\n            isSigner: false,\n            isWritable: false\n          }, {\n            pubkey: projectFeePayerKeypair.publicKey,\n            isSigner: true,\n            isWritable: true\n          }, {\n            pubkey: SystemProgram.programId,\n            isSigner: false,\n            isWritable: false\n          }],\n          programId: PROGRAM_ID,\n          data: Buffer.from(addGuardianData)\n        }));\n\n        // Sign và gửi transaction với fee payer của dự án\n        addGuardianTransaction.feePayer = projectFeePayerKeypair.publicKey;\n        addGuardianTransaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n        console.log(\"=== ADD GUARDIAN === Đang gửi transaction...\");\n        const addGuardianSignature = await connection.sendTransaction(addGuardianTransaction, [projectFeePayerKeypair]);\n        console.log(\"=== ADD GUARDIAN === Transaction đã gửi. Signature:\", addGuardianSignature);\n        setTransactionStatus(prev => prev + `\\nĐang xác nhận transaction thêm guardian...`);\n        await connection.confirmTransaction(addGuardianSignature);\n        setTransactionStatus(`Guardian mới đã được thêm thành công với ID: ${newGuardianId}!\\n` + `Chữ ký WebAuthn đã được lưu cho guardian này.\\n` + `Signature: ${addGuardianSignature}`);\n\n        // Kiểm tra xem guardian đã được thêm thành công chưa\n        console.log(\"=== ADD GUARDIAN === Đang kiểm tra guardian vừa thêm...\");\n        await new Promise(resolve => setTimeout(resolve, 2000)); // Đợi 2 giây\n\n        const newGuardianAccount = await connection.getAccountInfo(guardianPDA);\n        if (newGuardianAccount) {\n          console.log(\"=== ADD GUARDIAN === Guardian đã được thêm thành công!\");\n          console.log(`=== ADD GUARDIAN === Data size: ${newGuardianAccount.data.length} bytes`);\n\n          // Kiểm tra discriminator\n          const discriminator = newGuardianAccount.data.slice(0, 8);\n          console.log(`=== ADD GUARDIAN === Discriminator: ${Buffer.from(discriminator).toString('hex')}`);\n        } else {\n          console.log(\"=== ADD GUARDIAN === Guardian không được tìm thấy sau khi thêm!\");\n          setTransactionStatus(prev => prev + '\\n\\nCẢNH BÁO: Guardian có vẻ như chưa được khởi tạo trên blockchain mặc dù transaction đã thành công!');\n        }\n\n        // Cập nhật danh sách guardian\n        await getExistingGuardianIds();\n\n        // Cập nhật số dư của ví PDA\n        await loadPdaBalance(multisigAddress);\n\n        // Reset form\n        setNewGuardianName('');\n        setNewRecoveryPhrase('');\n      } catch (webAuthnError) {\n        console.error(\"=== ADD GUARDIAN === Lỗi khi tạo khóa WebAuthn:\", webAuthnError);\n        setTransactionStatus(`Lỗi khi tạo khóa WebAuthn: ${webAuthnError.message || 'Không xác định'}. Vui lòng thử lại.`);\n        return;\n      }\n    } catch (error) {\n      console.error(\"=== ADD GUARDIAN === Lỗi khi thêm guardian mới:\", error);\n      setTransactionStatus(`Lỗi khi thêm guardian mới: ${error.message}`);\n    }\n  };\n\n  // Hàm để nạp SOL vào ví multisig\n  const depositToMultisig = async () => {\n    try {\n      // Kiểm tra xem ví đã được tạo chưa\n      if (!multisigAddress) {\n        setTransactionStatus('Vui lòng tạo ví trước khi nạp tiền.');\n        return;\n      }\n\n      // Kiểm tra xem có fee payer hay không\n      if (!projectFeePayerKeypair) {\n        setTransactionStatus('Không tìm thấy fee payer của dự án. Vui lòng thử lại sau.');\n        return;\n      }\n\n      // Kiểm tra số tiền hợp lệ\n      if (!depositAmount || depositAmount <= 0) {\n        setTransactionStatus('Vui lòng nhập số tiền hợp lệ để nạp.');\n        return;\n      }\n\n      // Kiểm tra số dư của fee payer\n      const feePayerBalance = await connection.getBalance(projectFeePayerKeypair.publicKey);\n      const lamportsToSend = depositAmount * LAMPORTS_PER_SOL;\n      if (feePayerBalance < lamportsToSend + 5000) {\n        // 5000 lamports cho phí giao dịch\n        setTransactionStatus(`Số dư fee payer không đủ. Hiện tại: ${feePayerBalance / LAMPORTS_PER_SOL} SOL`);\n        return;\n      }\n      setTransactionStatus(`Đang nạp ${depositAmount} SOL vào ví...`);\n\n      // Tạo transaction chuyển tiền\n      const transaction = new Transaction().add(SystemProgram.transfer({\n        fromPubkey: projectFeePayerKeypair.publicKey,\n        toPubkey: multisigAddress,\n        lamports: lamportsToSend\n      }));\n\n      // Cấu hình transaction\n      transaction.feePayer = projectFeePayerKeypair.publicKey;\n      transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n\n      // Ký và gửi transaction\n      const signature = await connection.sendTransaction(transaction, [projectFeePayerKeypair]);\n      await connection.confirmTransaction(signature);\n\n      // Cập nhật số dư\n      await loadPdaBalance(multisigAddress);\n      await loadFeePayerBalance(projectFeePayerKeypair);\n      setTransactionStatus(`Đã nạp thành công ${depositAmount} SOL vào ví! Signature: ${signature}`);\n    } catch (error) {\n      console.error('Lỗi khi nạp tiền vào ví:', error);\n      setTransactionStatus(`Lỗi khi nạp tiền: ${error.message}`);\n    }\n  };\n\n  // Tự động cập nhật danh sách guardians khi multisigAddress thay đổi\n  useEffect(() => {\n    if (multisigAddress) {\n      // Load lại danh sách guardian IDs\n      getExistingGuardianIds();\n\n      // Load số dư của PDA\n      loadPdaBalance(multisigAddress);\n    }\n  }, [multisigAddress]);\n\n  // Hàm để kiểm tra guardian ID cụ thể\n  const testGuardianInfo = async id => {\n    if (!multisigAddress) {\n      setTransactionStatus('Ví chưa được khởi tạo');\n      return;\n    }\n    setTransactionStatus(`Đang kiểm tra chi tiết Guardian ID ${id}...`);\n    try {\n      // Tính PDA \n      const guardianPDA = await findGuardianAddress(id);\n      if (!guardianPDA) {\n        setTransactionStatus(`Không thể tính PDA cho Guardian ID ${id}`);\n        return;\n      }\n      console.log(`=== TEST === Đang kiểm tra chi tiết Guardian ID ${id} tại ${guardianPDA.toString()}`);\n      const guardianAccount = await connection.getAccountInfo(guardianPDA);\n      if (!guardianAccount) {\n        console.log(`=== TEST === Account không tồn tại tại địa chỉ ${guardianPDA.toString()}`);\n        setTransactionStatus(`Guardian ID ${id} không tồn tại trên blockchain`);\n        return;\n      }\n      console.log(`=== TEST === Account tồn tại!`);\n      console.log(`=== TEST === Owner: ${guardianAccount.owner.toString()}`);\n      console.log(`=== TEST === Data size: ${guardianAccount.data.length} bytes`);\n\n      // Kiểm tra discriminator\n      const discriminator = guardianAccount.data.slice(0, 8);\n      console.log(`=== TEST === Discriminator: ${Buffer.from(discriminator).toString('hex')}`);\n\n      // Bỏ qua 8 byte discriminator\n      const data = guardianAccount.data.slice(8);\n      try {\n        // Wallet (32 bytes)\n        const walletBytes = data.slice(0, 32);\n        const wallet = new PublicKey(walletBytes);\n        console.log(`=== TEST === Wallet: ${wallet.toString()}`);\n\n        // Guardian ID (8 bytes)\n        const guardianIdBytes = data.slice(32, 40);\n        let guardianId = BigInt(0);\n        for (let i = 0; i < 8; i++) {\n          guardianId |= BigInt(guardianIdBytes[i]) << BigInt(8 * i);\n        }\n        console.log(`=== TEST === Guardian ID parsed: ${guardianId}`);\n\n        // Name\n        const nameLength = new DataView(data.buffer, data.byteOffset + 40, 4).getUint32(0, true);\n        console.log(`=== TEST === Name length: ${nameLength}`);\n\n        // Nếu name length hợp lệ, tiếp tục parse\n        if (nameLength <= 100) {\n          const nameBytes = data.slice(44, 44 + nameLength);\n          const name = new TextDecoder().decode(nameBytes);\n          console.log(`=== TEST === Name: ${name}`);\n          setTransactionStatus(`Guardian ID ${id} tồn tại!\\n- PDA: ${guardianPDA.toString()}\\n- Wallet: ${wallet.toString()}\\n- Name: ${name}\\n- Guardian ID: ${guardianId}`);\n        } else {\n          console.log(`=== TEST === Name length không hợp lệ`);\n          setTransactionStatus(`Guardian ID ${id} tồn tại nhưng có cấu trúc dữ liệu không hợp lệ`);\n        }\n      } catch (parseError) {\n        console.error(`=== TEST === Lỗi khi parse dữ liệu:`, parseError);\n        setTransactionStatus(`Guardian ID ${id} tồn tại nhưng không thể parse dữ liệu: ${parseError}`);\n      }\n    } catch (error) {\n      console.error(`=== TEST === Lỗi:`, error);\n      setTransactionStatus(`Lỗi khi kiểm tra: ${error.message}`);\n    }\n  };\n\n  // Hàm đăng nhập vào ví đã tạo\n  const loginToWallet = async () => {\n    try {\n      setIsLoggingIn(true);\n      setTransactionStatus('Đang đăng nhập vào ví...\\n\\nBước 1: Đang yêu cầu xác thực WebAuthn...');\n\n      // 1. Yêu cầu người dùng xác thực với thiết bị (không cần nhập credential ID cụ thể)\n      try {\n        // Gọi hàm getWebAuthnAssertionForLogin với allowEmpty=true để cho phép người dùng chọn từ bất kỳ credential nào\n        const assertionResult = await getWebAuthnAssertionForLogin('', true);\n        if (!assertionResult.success || !assertionResult.rawId) {\n          throw new Error(assertionResult.error || 'Không thể xác thực với thiết bị');\n        }\n\n        // Lấy thông tin credential từ phản hồi\n        const credentialRawData = assertionResult.rawId;\n\n        // Chuyển rawId thành hex để sử dụng làm key trong bảng webauthn_credentials\n        const credentialIdHex = Buffer.from(credentialRawData).toString('hex');\n        console.log(\"Credential ID (hex):\", credentialIdHex);\n\n        // Chuyển rawId thành base64 để sử dụng trong blockchain\n        const rawIdBase64 = Buffer.from(credentialRawData).toString('base64');\n        console.log(\"Raw credential ID (base64):\", rawIdBase64);\n        setTransactionStatus(prev => prev + '\\nXác thực WebAuthn thành công!\\n\\nBước 2: Đang tìm thông tin ví...');\n\n        // 2. Truy vấn thông tin ví từ bảng webauthn_credentials\n        const credentialMapping = await getWalletByCredentialId(credentialIdHex);\n        if (credentialMapping) {\n          // Nếu tìm thấy trong bảng ánh xạ\n          setTransactionStatus(prev => prev + `\\nĐã tìm thấy thông tin ví trong database!`);\n\n          // Chuyển đổi từ chuỗi sang PublicKey\n          const walletAddressFromDB = new PublicKey(credentialMapping.walletAddress);\n          console.log(\"Wallet address from database:\", walletAddressFromDB.toString());\n\n          // 3. Kiểm tra xem ví có tồn tại trên blockchain không\n          const walletAccount = await connection.getAccountInfo(walletAddressFromDB);\n          if (!walletAccount) {\n            setTransactionStatus(`Ví tìm thấy trong database không tồn tại trên blockchain. Địa chỉ: ${walletAddressFromDB.toString()}`);\n            setIsLoggingIn(false);\n            return;\n          }\n\n          // 4. Cập nhật state với thông tin ví\n          setMultisigAddress(walletAddressFromDB);\n          setCredentialId(rawIdBase64); // Lưu credential ID gốc\n\n          setTransactionStatus(prev => prev + `\\nĐã tìm thấy ví tại địa chỉ: ${walletAddressFromDB.toString()}\\n\\nBước 3: Đang tải thông tin ví...`);\n        } else {\n          // Nếu không tìm thấy trong bảng ánh xạ, sử dụng phương pháp tính toán cũ\n          setTransactionStatus(prev => prev + '\\nKhông tìm thấy thông tin trong database, đang tính toán địa chỉ ví...');\n\n          // Tính địa chỉ ví từ credential ID\n          const multisigPDA = getMultisigPDA(rawIdBase64);\n          console.log(\"Computed Multisig PDA:\", multisigPDA.toString());\n\n          // Kiểm tra xem ví có tồn tại không\n          const walletAccount = await connection.getAccountInfo(multisigPDA);\n          if (!walletAccount) {\n            setTransactionStatus(`Không tìm thấy ví với credential này. Có thể bạn cần tạo ví mới.`);\n            setIsLoggingIn(false);\n            return;\n          }\n          setTransactionStatus(prev => prev + `\\nĐã tìm thấy ví tại địa chỉ: ${multisigPDA.toString()}\\n\\nBước 3: Đang tải thông tin ví...`);\n\n          // Cập nhật state với thông tin ví\n          setMultisigAddress(multisigPDA);\n          setCredentialId(rawIdBase64); // Lưu credential ID gốc\n        }\n\n        // 5. Tìm guardian PDA\n        await findGuardianAddress(1); // Tìm guardian chính (owner)\n\n        // 6. Tải số dư và danh sách guardian\n        await loadPdaBalance(multisigAddress);\n        await getExistingGuardianIds();\n\n        // 7. Hoàn thành đăng nhập\n        setIsLoggedIn(true);\n        setIsLoggingIn(false);\n        setTransactionStatus(`Đăng nhập thành công!\\n\\nĐịa chỉ ví: ${multisigAddress.toString()}\\nSố guardian: ${existingGuardians.length}`);\n\n        // 8. Ẩn form đăng nhập\n        setShowLoginForm(false);\n      } catch (webAuthnError) {\n        console.error(\"Lỗi khi xác thực WebAuthn:\", webAuthnError);\n        setTransactionStatus(`Lỗi khi xác thực: ${webAuthnError.message}`);\n        setIsLoggingIn(false);\n      }\n    } catch (error) {\n      console.error('Lỗi khi đăng nhập:', error);\n      setTransactionStatus(`Lỗi khi đăng nhập: ${error.message}`);\n      setIsLoggingIn(false);\n    }\n  };\n\n  // Hàm tạo mã mời ngẫu nhiên\n  const generateRandomCode = length => {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    const randomValues = new Uint8Array(length);\n    crypto.getRandomValues(randomValues);\n    for (let i = 0; i < length; i++) {\n      result += chars.charAt(randomValues[i] % chars.length);\n    }\n    return result;\n  };\n\n  // Hàm tạo link mời guardian mới\n  const generateGuardianInvite = async () => {\n    try {\n      // Kiểm tra ví đã được tạo chưa\n      if (!multisigAddress) {\n        setTransactionStatus('Vui lòng tạo ví trước khi mời guardian.');\n        return;\n      }\n      const existingIds = await getExistingGuardianIds();\n      const newGuardianId = generateNewGuardianId(existingIds);\n      const inviteCode = generateRandomCode(8);\n      const ngrokUrl = process.env.REACT_APP_NGROK_URL || window.location.origin;\n      const inviteLink = `${ngrokUrl}/#/guardian-signup/${inviteCode}`;\n      setInviteCode(inviteCode);\n      setInviteLink(inviteLink);\n      setShowQRCode(true);\n      try {\n        await saveInvitation({\n          multisigAddress: multisigAddress.toString(),\n          guardianId: newGuardianId,\n          inviteCode,\n          status: 'pending',\n          ownerId: (projectFeePayerKeypair === null || projectFeePayerKeypair === void 0 ? void 0 : projectFeePayerKeypair.publicKey.toString()) || ''\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi lưu vào Firebase:\", error);\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n        setTransactionStatus(`Đã tạo link mời guardian: ${inviteLink}\\nLưu ý: Có lỗi khi lưu thông tin: ${errorMessage}`);\n        return inviteLink;\n      }\n      setTransactionStatus(`Đã tạo link mời guardian: ${inviteLink}`);\n      return inviteLink;\n    } catch (error) {\n      console.error(\"Lỗi khi tạo link mời guardian:\", error);\n      setTransactionStatus(`Lỗi khi tạo link mời guardian: ${error.message}`);\n      return null;\n    }\n  };\n  const loadPendingInvites = async () => {\n    try {\n      if (!projectFeePayerKeypair || !multisigAddress) return;\n      const ownerId = projectFeePayerKeypair.publicKey.toString();\n      // Chỉ lọc guardian của chính ví multisig hiện tại\n      const multisigAddressStr = multisigAddress.toString();\n      const invitesList = await getPendingInvites(ownerId, multisigAddressStr);\n      setPendingInvites(invitesList);\n      if (invitesList.length > 0) {\n        console.log(`Tìm thấy ${invitesList.length} guardian đang chờ hoàn tất cho ví ${multisigAddressStr}. Mã mời: ${invitesList.join(', ')}`);\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi tải danh sách mã mời:\", error);\n    }\n  };\n  useEffect(() => {\n    if (projectFeePayerKeypair && multisigAddress) {\n      loadPendingInvites();\n    }\n  }, [projectFeePayerKeypair, multisigAddress]);\n\n  // Hàm để lấy thông tin guardian đã đăng ký\n  const fetchGuardianDataFromDatabase = async inviteCode => {\n    try {\n      return await getGuardianData(inviteCode);\n    } catch (error) {\n      console.error(\"Lỗi khi lấy dữ liệu guardian:\", error);\n      return null;\n    }\n  };\n\n  // Hàm để lấy thông tin invitation\n  const fetchInviteFromDatabase = async inviteCode => {\n    try {\n      return await getInvitation(inviteCode);\n    } catch (error) {\n      console.error(\"Lỗi khi lấy dữ liệu invite:\", error);\n      return null;\n    }\n  };\n\n  // Hàm để cập nhật trạng thái guardian\n  const updateGuardianStatusInDatabase = async (inviteCode, status, txSignature) => {\n    try {\n      await updateGuardianStatus(inviteCode, status, txSignature);\n    } catch (error) {\n      console.error(\"Lỗi khi cập nhật trạng thái guardian:\", error);\n    }\n  };\n\n  // Hàm kiểm tra thông tin guardians trong database\n  const checkGuardiansInDatabase = async () => {\n    try {\n      setTransactionStatus('Đang kiểm tra dữ liệu guardians từ Firestore...');\n      if (!projectFeePayerKeypair || !multisigAddress) {\n        setTransactionStatus('Cần có thông tin fee payer và multisig address để kiểm tra.');\n        return;\n      }\n      const ownerId = projectFeePayerKeypair.publicKey.toString();\n      const multisigAddressStr = multisigAddress.toString();\n\n      // Lấy danh sách invitations đang chờ CHỈ của ví hiện tại\n      const pendingInvites = await getPendingInvites(ownerId, multisigAddressStr);\n      console.log(`Danh sách mã mời đang chờ cho ví ${multisigAddressStr}:`, pendingInvites);\n      if (pendingInvites.length === 0) {\n        setTransactionStatus(`Không tìm thấy mã mời nào đang chờ xử lý cho ví ${multisigAddressStr}.`);\n        return;\n      }\n\n      // Kiểm tra thông tin từng guardian\n      let resultMessage = 'Thông tin guardians từ database:\\n\\n';\n      for (const inviteCode of pendingInvites) {\n        // Lấy thông tin invitation\n        const inviteData = await getInvitation(inviteCode);\n        if (!inviteData) {\n          resultMessage += `Mã mời ${inviteCode}: Không tìm thấy thông tin invitation.\\n`;\n          continue;\n        }\n\n        // Lấy thông tin guardian\n        const guardianData = await getGuardianData(inviteCode);\n        if (!guardianData) {\n          resultMessage += `Mã mời ${inviteCode}: Invitation tồn tại nhưng chưa có thông tin guardian.\\n`;\n          continue;\n        }\n\n        // Hiển thị thông tin\n        resultMessage += `Mã mời: ${inviteCode}\\n`;\n        resultMessage += `Guardian ID: ${guardianData.guardianId}\\n`;\n        resultMessage += `Tên guardian: ${guardianData.guardianName}\\n`;\n        resultMessage += `Trạng thái: ${guardianData.status}\\n`;\n        resultMessage += `WebAuthn ID: ${guardianData.webauthnCredentialId.substring(0, 20)}...\\n\\n`;\n      }\n      setTransactionStatus(resultMessage);\n    } catch (error) {\n      console.error(\"Lỗi khi kiểm tra thông tin guardians:\", error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      setTransactionStatus(`Lỗi khi kiểm tra thông tin guardians: ${errorMessage}`);\n    }\n  };\n\n  // Hoàn tất quá trình đăng ký guardian dựa trên mã mời\n  const completeGuardianSetup = async inviteCode => {\n    try {\n      setTransactionStatus(`Đang hoàn tất quá trình đăng ký guardian với mã mời: ${inviteCode}...`);\n\n      // 1. Lấy thông tin guardian\n      const guardianData = await getGuardianData(inviteCode);\n      if (!guardianData) {\n        setTransactionStatus('Không tìm thấy thông tin guardian. Vui lòng đảm bảo guardian đã hoàn tất đăng ký.');\n        return;\n      }\n      if (guardianData.status !== 'ready') {\n        setTransactionStatus(`Guardian có trạng thái không hợp lệ: ${guardianData.status}`);\n        return;\n      }\n\n      // 2. Thêm guardian vào blockchain\n      setTransactionStatus(prev => prev + '\\n\\nĐang thêm guardian vào blockchain...');\n\n      // Tạo multisig PDA từ địa chỉ multisig\n      const multisigPubkey = new PublicKey(guardianData.multisigAddress);\n\n      // Tạo WebAuthn public key từ dữ liệu lưu trữ\n      const webauthnPubkey = Buffer.from(new Uint8Array(guardianData.webauthnPublicKey));\n\n      // Chuẩn bị dữ liệu guardian\n      const guardianIndex = guardianData.guardianId;\n      const guardianName = guardianData.guardianName;\n      const guardianType = 0; // 0 = Guardian thường\n      const recoveryHash = Uint8Array.from(guardianData.hashedRecoveryBytes);\n\n      // Thêm guardian vào blockchain\n      if (projectFeePayerKeypair) {\n        // Tạo transaction\n        const tx = new Transaction();\n\n        // Tìm PDA cho guardian\n        const guardianIdBigInt = BigInt(guardianIndex);\n        const guardianIdBytes = bigIntToLeBytes(guardianIdBigInt);\n        const [guardianPDA] = await PublicKey.findProgramAddress([Buffer.from(\"guardian\"), multisigPubkey.toBuffer(), guardianIdBytes], PROGRAM_ID);\n        const addGuardianDiscriminator = new Uint8Array([167, 189, 170, 27, 74, 240, 201, 241]);\n\n        // Chuẩn bị tên guardian\n        const guardianNameBuffer = Buffer.from(guardianName);\n        const guardianNameLenBuffer = Buffer.alloc(4);\n        guardianNameLenBuffer.writeUInt32LE(guardianNameBuffer.length, 0);\n\n        // Đặt is_owner = false vì đây là guardian member, không phải owner\n        const isOwnerByte = new Uint8Array([1]); // false = 0\n\n        // Cấu hình webauthn_pubkey là Some(webauthnPubkey)\n        const hasWebauthn = new Uint8Array([1]); // Some variant\n\n        // Tạo dữ liệu instruction\n        const instructionData = concatUint8Arrays(addGuardianDiscriminator, guardianIdBytes, bufferToUint8Array(guardianNameLenBuffer), bufferToUint8Array(guardianNameBuffer), recoveryHash, isOwnerByte, hasWebauthn, bufferToUint8Array(webauthnPubkey));\n        const addGuardianIx = new TransactionInstruction({\n          keys: [{\n            pubkey: multisigPubkey,\n            isSigner: false,\n            isWritable: true\n          }, {\n            pubkey: guardianPDA,\n            isSigner: false,\n            isWritable: true\n          }, {\n            pubkey: projectFeePayerKeypair.publicKey,\n            isSigner: false,\n            isWritable: false\n          }, {\n            pubkey: projectFeePayerKeypair.publicKey,\n            isSigner: true,\n            isWritable: true\n          }, {\n            pubkey: SystemProgram.programId,\n            isSigner: false,\n            isWritable: false\n          }],\n          programId: PROGRAM_ID,\n          data: Buffer.from(instructionData)\n        });\n        tx.add(addGuardianIx);\n\n        // Gửi transaction\n        setTransactionStatus(prev => prev + '\\nĐang gửi transaction...');\n        const signature = await sendAndConfirmTransaction(connection, tx, [projectFeePayerKeypair], {\n          commitment: 'confirmed',\n          skipPreflight: true\n        });\n\n        // Xác nhận transaction đã thành công\n        setTransactionStatus(prev => prev + '\\nĐang xác nhận transaction...');\n        await connection.confirmTransaction(signature, 'confirmed');\n\n        // Cập nhật trạng thái guardian\n        await updateGuardianStatus(inviteCode, 'completed', signature);\n\n        // Thông báo kết quả\n        setTransactionStatus(`Guardian đã được thêm thành công vào blockchain!\n- Tên: ${guardianData.guardianName}\n- ID: ${guardianData.guardianId} \n- Địa chỉ: ${guardianPDA.toString()}\n- Signature: ${signature}\n\nGuardian đã sẵn sàng để sử dụng trong ví multisig của bạn.`);\n\n        // Xóa dữ liệu guardian từ database sau khi hoàn tất\n        setTransactionStatus(prev => prev + '\\n\\nĐang xóa dữ liệu guardian từ database...');\n        console.log(`Bắt đầu xóa dữ liệu guardian với mã mời: ${inviteCode}`);\n        const deleteResult = await deleteGuardianData(inviteCode);\n        if (deleteResult) {\n          console.log(`✅ ĐÃ XÓA THÀNH CÔNG dữ liệu guardian, invitation và lookup với mã mời: ${inviteCode}`);\n\n          // Cập nhật thông báo thành công rõ ràng hơn\n          setTransactionStatus(`✅ HOÀN TẤT THÀNH CÔNG!\n          \n          Guardian \"${guardianData.guardianName}\" (ID: ${guardianData.guardianId}) đã được thêm thành công vào ví.\n          \n          Địa chỉ Guardian: ${guardianPDA.toString()}\n          Signature: ${signature}\n          \n          ✅ Dữ liệu đã được xóa khỏi database để bảo vệ quyền riêng tư.\n          \n          ✅ Guardian hiện đã sẵn sàng sử dụng và đã được ẩn khỏi danh sách chờ.`);\n\n          // Bỏ mã mời đã sử dụng khỏi danh sách\n          setPendingInvites(prev => prev.filter(code => code !== inviteCode));\n        } else {\n          console.error(`❌ KHÔNG THỂ XÓA dữ liệu guardian với mã mời: ${inviteCode}`);\n          setTransactionStatus(prev => prev + '\\n❌ Không thể xóa dữ liệu guardian từ database.');\n        }\n\n        // Làm mới danh sách guardian và cập nhật UI\n        await getExistingGuardianIds();\n        await loadPendingInvites();\n\n        // Cập nhật số dư của ví\n        if (multisigAddress) {\n          await loadPdaBalance(multisigAddress);\n        }\n      } else {\n        setTransactionStatus('Lỗi: Fee payer không khả dụng');\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi hoàn tất quá trình đăng ký guardian:\", error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      setTransactionStatus(`Lỗi khi hoàn tất quá trình đăng ký guardian: ${errorMessage}`);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"bg-blue-600 text-white p-4 mb-4\",\n      children: /*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-2xl font-bold\",\n        children: \"Moon Wallet - Qu\\u1EA3n l\\xFD V\\xED \\u0110a Ch\\u1EEF K\\xFD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1739,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1738,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container mx-auto p-4 flex flex-col\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-2 gap-4\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 bg-white rounded shadow\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-bold mb-4\",\n            children: \"Qu\\u1EA3n l\\xFD V\\xED\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1744,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-4\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: recoveryPhrase,\n              onChange: e => setRecoveryPhrase(e.target.value),\n              placeholder: \"Recovery Phrase (t\\u1ED1i thi\\u1EC3u 8 k\\xFD t\\u1EF1)\",\n              className: \"w-full p-2 border rounded mb-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1748,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1747,\n            columnNumber: 13\n          }, this), !multisigAddress && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"login-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"V\\xED Moon Wallet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1761,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wallet-actions\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: loginToWallet,\n                className: \"btn btn-primary\",\n                disabled: isLoggingIn,\n                children: isLoggingIn ? 'Đang đăng nhập...' : 'Đăng nhập bằng WebAuthn'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1764,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1763,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1760,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"connection-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"Th\\xF4ng tin k\\u1EBFt n\\u1ED1i\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1778,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"\\u0110ang k\\u1EBFt n\\u1ED1i t\\u1EDBi: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: RPC_ENDPOINT\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1779,\n                columnNumber: 36\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1779,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Program ID: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: PROGRAM_ID_STRING\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1780,\n                columnNumber: 30\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1780,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Fee Payer: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: projectFeePayerKeypair ? projectFeePayerKeypair.publicKey.toString() : 'Chưa khởi tạo'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1781,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1781,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"S\\u1ED1 d\\u01B0 Fee Payer: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: isLoadingFeePayerBalance ? 'Đang tải...' : `${feePayerBalance} SOL`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1782,\n                columnNumber: 35\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1782,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"button-row\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: requestAirdrop,\n                disabled: isLoadingFeePayerBalance,\n                children: \"Airdrop 2 SOL cho Fee Payer\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1784,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1783,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-text\",\n              children: \"Fee payer c\\u1EE7a d\\u1EF1 \\xE1n c\\u1EA7n c\\xF3 SOL \\u0111\\u1EC3 tr\\u1EA3 ph\\xED giao d\\u1ECBch. N\\u1EBFu s\\u1ED1 d\\u01B0 = 0, vui l\\xF2ng Airdrop tr\\u01B0\\u1EDBc khi t\\u1EA1o v\\xED ho\\u1EB7c th\\xEAm guardian.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1791,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1777,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wallet-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"Th\\xF4ng tin v\\xED Moon Wallet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1797,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Multisig PDA: \", multisigAddress ? multisigAddress.toString() : 'Chưa tạo ví']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1798,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"S\\u1ED1 d\\u01B0 V\\xED: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: isLoadingPdaBalance ? 'Đang tải...' : `${pdaBalance} SOL`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1799,\n                columnNumber: 28\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1799,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Guardian PDA: \", guardianPDA ? guardianPDA.toString() : 'Chưa có guardian']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1800,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"button-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: getWalletInfo,\n                children: \"Xem th\\xF4ng tin v\\xED\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1802,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"guardian-selection\",\n                children: [/*#__PURE__*/_jsxDEV(\"select\", {\n                  value: selectedGuardianId,\n                  onChange: e => setSelectedGuardianId(parseInt(e.target.value)),\n                  style: {\n                    margin: '0 10px',\n                    padding: '8px'\n                  },\n                  children: existingGuardians.map(id => /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: id,\n                    children: [\"Guardian ID \", id]\n                  }, id, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1810,\n                    columnNumber: 23\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1804,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: getGuardianInfo,\n                  disabled: !multisigAddress || existingGuardians.length === 0,\n                  children: \"Xem th\\xF4ng tin guardian\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1813,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1803,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => {\n                  if (multisigAddress) {\n                    loadPdaBalance(multisigAddress);\n                    getExistingGuardianIds();\n                  }\n                },\n                disabled: isLoadingPdaBalance || !multisigAddress,\n                children: \"C\\u1EADp nh\\u1EADt d\\u1EEF li\\u1EC7u\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1820,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1801,\n              columnNumber: 15\n            }, this), multisigAddress && credentialId && selectedGuardianId && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"transfer-section mt-4\",\n              children: /*#__PURE__*/_jsxDEV(TransferForm, {\n                walletAddress: multisigAddress.toString(),\n                credentialId: credentialId,\n                guardianId: selectedGuardianId,\n                onTransferSuccess: () => {\n                  // Cập nhật số dư sau khi chuyển tiền thành công\n                  if (multisigAddress) {\n                    loadPdaBalance(multisigAddress);\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1836,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1835,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1796,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"create-wallet-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"T\\u1EA1o v\\xED Moon Wallet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1852,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"info-text\",\n              children: \"D\\u1EF1 \\xE1n s\\u1EBD tr\\u1EA3 ph\\xED giao d\\u1ECBch t\\u1EA1o v\\xED. B\\u1EA1n kh\\xF4ng c\\u1EA7n c\\xF3 SOL.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1854,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"T\\xEAn v\\xED: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1857,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: walletName,\n                onChange: e => setWalletName(e.target.value),\n                maxLength: 32,\n                placeholder: \"Nh\\u1EADp t\\xEAn cho v\\xED c\\u1EE7a b\\u1EA1n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1858,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1856,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: [\"Recovery Key: \", /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"required\",\n                  children: \"*\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1868,\n                  columnNumber: 38\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1868,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: recoveryPhrase,\n                onChange: e => setRecoveryPhrase(e.target.value),\n                placeholder: \"Nh\\u1EADp recovery key (\\xEDt nh\\u1EA5t 8 k\\xFD t\\u1EF1)\",\n                style: {\n                  width: '300px'\n                },\n                required: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1869,\n                columnNumber: 17\n              }, this), recoveryPhrase && recoveryPhrase.length < 8 && /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"error-message\",\n                children: \"Recovery key ph\\u1EA3i c\\xF3 \\xEDt nh\\u1EA5t 8 k\\xFD t\\u1EF1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1878,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1867,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"Threshold: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1883,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"number\",\n                min: \"1\",\n                max: \"8\",\n                value: threshold,\n                onChange: e => setThreshold(parseInt(e.target.value))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1884,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1882,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"T\\xEAn Guardian: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1894,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: guardianName,\n                onChange: e => setGuardianName(e.target.value),\n                maxLength: 32,\n                placeholder: \"T\\xEAn cho guardian \\u0111\\u1EA7u ti\\xEAn (m\\u1EB7c \\u0111\\u1ECBnh: Owner)\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1895,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1893,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: createWalletWithWebAuthn,\n              disabled: isLoadingBalance || !recoveryPhrase || recoveryPhrase.length < 8,\n              className: \"create-wallet-button\",\n              children: \"T\\u1EA1o v\\xED Moon Wallet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1904,\n              columnNumber: 15\n            }, this), credentialId && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"credential-info\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Credential ID: \", credentialId.slice(0, 10), \"...\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1914,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1913,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1851,\n            columnNumber: 13\n          }, this), multisigAddress && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"add-guardian-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"Qu\\u1EA3n l\\xFD Guardian\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1922,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"existing-guardians\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"C\\xE1c Guardian hi\\u1EC7n c\\xF3:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1925,\n                  columnNumber: 22\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1925,\n                columnNumber: 19\n              }, this), existingGuardians.length > 0 ? /*#__PURE__*/_jsxDEV(\"ul\", {\n                className: \"guardian-list\",\n                children: existingGuardians.map(id => /*#__PURE__*/_jsxDEV(\"li\", {\n                  className: \"guardian-item\",\n                  children: [\"Guardian ID \", id, id === 1 && \" (Owner)\"]\n                }, id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1929,\n                  columnNumber: 25\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1927,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"Ch\\u01B0a c\\xF3 Guardian n\\xE0o\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1936,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1924,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"guardian-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: generateGuardianInvite,\n                className: \"primary-button\",\n                children: \"T\\u1EA1o l\\u1EDDi m\\u1EDDi Guardian m\\u1EDBi\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1941,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => {\n                  setShowInviteInput(!showInviteInput);\n                  loadPendingInvites();\n                },\n                className: \"toggle-button\",\n                children: showInviteInput ? 'Ẩn form nhập mã mời' : 'Hoàn tất đăng ký Guardian'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1948,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: getExistingGuardianIds,\n                className: \"update-button\",\n                children: \"C\\u1EADp nh\\u1EADt danh s\\xE1ch guardian\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1958,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1940,\n              columnNumber: 17\n            }, this), showQRCode && inviteLink && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invite-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                children: \"Link m\\u1EDDi Guardian\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1969,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"qr-code\",\n                children: /*#__PURE__*/_jsxDEV(QRCodeSVG, {\n                  value: inviteLink,\n                  size: 200,\n                  level: \"H\",\n                  includeMargin: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1971,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1970,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"invite-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  children: [\"Link m\\u1EDDi: \", /*#__PURE__*/_jsxDEV(\"a\", {\n                    href: inviteLink,\n                    target: \"_blank\",\n                    rel: \"noopener noreferrer\",\n                    children: inviteLink\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1979,\n                    columnNumber: 36\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1979,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: [\"M\\xE3 m\\u1EDDi: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: inviteCode\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1980,\n                    columnNumber: 34\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1980,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"note\",\n                  children: \"G\\u1EEDi link n\\xE0y cho ng\\u01B0\\u1EDDi b\\u1EA1n mu\\u1ED1n th\\xEAm l\\xE0m guardian. H\\u1ECD s\\u1EBD ho\\xE0n th\\xE0nh qu\\xE1 tr\\xECnh \\u0111\\u0103ng k\\xFD v\\xE0 sau \\u0111\\xF3 b\\u1EA1n c\\xF3 th\\u1EC3 ho\\xE0n t\\u1EA5t vi\\u1EC7c th\\xEAm guardian b\\u1EB1ng m\\xE3 m\\u1EDDi.\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1981,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1978,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => {\n                  setShowQRCode(false);\n                  setInviteLink('');\n                  setInviteCode('');\n                },\n                children: \"\\u0110\\xF3ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1983,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1968,\n              columnNumber: 19\n            }, this), showInviteInput && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invite-input-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                children: \"Ho\\xE0n t\\u1EA5t \\u0111\\u0103ng k\\xFD Guardian\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1994,\n                columnNumber: 21\n              }, this), pendingInvites.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"pending-invites\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  children: \"C\\xE1c m\\xE3 m\\u1EDDi \\u0111ang ch\\u1EDD x\\u1EED l\\xFD:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1998,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"invite-codes\",\n                  children: pendingInvites.map(code => /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"invite-code-item\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"code\",\n                      children: code\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2002,\n                      columnNumber: 31\n                    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                      onClick: () => completeGuardianSetup(code),\n                      className: \"complete-button\",\n                      children: \"Ho\\xE0n t\\u1EA5t\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2003,\n                      columnNumber: 31\n                    }, this)]\n                  }, code, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2001,\n                    columnNumber: 29\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1999,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1997,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"Kh\\xF4ng c\\xF3 m\\xE3 m\\u1EDDi n\\xE0o \\u0111ang ch\\u1EDD x\\u1EED l\\xFD.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2014,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"manual-input\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  children: \"Ho\\u1EB7c nh\\u1EADp m\\xE3 m\\u1EDDi th\\u1EE7 c\\xF4ng:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2018,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  placeholder: \"Nh\\u1EADp m\\xE3 m\\u1EDDi\",\n                  value: inviteCode,\n                  onChange: e => setInviteCode(e.target.value),\n                  className: \"invite-input\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2019,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => inviteCode && completeGuardianSetup(inviteCode),\n                  disabled: !inviteCode,\n                  className: \"complete-button\",\n                  children: \"Ho\\xE0n t\\u1EA5t \\u0111\\u0103ng k\\xFD\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2026,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2017,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1993,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"guardian-test-actions mt-3\",\n              style: {\n                display: 'flex',\n                gap: '10px',\n                marginBottom: '15px'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => testGuardianInfo(1),\n                className: \"btn btn-sm btn-info\",\n                children: \"Ki\\u1EC3m tra Guardian 1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2038,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => testGuardianInfo(2),\n                className: \"btn btn-sm btn-info\",\n                children: \"Ki\\u1EC3m tra Guardian 2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2039,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => testGuardianInfo(3),\n                className: \"btn btn-sm btn-info\",\n                children: \"Ki\\u1EC3m tra Guardian 3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2040,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2037,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1921,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-header bg-primary text-white\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"mb-0\",\n                children: \"N\\u1EA1p ti\\u1EC1n v\\xE0o v\\xED Multisig\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2048,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2047,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-body\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"form-group mb-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  htmlFor: \"depositAmount\",\n                  children: \"S\\u1ED1 l\\u01B0\\u1EE3ng SOL:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2052,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  id: \"depositAmount\",\n                  className: \"form-control\",\n                  step: \"0.01\",\n                  min: \"0.01\",\n                  value: depositAmount,\n                  onChange: e => setDepositAmount(parseFloat(e.target.value)),\n                  placeholder: \"Nh\\u1EADp s\\u1ED1 l\\u01B0\\u1EE3ng SOL\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2053,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2051,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn btn-primary w-100\",\n                onClick: depositToMultisig,\n                disabled: !multisigAddress,\n                children: \"N\\u1EA1p ti\\u1EC1n v\\xE0o v\\xED\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2064,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2050,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2046,\n            columnNumber: 13\n          }, this), transactionStatus && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"transaction-status\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Tr\\u1EA1ng th\\xE1i giao d\\u1ECBch\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2076,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                whiteSpace: 'pre-line'\n              },\n              children: transactionStatus\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2077,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2075,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1743,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1742,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1741,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1737,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"7HQEOi4A4ZJWO4z7XtBpSdEwOv0=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","Connection","PublicKey","Keypair","Transaction","SystemProgram","TransactionInstruction","LAMPORTS_PER_SOL","sendAndConfirmTransaction","Buffer","createWebAuthnCredential","getWebAuthnAssertionForLogin","processCredentialIdForPDA","getMultisigPDA","getGuardianPDA","QRCodeSVG","saveInvitation","getInvitation","getGuardianData","updateGuardianStatus","getPendingInvites","deleteGuardianData","getWalletByCredentialId","TransferForm","jsxDEV","_jsxDEV","RPC_ENDPOINT","process","env","REACT_APP_RPC_ENDPOINT","PROGRAM_ID_STRING","REACT_APP_PROGRAM_ID","PROGRAM_ID","connectionOptions","commitment","confirmTransactionInitialTimeout","disableRetryOnRateLimit","fetch","connection","ActionParams","constructor","props","amount","destination","tokenMint","bufferToUint8Array","buffer","Uint8Array","byteOffset","byteLength","concatUint8Arrays","arrays","totalLength","reduce","acc","arr","length","result","offset","set","bigIntToLeBytes","value","bytesLength","i","Number","BigInt","calculateMultisigPDA","programId","credentialId","seedBuffer","console","log","from","toString","findProgramAddressSync","compressPublicKey","uncompressedKey","warn","randomKey","alloc","randomBytes","crypto","getRandomValues","x","slice","y","prefix","compressedKey","hashRecoveryPhrase","phrase","phraseBytes","TextEncoder","encode","inputBytes","Math","min","hashBuffer","subtle","digest","convertSecretKeyStringToUint8Array","secretKeyString","Error","numbers","split","map","s","parseInt","trim","bytes","hashCredentialId","encoder","data","App","_s","walletKeypair","setWalletKeypair","walletBalance","setWalletBalance","multisigAddress","setMultisigAddress","threshold","setThreshold","guardianName","setGuardianName","recoveryPhrase","setRecoveryPhrase","transactionStatus","setTransactionStatus","guardianPDA","setGuardianPDA","isLoadingBalance","setIsLoadingBalance","setCredentialId","webauthnPubkey","setWebauthnPubkey","walletName","setWalletName","isUsingTempWallet","setIsUsingTempWallet","newGuardianName","setNewGuardianName","newRecoveryPhrase","setNewRecoveryPhrase","existingGuardians","setExistingGuardians","showAddGuardianForm","setShowAddGuardianForm","projectFeePayerKeypair","setProjectFeePayerKeypair","usingProjectFeePayer","setUsingProjectFeePayer","feePayerBalance","setFeePayerBalance","isLoadingFeePayerBalance","setIsLoadingFeePayerBalance","pdaBalance","setPdaBalance","isLoadingPdaBalance","setIsLoadingPdaBalance","selectedGuardianId","setSelectedGuardianId","depositAmount","setDepositAmount","withdrawAmount","setWithdrawAmount","recipientAddress","setRecipientAddress","loginCredentialId","setLoginCredentialId","isLoggingIn","setIsLoggingIn","isLoggedIn","setIsLoggedIn","showLoginForm","setShowLoginForm","inviteLink","setInviteLink","inviteCode","setInviteCode","showQRCode","setShowQRCode","showInviteInput","setShowInviteInput","pendingInvites","setPendingInvites","projectPayerPrivateKey","REACT_APP_FEE_PAYER_SECRET_KEY","feePayerKeypair","fromSecretKey","loadFeePayerBalance","keypair","balance","getBalance","publicKey","error","loadBalance","createWalletWithWebAuthn","walletAddress","rawIdBase64","rawId","prev","multisigPDA","existingAccount","getAccountInfo","guardianId","guardianIdBytes","guardianPDAAddress","subarray","toBuffer","transaction","initMultisigDiscriminator","thresholdBytes","credentialIdString","credentialIdBuffer","credentialIdLenBuffer","writeUInt32LE","credentialIdLenBytes","credentialIdDataBytes","initData","add","keys","pubkey","isSigner","isWritable","feePayer","recentBlockhash","getLatestBlockhash","blockhash","instructions","ix","index","k","discriminator","Array","credentialIdLength","isOwner","hasWebauthn","webauthnPubkeyLength","signature","sendTransaction","confirmTransaction","guardianMultisigPDA","hashedRecoveryBytes","addGuardianDiscriminator","guardianIdBigIntBytes","guardianNameBuffer","guardianNameLenBuffer","recoveryHashIntermediateBytes","isOwnerByte","uncompressedKeyBuffer","compressedKeyBuffer","addGuardianData","addGuardianTransaction","addGuardianSignature","message","loadPdaBalance","address","getGuardianPda","guardianPda","checkGuardianExists","accountInfo","getGuardianIdsList","existingIds","push","findGuardianAddress","guardianIdBigInt","requestAirdrop","fundFromValidator","validatorKey","transfer","fromPubkey","toPubkey","lamports","getWalletInfo","multisigAccount","guardian_count","recovery_nonce","DataView","getBigUint64","bump","transaction_nonce","last_transaction_timestamp","getBigInt64","getGuardianInfo","guardianAccount","owner","equals","substring","walletBytes","wallet","nameLength","getUint32","nameOffset","nameBytes","name","TextDecoder","decode","currentOffset","isActive","recoveryHash","recoveryHashHex","webauthnHex","parseError","getExistingGuardianIds","guardianIds","includes","join","generateNewGuardianId","newId","addNewGuardian","newGuardianId","guardianIdentifier","webAuthnResult","existingGuardian","Promise","resolve","setTimeout","newGuardianAccount","webAuthnError","depositToMultisig","lamportsToSend","testGuardianInfo","id","loginToWallet","assertionResult","success","credentialRawData","credentialIdHex","credentialMapping","walletAddressFromDB","walletAccount","generateRandomCode","chars","randomValues","charAt","generateGuardianInvite","ngrokUrl","REACT_APP_NGROK_URL","window","location","origin","status","ownerId","errorMessage","loadPendingInvites","multisigAddressStr","invitesList","fetchGuardianDataFromDatabase","fetchInviteFromDatabase","updateGuardianStatusInDatabase","txSignature","checkGuardiansInDatabase","resultMessage","inviteData","guardianData","webauthnCredentialId","completeGuardianSetup","multisigPubkey","webauthnPublicKey","guardianIndex","guardianType","tx","findProgramAddress","instructionData","addGuardianIx","skipPreflight","deleteResult","filter","code","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","onChange","e","target","placeholder","onClick","disabled","style","margin","padding","onTransferSuccess","maxLength","width","required","max","size","level","includeMargin","href","rel","display","gap","marginBottom","htmlFor","step","parseFloat","whiteSpace","_c","$RefreshReg$"],"sources":["/Users/tai/Documents/MoonWallet/moonwallet/frontend_test/src/App.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Connection, PublicKey, Keypair, Transaction, SystemProgram, TransactionInstruction, Commitment, Signer, LAMPORTS_PER_SOL, sendAndConfirmTransaction } from '@solana/web3.js';\nimport { Buffer } from 'buffer';\nimport './App.css';\nimport { createWebAuthnCredential, getWebAuthnAssertionForLogin, calculateMultisigAddress, getWebAuthnAssertion } from './utils/webauthnUtils';\nimport { processCredentialIdForPDA, getMultisigPDA, getGuardianPDA, getAllGuardianPDAs } from './utils/credentialUtils';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { \n  saveInvitation, \n  getInvitation, \n  getGuardianData, \n  updateGuardianStatus,\n  getPendingInvites,\n  deleteGuardianData\n} from './firebase/guardianService';\nimport { getWalletByCredentialId } from './firebase/webAuthnService';\n// Thêm import TransferForm\nimport { TransferForm } from './components/TransferForm';\n\n\nconst RPC_ENDPOINT = process.env.REACT_APP_RPC_ENDPOINT || 'http://127.0.0.1:8899'; // Localhost validator\nconst PROGRAM_ID_STRING = process.env.REACT_APP_PROGRAM_ID || 'DeN1rBfabZezHPvrq9q7BbzUbZkrjnHE1kQDrPK8kWQ3'; // Program ID mới triển khai\n\nexport const PROGRAM_ID = new PublicKey(PROGRAM_ID_STRING);\n\n\n\n// Tùy chọn kết nối\nconst connectionOptions = {\n  commitment: 'confirmed' as Commitment,\n  confirmTransactionInitialTimeout: 60000,\n  disableRetryOnRateLimit: false,\n  fetch: fetch\n};\n\n// Connection với validator\nconst connection = new Connection(RPC_ENDPOINT, connectionOptions);\n\n// Schema cho các struct của chương trình\nclass ActionParams {\n  amount: number | null;\n  destination: PublicKey | null;\n  tokenMint: PublicKey | null;\n\n  constructor(props: { \n    amount: number | null; \n    destination: PublicKey | null; \n    tokenMint: PublicKey | null \n  }) {\n    this.amount = props.amount;\n    this.destination = props.destination;\n    this.tokenMint = props.tokenMint;\n  }\n}\n\n\n\nfunction bufferToUint8Array(buffer: Buffer): Uint8Array {\n  return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n}\n\n\nfunction concatUint8Arrays(...arrays: Uint8Array[]): Uint8Array {\n  // Tính tổng độ dài\n  const totalLength = arrays.reduce((acc, arr) => acc + arr.length, 0);\n  \n\n  const result = new Uint8Array(totalLength);\n  \n\n  let offset = 0;\n  for (const arr of arrays) {\n    result.set(arr, offset);\n    offset += arr.length;\n  }\n  \n  return result;\n}\n\n\nconst bigIntToLeBytes = (value: bigint, bytesLength: number = 8): Uint8Array => {\n  const result = new Uint8Array(bytesLength);\n  for (let i = 0; i < bytesLength; i++) {\n    result[i] = Number((value >> BigInt(8 * i)) & BigInt(0xff));\n  }\n  return result;\n};\n\n\nconst calculateMultisigPDA = async (programId: PublicKey, credentialId: string): Promise<[PublicKey, number]> => {\n\n  const seedBuffer = processCredentialIdForPDA(credentialId);\n  console.log(\"Xử lý credential ID:\", credentialId);\n  console.log(\"Seed buffer để tính PDA:\", Buffer.from(seedBuffer).toString('hex'));\n  \n  return PublicKey.findProgramAddressSync(\n    [\n      Buffer.from(\"multisig\"),\n      seedBuffer\n    ],\n    programId\n  );\n};\n\n// Hàm nén khóa công khai từ dạng uncompressed (65 bytes) sang compressed (33 bytes)\nconst compressPublicKey = (uncompressedKey: Buffer): Buffer => {\n  // Đảm bảo khóa bắt đầu với byte 0x04 (không nén)\n  if (uncompressedKey[0] !== 0x04 || uncompressedKey.length !== 65) {\n    console.warn('Khóa không đúng định dạng không nén ECDSA, tạo khóa ngẫu nhiên');\n    // Tạo khóa random nếu không đúng định dạng\n    const randomKey = Buffer.alloc(33);\n    randomKey[0] = 0x02; // compressed, y is even\n    \n    // Tạo dữ liệu ngẫu nhiên cho 32 bytes còn lại\n    const randomBytes = new Uint8Array(32);\n    crypto.getRandomValues(randomBytes);\n    \n    // Sao chép vào buffer\n    for (let i = 0; i < 32; i++) {\n      randomKey[i+1] = randomBytes[i];\n    }\n    \n    return randomKey;\n  }\n  \n  // Lấy tọa độ x và y\n  const x = new Uint8Array(uncompressedKey.slice(1, 33));\n  const y = new Uint8Array(uncompressedKey.slice(33, 65));\n  \n  // Tính prefix: 0x02 nếu y chẵn, 0x03 nếu y lẻ\n  const prefix = (y[31] & 1) === 0 ? 0x02 : 0x03;\n  \n  // Tạo khóa nén: prefix (1 byte) + x (32 bytes)\n  const compressedKey = Buffer.alloc(33);\n  compressedKey[0] = prefix;\n  \n  // Copy x vào compressedKey từ vị trí 1\n  for (let i = 0; i < 32; i++) {\n    compressedKey[i + 1] = x[i];\n  }\n  \n  return compressedKey;\n};\n\n// Hàm hash recovery phrase tại frontend\nconst hashRecoveryPhrase = async (phrase: string): Promise<Uint8Array> => {\n  // Chuyển recovery phrase thành bytes\n  const phraseBytes = new TextEncoder().encode(phrase);\n  \n  // Tạo buffer 32 bytes để lưu dữ liệu\n  const inputBytes = new Uint8Array(32);\n  \n  // Sao chép dữ liệu từ phrase, đảm bảo không vượt quá 32 bytes\n  inputBytes.set(phraseBytes.slice(0, Math.min(phraseBytes.length, 32)));\n  \n  // Hash bằng SHA-256\n  const hashBuffer = await crypto.subtle.digest('SHA-256', inputBytes);\n  \n  // Chuyển kết quả thành Uint8Array\n  return new Uint8Array(hashBuffer);\n};\n\n// Chuyển đổi secret key từ chuỗi trong .env thành mảng số\nconst convertSecretKeyStringToUint8Array = (secretKeyString: string | undefined): Uint8Array => {\n  if (!secretKeyString) {\n    throw new Error('Fee payer secret key không được định nghĩa trong biến môi trường');\n  }\n  \n  // Chuyển đổi chuỗi \"1,2,3,...\" thành mảng số\n  const numbers = secretKeyString.split(',').map(s => parseInt(s.trim(), 10));\n  \n  // Kiểm tra kích thước hợp lệ (64 bytes cho ed25519)\n  if (numbers.length !== 64 && numbers.length !== 65) {\n    throw new Error(`Secret key phải có 64 hoặc 65 bytes, nhưng có ${numbers.length} bytes`);\n  }\n  \n  // Nếu có 65 bytes, bỏ qua byte cuối cùng (thường là checksum)\n  const bytes = numbers.length === 65 ? numbers.slice(0, 64) : numbers;\n  \n  return new Uint8Array(bytes);\n};\n\n\nconst hashCredentialId = async (credentialId: string): Promise<Uint8Array> => {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(credentialId);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  return new Uint8Array(hashBuffer);\n};\n\nfunction App() {\n  const [walletKeypair, setWalletKeypair] = useState<Keypair | null>(null);\n  const [walletBalance, setWalletBalance] = useState<number>(0);\n  const [multisigAddress, setMultisigAddress] = useState<PublicKey | null>(null);\n  const [threshold, setThreshold] = useState<number>(1);\n  const [guardianName, setGuardianName] = useState<string>('Owner');\n  const [recoveryPhrase, setRecoveryPhrase] = useState<string>('');\n  const [transactionStatus, setTransactionStatus] = useState<string>('');\n  const [guardianPDA, setGuardianPDA] = useState<PublicKey | null>(null);\n  const [isLoadingBalance, setIsLoadingBalance] = useState<boolean>(false);\n  const [credentialId, setCredentialId] = useState<string>('');\n  const [webauthnPubkey, setWebauthnPubkey] = useState<string>('');\n  const [walletName, setWalletName] = useState<string>('My Moon Wallet');\n  const [isUsingTempWallet, setIsUsingTempWallet] = useState<boolean>(false);\n  // Thêm state cho new guardian\n  const [newGuardianName, setNewGuardianName] = useState<string>('');\n  const [newRecoveryPhrase, setNewRecoveryPhrase] = useState<string>('');\n  const [existingGuardians, setExistingGuardians] = useState<number[]>([]);  // Lưu các guardian ID đã tồn tại\n  const [showAddGuardianForm, setShowAddGuardianForm] = useState<boolean>(false);\n  // Thêm state cho fee payer của dự án\n  const [projectFeePayerKeypair, setProjectFeePayerKeypair] = useState<Keypair | null>(null);\n  const [usingProjectFeePayer, setUsingProjectFeePayer] = useState<boolean>(true);\n  const [feePayerBalance, setFeePayerBalance] = useState<number>(0);\n  const [isLoadingFeePayerBalance, setIsLoadingFeePayerBalance] = useState<boolean>(false);\n  // Thêm state cho số dư PDA\n  const [pdaBalance, setPdaBalance] = useState<number>(0);\n  const [isLoadingPdaBalance, setIsLoadingPdaBalance] = useState<boolean>(false);\n  // Thêm state cho việc chọn guardian ID\n  const [selectedGuardianId, setSelectedGuardianId] = useState<number>(1);\n  // State cho form nạp tiền\n  const [depositAmount, setDepositAmount] = useState<number>(0.1);\n  // State cho form rút tiền\n  const [withdrawAmount, setWithdrawAmount] = useState<number>(0.05);\n  const [recipientAddress, setRecipientAddress] = useState<string>('');\n  // State cho form đăng nhập ví\n  const [loginCredentialId, setLoginCredentialId] = useState<string>('');\n  const [isLoggingIn, setIsLoggingIn] = useState<boolean>(false);\n  const [isLoggedIn, setIsLoggedIn] = useState<boolean>(false);\n  const [showLoginForm, setShowLoginForm] = useState<boolean>(false);\n  \n  // Thêm state cho chức năng tạo invitation\n  const [inviteLink, setInviteLink] = useState<string>('');\n  const [inviteCode, setInviteCode] = useState<string>('');\n  const [showQRCode, setShowQRCode] = useState<boolean>(false);\n  const [showInviteInput, setShowInviteInput] = useState<boolean>(false);\n  const [pendingInvites, setPendingInvites] = useState<string[]>([]);\n\n  // Tạo keypair mới khi component được mount\n  useEffect(() => {\n   \n    const projectPayerPrivateKey = convertSecretKeyStringToUint8Array(process.env.REACT_APP_FEE_PAYER_SECRET_KEY);\n    \n    // Sử dụng keypair cố định cho fee payer\n    const feePayerKeypair = Keypair.fromSecretKey(projectPayerPrivateKey);\n    setProjectFeePayerKeypair(feePayerKeypair);\n    \n    // Load balance cho fee payer\n    loadFeePayerBalance(feePayerKeypair);\n    \n  }, []);\n\n  // Thêm hàm để load balance của fee payer\n  const loadFeePayerBalance = async (keypair: Keypair) => {\n    try {\n      setIsLoadingFeePayerBalance(true);\n      const balance = await connection.getBalance(keypair.publicKey);\n      console.log(`Fee payer balance: ${balance / 1_000_000_000} SOL`);\n      \n      // Nếu balance quá thấp, có thể gửi thông báo cảnh báo\n      if (balance < 100_000_000) { // dưới 0.1 SOL\n        console.warn(\"Fee payer balance thấp, cần nạp thêm SOL\");\n      }\n      \n      setFeePayerBalance(balance / 1_000_000_000);\n    } catch (error) {\n      console.error(\"Lỗi khi load balance của fee payer:\", error);\n    } finally {\n      setIsLoadingFeePayerBalance(false);\n    }\n  };\n\n\n  // Tải balance với xử lý lỗi tốt hơn\n  const loadBalance = async (keypair?: Keypair) => {\n    const publicKey = keypair?.publicKey || walletKeypair?.publicKey;\n    if (!publicKey) return;\n    \n    setIsLoadingBalance(true);\n    try {\n      console.log(\"Đang tải balance cho địa chỉ:\", publicKey.toString());\n      const balance = await connection.getBalance(publicKey);\n      console.log(\"Balance đã tải thành công:\", balance / 1_000_000_000);\n      setWalletBalance(balance / 1_000_000_000); // Chuyển từ lamports sang SOL\n    } catch (error: any) {\n      console.error('Lỗi khi tải balance:', error);\n      // Không hiển thị lỗi cho người dùng, chỉ log ra console\n    } finally {\n      setIsLoadingBalance(false);\n    }\n  };\n\n  // Tạo ví với WebAuthn\n  const createWalletWithWebAuthn = async () => {\n    try {\n      // Kiểm tra xem người dùng đã nhập recovery phrase chưa\n      if (!recoveryPhrase || recoveryPhrase.trim().length < 8) {\n        setTransactionStatus('Vui lòng nhập recovery phrase (ít nhất 8 ký tự) trước khi tạo ví');\n        return;\n      }\n      \n      // Kiểm tra xem có fee payer hay không\n      if (!projectFeePayerKeypair) {\n        setTransactionStatus('Không tìm thấy fee payer của dự án. Vui lòng thử lại sau.');\n        return;\n      }\n      \n      setTransactionStatus('Đang tạo ví Moon Wallet...\\n\\nBước 1: Đang tạo khóa WebAuthn...');\n      \n      // 1. Tạo khóa WebAuthn\n      const walletAddress = projectFeePayerKeypair.publicKey.toString(); // Sử dụng địa chỉ của fee payer\n      const result = await createWebAuthnCredential(walletAddress, walletName);\n      \n      // Chuyển đổi rawId thành base64 để lưu trữ và sử dụng\n      const rawIdBase64 = Buffer.from(result.rawId).toString('base64');\n      \n\n      setCredentialId(rawIdBase64); \n      setWebauthnPubkey(result.publicKey);\n      \n      setTransactionStatus(prev => prev + `\\nĐã tạo khóa WebAuthn thành công!\\nCredential ID (base64): ${rawIdBase64.slice(0, 10)}...\\nPublic Key: ${result.publicKey.slice(0, 10)}...`);\n      \n \n      const multisigPDA = getMultisigPDA(rawIdBase64);\n      console.log(\"Multisig PDA:\", multisigPDA.toString());\n      \n      setMultisigAddress(multisigPDA);\n      setTransactionStatus(prev => prev + `\\n\\nBước 2: Đang khởi tạo ví multisig tại địa chỉ: ${multisigPDA.toString()}...`);\n      \n      const existingAccount = await connection.getAccountInfo(multisigPDA);\n      if (existingAccount) {\n        setTransactionStatus(prev => prev + `\\n\\nLỖI: Ví multisig với credential ID này đã tồn tại. Điều này gần như không thể xảy ra vì credential ID luôn duy nhất.`);\n        return;\n      }\n      \n      const guardianId = BigInt(1); // Owner có ID = 1\n\n  \n      const guardianIdBytes = bigIntToLeBytes(guardianId);\n      \n      const [guardianPDAAddress] = PublicKey.findProgramAddressSync(\n        [\n          Buffer.from(\"guardian\").subarray(0),\n          multisigPDA.toBuffer(),\n          guardianIdBytes\n        ],\n        PROGRAM_ID\n      );\n      \n      setGuardianPDA(guardianPDAAddress);\n      \n      // 4. Tạo transaction tích hợp để khởi tạo multisig và thêm guardian owner\n      const transaction = new Transaction();\n      \n      // 4.1 Khởi tạo Multisig\n      // Đây là discriminator cho initialize_multisig (sử dụng giá trị chính xác từ Anchor IDL)\n      const initMultisigDiscriminator = new Uint8Array([220, 130, 117, 21, 27, 227, 78, 213]);\n      const thresholdBytes = new Uint8Array([threshold]);\n      const credentialIdString = rawIdBase64;\n      const credentialIdBuffer = Buffer.from(credentialIdString);\n      console.log(\"Credential ID gửi đi (chuỗi gốc):\", credentialIdString);\n      \n      const credentialIdLenBuffer = Buffer.alloc(4);\n      credentialIdLenBuffer.writeUInt32LE(credentialIdBuffer.length, 0);\n      const credentialIdLenBytes = bufferToUint8Array(credentialIdLenBuffer);\n      const credentialIdDataBytes = bufferToUint8Array(credentialIdBuffer);\n      \n      // Tạo dữ liệu instruction theo đúng cấu trúc contract yêu cầu\n      const initData = concatUint8Arrays(\n        initMultisigDiscriminator,\n        thresholdBytes,\n        credentialIdLenBytes,\n        credentialIdDataBytes\n      );\n      \n      // Thêm instruction khởi tạo multisig vào transaction\n      transaction.add(new TransactionInstruction({\n        keys: [\n          { pubkey: multisigPDA, isSigner: false, isWritable: true },\n          { pubkey: projectFeePayerKeypair.publicKey, isSigner: true, isWritable: true },\n          { pubkey: SystemProgram.programId, isSigner: false, isWritable: false }\n        ],\n        programId: PROGRAM_ID,\n        data: Buffer.from(initData)\n      }));\n      \n      // Sign và gửi transaction\n      transaction.feePayer = projectFeePayerKeypair.publicKey;\n      transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n      \n      // Thông báo cho người dùng\n      setTransactionStatus(prev => prev + '\\nĐang gửi transaction để khởi tạo ví và thêm guardian owner...');\n      \n      // Log dữ liệu transaction để debug\n      console.log(\"Transaction data:\", {\n        instructions: transaction.instructions.map((ix, index) => ({\n          programId: ix.programId.toString(),\n          keys: ix.keys.map(k => ({\n            pubkey: k.pubkey.toString(),\n            isSigner: k.isSigner,\n            isWritable: k.isWritable\n          })),\n          data: index === 1 ? {\n            discriminator: Array.from(initMultisigDiscriminator),\n            threshold: threshold,\n            credentialIdLength: credentialIdBuffer.length,\n            credentialId: Array.from(credentialIdBuffer),\n            isOwner: true,\n            hasWebauthn: true,\n            webauthnPubkeyLength: result.publicKey.length\n          } : \"initMultisig\"\n        }))\n      });\n      \n      const signature = await connection.sendTransaction(\n        transaction,\n        [projectFeePayerKeypair]\n      );\n      \n      await connection.confirmTransaction(signature);\n      setTransactionStatus(prev => prev + `\\nVí multisig đã được khởi tạo thành công! Signature: ${signature}`);\n      \n      // 5. Thêm guardian đầu tiên (owner)\n      setTransactionStatus(prev => prev + '\\n\\nBước 3: Đang thêm guardian owner đầu tiên...');\n\n      try {\n        // Tính PDA cho guardian\n        const guardianId = BigInt(1); // Owner có ID = 1\n        const guardianIdBytes = bigIntToLeBytes(guardianId);\n        \n        // 5.1 Tính PDA cho multisig với credential_id\n        const guardianMultisigPDA = multisigPDA;\n        \n        console.log(\"Sử dụng PDA cho guardian với multisig PDA:\", guardianMultisigPDA.toString());\n        \n        // 5.2 Tính PDA cho guardian\n        const guardianPDA = getGuardianPDA(guardianMultisigPDA, 1); // Owner có ID = 1\n        \n        setGuardianPDA(guardianPDA);\n        \n        // Hash recovery phrase tại frontend\n        console.log(\"Recovery phrase gốc:\", recoveryPhrase);\n        const hashedRecoveryBytes = await hashRecoveryPhrase(recoveryPhrase);\n        console.log(\"Recovery phrase sau khi hash tại frontend:\", Buffer.from(hashedRecoveryBytes).toString('hex'));\n        \n        // Tạo discriminator cho add_guardian\n        const addGuardianDiscriminator = new Uint8Array([167, 189, 170, 27, 74, 240, 201, 241]);\n        \n        // Chuyển guardian ID thành bytes\n        const guardianIdBigIntBytes = bigIntToLeBytes(guardianId);\n        \n        // Chuẩn bị tên guardian\n        const guardianNameBuffer = Buffer.from(guardianName || 'Owner');\n        const guardianNameLenBuffer = Buffer.alloc(4);\n        guardianNameLenBuffer.writeUInt32LE(guardianNameBuffer.length, 0);\n        \n        // Chuẩn bị recovery hash - sử dụng giá trị đã hash\n        const recoveryHashIntermediateBytes = hashedRecoveryBytes;\n        \n        // Chuẩn bị các tham số khác\n        const isOwnerByte = new Uint8Array([1]); // true = 1\n    \n        const uncompressedKeyBuffer = Buffer.from(result.publicKey, 'hex');\n        console.log(\"WebAuthn key (uncompressed, 65 bytes):\", result.publicKey);\n        \n        // Nén khóa thành 33 bytes\n        const compressedKeyBuffer = compressPublicKey(uncompressedKeyBuffer);\n        console.log(\"WebAuthn key (compressed, 33 bytes):\", compressedKeyBuffer.toString('hex'));\n        \n        // Nối tất cả lại với nhau\n        const addGuardianData = concatUint8Arrays(\n          addGuardianDiscriminator,\n          // guardian_id (u64)\n          bufferToUint8Array(Buffer.from(guardianIdBigIntBytes)),\n          // guardian_name (string)\n          bufferToUint8Array(guardianNameLenBuffer),\n          bufferToUint8Array(guardianNameBuffer),\n          // recovery_hash_intermediate ([u8; 32])\n          recoveryHashIntermediateBytes,\n          // is_owner (bool)\n          isOwnerByte,\n          // webauthn_pubkey (Option<[u8; 33]>)\n          new Uint8Array([1]), // Some variant\n          bufferToUint8Array(compressedKeyBuffer) // Sử dụng khóa đã được nén\n        );\n        \n        // Tạo transaction add guardian\n        const addGuardianTransaction = new Transaction();\n        addGuardianTransaction.add(\n          new TransactionInstruction({\n            keys: [\n              { pubkey: multisigPDA, isSigner: false, isWritable: true },\n              { pubkey: guardianPDA, isSigner: false, isWritable: true },\n              { pubkey: projectFeePayerKeypair.publicKey, isSigner: false, isWritable: false },\n              { pubkey: projectFeePayerKeypair.publicKey, isSigner: true, isWritable: true },\n              { pubkey: SystemProgram.programId, isSigner: false, isWritable: false }\n            ],\n            programId: PROGRAM_ID,\n            data: Buffer.from(addGuardianData)\n          })\n        );\n        \n        // Sign và gửi transaction\n        addGuardianTransaction.feePayer = projectFeePayerKeypair.publicKey;\n        addGuardianTransaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n        \n        const addGuardianSignature = await connection.sendTransaction(\n          addGuardianTransaction,\n          [projectFeePayerKeypair]\n        );\n        \n        await connection.confirmTransaction(addGuardianSignature);\n        setTransactionStatus(prev => prev + `\\nGuardian owner đã được thêm thành công! Signature: ${addGuardianSignature}`);\n      } catch (error: any) {\n        console.error(\"Lỗi khi thêm guardian owner:\", error);\n        setTransactionStatus(prev => prev + `\\nLỗi khi thêm guardian owner: ${error.message}`);\n      }\n      \n      // 6. Hoàn thành quá trình tạo ví\n      setTransactionStatus(prev => prev + '\\n\\n✅ VÍ MOON WALLET ĐÃ ĐƯỢC TẠO THÀNH CÔNG!\\n' +\n        `Địa chỉ ví Multisig: ${multisigPDA.toString()}\\n` +\n        `Recovery Phrase: ${recoveryPhrase}\\n` +\n        'Vui lòng lưu lại thông tin này để sử dụng sau này!');\n      \n      // Kiểm tra số dư của ví PDA sau khi tạo\n      await loadPdaBalance(multisigPDA);\n      \n    } catch (error: any) {\n      console.error('Lỗi trong quá trình tạo ví:', error);\n      setTransactionStatus(`Lỗi: ${error.message}`);\n    }\n  };\n\n\n\n\n  const loadPdaBalance = async (address: PublicKey) => {\n    try {\n      const balance = await connection.getBalance(address);\n      setPdaBalance(balance / LAMPORTS_PER_SOL);\n    } catch (error) {\n      setPdaBalance(0);\n    }\n  };\n\n  const getGuardianPda = (guardianId: number): PublicKey | null => {\n    if (!multisigAddress) return null;\n    \n    const [guardianPda] = PublicKey.findProgramAddressSync(\n      [\n        Buffer.from('guardian'),\n        multisigAddress.toBuffer(),\n        Buffer.from(guardianId.toString())\n      ],\n      PROGRAM_ID\n    );\n    return guardianPda;\n  };\n\n  const checkGuardianExists = async (guardianId: number): Promise<boolean> => {\n    const guardianPda = getGuardianPda(guardianId);\n    if (!guardianPda) return false;\n    \n    try {\n      const accountInfo = await connection.getAccountInfo(guardianPda);\n      return accountInfo !== null;\n    } catch (error) {\n      return false;\n    }\n  };\n\n  // Hàm để lấy danh sách guardian ID hiện có\n  const getGuardianIdsList = async (): Promise<number[]> => {\n    if (!multisigAddress) return [];\n    \n    try {\n      const existingIds: number[] = [];\n      for (let i = 1; i <= 8; i++) {\n        if (await checkGuardianExists(i)) {\n          existingIds.push(i);\n        }\n      }\n      return existingIds;\n    } catch (error) {\n      console.error(\"Lỗi khi lấy danh sách guardian:\", error);\n      return [];\n    }\n  };\n\n  const findGuardianAddress = async (guardianId: number = 1) => {\n    if (!multisigAddress) return null;\n    \n    try {\n      const guardianIdBigInt = BigInt(guardianId);\n      const guardianIdBytes = bigIntToLeBytes(guardianIdBigInt);\n      \n      // Tính PDA cho guardian trực tiếp từ multisigAddress\n      const [guardianPDA] = PublicKey.findProgramAddressSync(\n        [\n          Buffer.from(\"guardian\"),\n          multisigAddress.toBuffer(),\n          guardianIdBytes\n        ],\n        PROGRAM_ID\n      );\n      \n      if (guardianId === 1) {\n        setGuardianPDA(guardianPDA); // Chỉ set state cho guardian chính (ID=1)\n      }\n      return guardianPDA;\n    } catch (error) {\n      console.error(`Lỗi khi tính PDA cho guardian ID ${guardianId}:`, error);\n      return null;\n    }\n  };\n\n  // Airdrop SOL cho testing\n  const requestAirdrop = async () => {\n    if (!projectFeePayerKeypair) {\n      setTransactionStatus('Không tìm thấy fee payer của dự án.');\n      return;\n    }\n    \n    try {\n      setTransactionStatus('Đang yêu cầu airdrop cho fee payer của dự án...');\n      const signature = await connection.requestAirdrop(\n        projectFeePayerKeypair.publicKey,\n        2_000_000_000 // 2 SOL\n      );\n      \n      await connection.confirmTransaction(signature);\n      // Tải lại số dư của fee payer\n      await loadFeePayerBalance(projectFeePayerKeypair);\n      setTransactionStatus('Airdrop thành công! 2 SOL đã được thêm vào ví fee payer của dự án.');\n    } catch (error: any) {\n      console.error('Lỗi khi thực hiện airdrop:', error);\n      setTransactionStatus(`Lỗi airdrop: ${error.message}. Đang thử phương thức chuyển tiền trực tiếp...`);\n      \n      // Thử phương pháp khác nếu airdrop thất bại\n      fundFromValidator(projectFeePayerKeypair);\n    }\n  };\n  const fundFromValidator = async (keypair: Keypair) => {\n    try {\n      setTransactionStatus('Đang chuyển tiền từ validator vào fee payer...');\n      \n      // Tạo kết nối với validator wallet (địa chỉ mặc định của validator)\n      const validatorKey = new PublicKey('E6mJJmCvg4PDhanmaBxxeyTczza9vKpMgirRUD6Qz5kv');\n      \n      // Tạo transaction chuyển tiền\n      const transaction = new Transaction().add(\n        SystemProgram.transfer({\n          fromPubkey: validatorKey,\n          toPubkey: keypair.publicKey,\n          lamports: 2_000_000_000 // 2 SOL\n        })\n      );\n      \n      // Lấy các thông tin cần thiết cho transaction\n      transaction.feePayer = validatorKey;\n      transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n      \n      // Không thể ký transaction vì không có private key của validator\n      // Thay vào đó, sử dụng phương thức sendTransactionWithRetry không cần chữ ký\n      const signature = await connection.sendTransaction(\n        transaction,\n        [] // Không cần signers khi gửi đến validator local\n      );\n      \n      await connection.confirmTransaction(signature);\n      \n      // Tải lại số dư\n      if (keypair === projectFeePayerKeypair) {\n        await loadFeePayerBalance(keypair);\n        setTransactionStatus('Chuyển tiền thành công! 2 SOL đã được thêm vào ví fee payer của dự án.');\n      } else {\n        await loadBalance(keypair);\n        setTransactionStatus('Chuyển tiền thành công! 2 SOL đã được thêm vào ví.');\n      }\n    } catch (error: any) {\n      console.error('Lỗi khi chuyển tiền từ validator:', error);\n      setTransactionStatus(`Lỗi khi chuyển tiền: ${error.message}. Hãy thử khởi động lại validator.`);\n    }\n  };\n\n\n  const getWalletInfo = async () => {\n    if (!multisigAddress) return;\n    \n    try {\n      setTransactionStatus('Đang truy vấn thông tin ví...');\n      \n      // Load balance trước\n      await loadPdaBalance(multisigAddress);\n      \n      const multisigAccount = await connection.getAccountInfo(multisigAddress);\n      \n      if (!multisigAccount) {\n        setTransactionStatus('Ví chưa được khởi tạo');\n        return;\n      }\n      \n      const data = multisigAccount.data.slice(8);\n      \n      const threshold = data[0];\n      const guardian_count = data[1];\n      const recovery_nonce = new DataView(data.buffer, data.byteOffset + 2, 8).getBigUint64(0, true);\n      const bump = data[10];\n      const transaction_nonce = new DataView(data.buffer, data.byteOffset + 11, 8).getBigUint64(0, true);\n      const last_transaction_timestamp = new DataView(data.buffer, data.byteOffset + 19, 8).getBigInt64(0, true);\n      \n      // Hiển thị thông tin\n      setTransactionStatus(\n        `Thông tin ví:\\n` +\n        `- Threshold: ${threshold}\\n` +\n        `- Guardian Count: ${guardian_count}\\n` +\n        `- Recovery Nonce: ${recovery_nonce}\\n` +\n        `- Bump: ${bump}\\n` +\n        `- Transaction Nonce: ${transaction_nonce}\\n` +\n        `- Last Transaction Timestamp: ${last_transaction_timestamp}`\n      );\n    } catch (error: any) {\n      console.error('Lỗi khi truy vấn thông tin ví:', error);\n      setTransactionStatus(`Lỗi: ${error.message}`);\n    }\n  };\n  \n  // Xem thông tin guardian\n  const getGuardianInfo = async () => {\n    if (!multisigAddress) {\n      setTransactionStatus('Vui lòng tạo ví trước khi xem thông tin guardian');\n      return;\n    }\n    \n    try {\n      setTransactionStatus(`Đang truy vấn thông tin guardian ID=${selectedGuardianId}...`);\n      \n      // Tính guardian PDA dựa trên ID được chọn\n      const guardianPDA = await findGuardianAddress(selectedGuardianId);\n      \n      if (!guardianPDA) {\n        setTransactionStatus('Không thể tìm thấy địa chỉ Guardian');\n        return;\n      }\n      \n      console.log(`Đang truy vấn thông tin guardian ID=${selectedGuardianId} với PDA: ${guardianPDA.toString()}`);\n      const guardianAccount = await connection.getAccountInfo(guardianPDA);\n      \n      if (!guardianAccount) {\n        console.log(`Không tìm thấy thông tin account tại địa chỉ: ${guardianPDA.toString()}`);\n        setTransactionStatus(`Guardian với ID=${selectedGuardianId} chưa được khởi tạo hoặc không tồn tại`);\n        return;\n      }\n      \n      console.log(`Đã tìm thấy account tại địa chỉ: ${guardianPDA.toString()}`);\n      console.log(`Data size: ${guardianAccount.data.length} bytes`);\n      console.log(`Owner: ${guardianAccount.owner.toString()}`);\n      \n      // Kiểm tra xem account có thuộc về program của chúng ta không\n      if (!guardianAccount.owner.equals(PROGRAM_ID)) {\n        console.error(`Account không thuộc về program của chúng ta. Owner: ${guardianAccount.owner.toString()}`);\n        setTransactionStatus(`Guardian với ID=${selectedGuardianId} không thuộc về program của chúng ta`);\n        return;\n      }\n      \n      // Bỏ qua 8 byte discriminator\n      const data = guardianAccount.data.slice(8);\n      console.log(`Data sau khi bỏ qua discriminator: ${data.length} bytes`);\n      console.log(`Raw data: ${Buffer.from(data).toString('hex').substring(0, 100)}...`);\n      \n      try {\n    \n        \n        // Đọc wallet address (32 bytes)\n        const walletBytes = data.slice(0, 32);\n        const wallet = new PublicKey(walletBytes);\n        console.log(`Wallet address parsed: ${wallet.toString()}`);\n        \n        // Đọc guardian_id (8 bytes - u64)\n        const guardianIdBytes = data.slice(32, 40);\n        let guardianId = BigInt(0);\n        for (let i = 0; i < 8; i++) {\n          guardianId |= BigInt(guardianIdBytes[i]) << BigInt(8 * i);\n        }\n        console.log(`Guardian ID parsed: ${guardianId}`);\n        \n        // Đọc name (string dài tối đa 32 bytes)\n        const nameLength = new DataView(data.buffer, data.byteOffset + 40, 4).getUint32(0, true);\n        console.log(`Guardian name length: ${nameLength}`);\n        \n        if (nameLength > 100) {\n          console.error(`Name length quá lớn: ${nameLength}, có thể không đúng cấu trúc dữ liệu`);\n          throw new Error(\"Lỗi parse dữ liệu guardian: Name length không hợp lệ\");\n        }\n        \n        // Vị trí bắt đầu của name bytes\n        const nameOffset = 44;\n        const nameBytes = data.slice(nameOffset, nameOffset + nameLength);\n        const name = new TextDecoder().decode(nameBytes);\n        console.log(`Guardian name parsed: ${name}`);\n        \n        // Vị trí tiếp theo sau name\n        let currentOffset = nameOffset + nameLength;\n        \n        // Đọc is_active (1 byte)\n        const isActive = data[currentOffset] === 1;\n        console.log(`Is active byte: ${data[currentOffset]} (offset: ${currentOffset})`);\n        currentOffset += 1;\n        \n        // Đọc recovery_hash (32 bytes)\n        const recoveryHash = data.slice(currentOffset, currentOffset + 32);\n        const recoveryHashHex = Buffer.from(recoveryHash).toString('hex');\n        console.log(`Recovery hash (hex): ${recoveryHashHex} (offset: ${currentOffset})`);\n        currentOffset += 32;\n        \n        // Đọc is_owner (1 byte)\n        const isOwner = data[currentOffset] === 1;\n        console.log(`Is owner byte: ${data[currentOffset]} (offset: ${currentOffset})`);\n        currentOffset += 1;\n        \n        // Đọc webauthn_pubkey (option, 1 byte discriminator + 33 bytes if Some)\n        const hasWebauthn = data[currentOffset] === 1;\n        console.log(`Has webauthn byte: ${data[currentOffset]} (offset: ${currentOffset})`);\n        currentOffset += 1;\n        \n        let webauthnPubkey = null;\n        if (hasWebauthn) {\n          webauthnPubkey = data.slice(currentOffset, currentOffset + 33);\n          const webauthnHex = Buffer.from(webauthnPubkey).toString('hex');\n          console.log(`WebAuthn pubkey: ${webauthnHex} (offset: ${currentOffset})`);\n          // Log thêm thông tin về format của key\n          console.log(`WebAuthn key format byte: 0x${webauthnHex.slice(0, 2)} (${webauthnPubkey[0]})`);\n          currentOffset += 33;\n        }\n        \n        // Đọc bump (1 byte)\n        const bump = data[currentOffset];\n        console.log(`Bump: ${bump} (offset: ${currentOffset})`);\n        \n        // Hiển thị thông tin\n        setTransactionStatus(\n          `Thông tin Guardian (ID=${guardianId}):\\n` +\n          `- Loại Guardian: ${isOwner ? 'Owner (Quản trị viên)' : 'Regular (Thành viên)'}\\n` +\n          `- Wallet: ${wallet.toString()}\\n` +\n          `- Guardian ID: ${guardianId}\\n` +\n          `- Name: ${name}\\n` +\n          `- Active: ${isActive ? 'Có' : 'Không'}\\n` +\n          `- Recovery Hash: ${recoveryHashHex.slice(0, 10)}...${recoveryHashHex.slice(-10)}\\n` +\n          (hasWebauthn ? `- WebAuthn Key: ${Buffer.from(webauthnPubkey!).toString('hex')}\\n` : '') +\n          (hasWebauthn ? `- WebAuthn Key Format: ${webauthnPubkey![0] === 2 ? '02 (even y)' : \n                                                (webauthnPubkey![0] === 3 ? '03 (odd y)' : \n                                                webauthnPubkey![0].toString())}\\n` : '') +\n          (hasWebauthn ? `- Công dụng: ${isOwner ? 'Dùng để ký giao dịch và quản lý ví' : 'Dùng để xác thực từ thiết bị này'}\\n` : '') +\n          `- Bump: ${bump}\\n` +\n          `- PDA: ${guardianPDA.toString()}`\n        );\n      } catch (parseError) {\n        console.error(\"Lỗi khi parse dữ liệu guardian:\", parseError);\n        \n        // Hiển thị thông tin thô nếu không thể parse\n        setTransactionStatus(\n          `Không thể parse dữ liệu guardian chi tiết. Dữ liệu thô:\\n` +\n          `- PDA: ${guardianPDA.toString()}\\n` +\n          `- Data size: ${guardianAccount.data.length} bytes\\n` +\n          `- Raw data: ${Buffer.from(guardianAccount.data).toString('hex').substring(0, 100)}...\\n` +\n          `- Error: ${parseError}`\n        );\n      }\n    } catch (error: any) {\n      console.error('Lỗi khi truy vấn thông tin guardian:', error);\n      setTransactionStatus(`Lỗi: ${error.message}`);\n    }\n  };\n\n  // Hàm để lấy danh sách guardian ID hiện có\n  const getExistingGuardianIds = async () => {\n    if (!multisigAddress) return [];\n    \n    try {\n      setTransactionStatus('Đang kiểm tra danh sách Guardian ID...');\n      \n      const guardianIds: number[] = [];\n      \n      // Kiểm tra guardian từ ID 1 đến 8\n      for (let i = 1; i <= 8; i++) {\n        try {\n          // Tính PDA cho guardian với ID i sử dụng hàm đã sửa\n          const guardianPDA = await findGuardianAddress(i);\n          \n          if (!guardianPDA) {\n            console.log(`Guardian ID ${i}: Không tính được PDA`);\n            continue;\n          }\n          \n          // Kiểm tra xem guardian với ID này có tồn tại không\n          console.log(`Đang kiểm tra Guardian ID ${i} tại địa chỉ: ${guardianPDA.toString()}`);\n          const guardianAccount = await connection.getAccountInfo(guardianPDA);\n          \n          if (guardianAccount) {\n            guardianIds.push(i);\n            console.log(`Guardian ID ${i} đã tồn tại - PDA: ${guardianPDA.toString()}`);\n            console.log(`  - Owner: ${guardianAccount.owner.toString()}`);\n            console.log(`  - Data size: ${guardianAccount.data.length} bytes`);\n            \n            // Kiểm tra discriminator (8 bytes đầu)\n            const discriminator = guardianAccount.data.slice(0, 8);\n            console.log(`  - Discriminator: ${Buffer.from(discriminator).toString('hex')}`);\n          } else {\n            console.log(`Guardian ID ${i}: Account không tồn tại tại địa chỉ ${guardianPDA.toString()}`);\n          }\n        } catch (error) {\n          console.error(`Lỗi khi kiểm tra guardian ID ${i}:`, error);\n        }\n      }\n      \n      console.log(\"Danh sách guardian ID hiện tại:\", guardianIds);\n      \n      // Nếu không có guardian nào, thêm ID 1 vào danh sách để có thể chọn\n      if (guardianIds.length === 0) {\n        guardianIds.push(1);\n        console.log(\"Không tìm thấy guardian nào, thêm ID 1 mặc định vào danh sách\");\n      }\n      \n      setExistingGuardians(guardianIds);\n      \n      // Đảm bảo selectedGuardianId nằm trong danh sách các ID hiện có\n      if (!guardianIds.includes(selectedGuardianId)) {\n        console.log(`Selected Guardian ID ${selectedGuardianId} không tồn tại, chuyển sang ID ${guardianIds[0]}`);\n        setSelectedGuardianId(guardianIds[0]);\n      }\n      \n      setTransactionStatus(`Đã tìm thấy ${guardianIds.length} guardian. IDs: ${guardianIds.join(', ')}`);\n      return guardianIds;\n    } catch (error) {\n      console.error(\"Lỗi khi lấy danh sách guardian:\", error);\n      return [];\n    }\n  };\n  \n  // Hàm sinh guardian ID mới không bị trùng\n  const generateNewGuardianId = (existingIds: number[]) => {\n    // Nếu không có ID nào tồn tại, bắt đầu từ 2 (vì ID 1 thường là owner)\n    if (existingIds.length === 0) return 2;\n    \n    // Tìm ID nhỏ nhất không bị trùng\n    let newId = 1;\n    while (existingIds.includes(newId)) {\n      newId++;\n    }\n    \n    return newId;\n  };\n  \n  // Hàm thêm guardian mới với chữ ký WebAuthn riêng\n  const addNewGuardian = async () => {\n    try {\n      // Kiểm tra xem ví đã được tạo chưa\n      if (!multisigAddress) {\n        setTransactionStatus('Vui lòng tạo ví trước khi thêm guardian.');\n        return;\n      }\n      \n      // Kiểm tra xem có fee payer hay không\n      if (!projectFeePayerKeypair) {\n        setTransactionStatus('Không tìm thấy fee payer của dự án. Vui lòng thử lại sau.');\n        return;\n      }\n      \n      // Kiểm tra các trường bắt buộc\n      if (!newGuardianName || !newRecoveryPhrase || newRecoveryPhrase.length < 8) {\n        setTransactionStatus('Vui lòng nhập tên guardian và recovery phrase (ít nhất 8 ký tự).');\n        return;\n      }\n      \n      setTransactionStatus('Đang thêm guardian mới...\\n\\nBước 1: Tạo khóa WebAuthn cho guardian mới...');\n      \n      // Lấy danh sách guardian ID hiện tại\n      const existingIds = await getExistingGuardianIds();\n      \n      // Sinh guardian ID mới không bị trùng\n      const newGuardianId = generateNewGuardianId(existingIds);\n      console.log(\"=== ADD GUARDIAN === Guardian ID mới được sinh:\", newGuardianId);\n      \n      // 1. Tạo khóa WebAuthn cho guardian mới\n      try {\n        // Sử dụng một định danh duy nhất cho khóa mới\n        const guardianIdentifier = `${multisigAddress?.toString()}_guardian_${newGuardianId}`;\n        const webAuthnResult = await createWebAuthnCredential(guardianIdentifier, newGuardianName);\n        \n        // Log thông tin WebAuthn\n        console.log(\"=== ADD GUARDIAN === WebAuthn credential mới đã được tạo:\");\n        console.log(\"=== ADD GUARDIAN === Credential ID:\", webAuthnResult.credentialId);\n        console.log(\"=== ADD GUARDIAN === Public Key:\", webAuthnResult.publicKey);\n        \n        setTransactionStatus(prev => prev + `\\nĐã tạo khóa WebAuthn thành công!`);\n        \n        // 2. Tính PDA cho guardian mới\n        const guardianPDA = await findGuardianAddress(newGuardianId);\n        \n        if (!guardianPDA) {\n          setTransactionStatus('Không thể tính PDA cho guardian mới.');\n          return;\n        }\n        \n        console.log(\"=== ADD GUARDIAN === Guardian PDA mới:\", guardianPDA.toString());\n        \n        // Kiểm tra trước xem guardian account đã tồn tại chưa\n        const existingGuardian = await connection.getAccountInfo(guardianPDA);\n        if (existingGuardian) {\n          console.log(\"=== ADD GUARDIAN === Guardian account đã tồn tại!\", existingGuardian);\n          setTransactionStatus(`Guardian với ID=${newGuardianId} đã tồn tại rồi. Hãy chọn ID khác.`);\n          return;\n        }\n        \n        // 3. Hash recovery phrase\n        const hashedRecoveryBytes = await hashRecoveryPhrase(newRecoveryPhrase);\n        console.log(\"=== ADD GUARDIAN === Recovery phrase sau khi hash:\", Buffer.from(hashedRecoveryBytes).toString('hex'));\n        \n        // 4. Chuyển đổi guardian ID thành bytes (little-endian)\n        const guardianIdBigInt = BigInt(newGuardianId);\n        const guardianIdBytes = bigIntToLeBytes(guardianIdBigInt);\n        \n        // 5. Nén khóa WebAuthn từ 65 bytes (uncompressed) thành 33 bytes (compressed)\n        const uncompressedKeyBuffer = Buffer.from(webAuthnResult.publicKey, 'hex');\n        console.log(\"=== ADD GUARDIAN === WebAuthn key (uncompressed, 65 bytes):\", webAuthnResult.publicKey);\n        \n        // Nén khóa thành 33 bytes\n        const compressedKeyBuffer = compressPublicKey(uncompressedKeyBuffer);\n        console.log(\"=== ADD GUARDIAN === WebAuthn key (compressed, 33 bytes):\", compressedKeyBuffer.toString('hex'));\n        \n        // 6. Tạo discriminator cho add_guardian\n        const addGuardianDiscriminator = new Uint8Array([167, 189, 170, 27, 74, 240, 201, 241]);\n        \n        // 7. Chuẩn bị tên guardian\n        const guardianNameBuffer = Buffer.from(newGuardianName);\n        const guardianNameLenBuffer = Buffer.alloc(4);\n        guardianNameLenBuffer.writeUInt32LE(guardianNameBuffer.length, 0);\n        \n        // 8. Đặt is_owner = false vì đây là guardian member, không phải owner\n        const isOwnerByte = new Uint8Array([0]); // false = 0\n        \n        // 9. Cấu hình webauthn_pubkey là Some(compressed_key)\n        const hasWebauthn = new Uint8Array([1]); // Some variant\n        \n        // 10. Tạo dữ liệu instruction\n        const addGuardianData = concatUint8Arrays(\n          addGuardianDiscriminator,\n          // guardian_id (u64)\n          bufferToUint8Array(Buffer.from(guardianIdBytes)),\n          // guardian_name (string)\n          bufferToUint8Array(guardianNameLenBuffer),\n          bufferToUint8Array(guardianNameBuffer),\n          // recovery_hash_intermediate ([u8; 32])\n          hashedRecoveryBytes,\n          // is_owner (bool)\n          isOwnerByte,\n          // webauthn_pubkey (Option<[u8; 33]>) - Some variant + compressed key\n          hasWebauthn,\n          bufferToUint8Array(compressedKeyBuffer)\n        );\n        \n        // Log dữ liệu instruction để debug\n        console.log(\"=== ADD GUARDIAN === Dữ liệu instruction:\", {\n          discriminator: Buffer.from(addGuardianDiscriminator).toString('hex'),\n          guardianId: newGuardianId.toString(),\n          guardianIdBytes: Buffer.from(guardianIdBytes).toString('hex'),\n          nameLength: guardianNameBuffer.length,\n          name: newGuardianName,\n          recoveryHashHex: Buffer.from(hashedRecoveryBytes).toString('hex'),\n          isOwner: false,\n          hasWebauthn: true,\n          webauthnPubkey: compressedKeyBuffer.toString('hex')\n        });\n        \n        setTransactionStatus(prev => prev + `\\n\\nBước 2: Đang thêm guardian vào blockchain...`);\n        \n        // 11. Tạo transaction add guardian\n        const addGuardianTransaction = new Transaction();\n        addGuardianTransaction.add(\n          new TransactionInstruction({\n            keys: [\n              { pubkey: multisigAddress, isSigner: false, isWritable: true },\n              { pubkey: guardianPDA, isSigner: false, isWritable: true },\n              { pubkey: projectFeePayerKeypair.publicKey, isSigner: false, isWritable: false },\n              { pubkey: projectFeePayerKeypair.publicKey, isSigner: true, isWritable: true },\n              { pubkey: SystemProgram.programId, isSigner: false, isWritable: false }\n            ],\n            programId: PROGRAM_ID,\n            data: Buffer.from(addGuardianData)\n          })\n        );\n        \n        // Sign và gửi transaction với fee payer của dự án\n        addGuardianTransaction.feePayer = projectFeePayerKeypair.publicKey;\n        addGuardianTransaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n        \n        console.log(\"=== ADD GUARDIAN === Đang gửi transaction...\");\n        const addGuardianSignature = await connection.sendTransaction(\n          addGuardianTransaction,\n          [projectFeePayerKeypair] as Signer[]\n        );\n        \n        console.log(\"=== ADD GUARDIAN === Transaction đã gửi. Signature:\", addGuardianSignature);\n        \n        setTransactionStatus(prev => prev + `\\nĐang xác nhận transaction thêm guardian...`);\n        await connection.confirmTransaction(addGuardianSignature);\n        \n        setTransactionStatus(`Guardian mới đã được thêm thành công với ID: ${newGuardianId}!\\n` +\n          `Chữ ký WebAuthn đã được lưu cho guardian này.\\n` +\n          `Signature: ${addGuardianSignature}`\n        );\n        \n        // Kiểm tra xem guardian đã được thêm thành công chưa\n        console.log(\"=== ADD GUARDIAN === Đang kiểm tra guardian vừa thêm...\");\n        await new Promise(resolve => setTimeout(resolve, 2000)); // Đợi 2 giây\n        \n        const newGuardianAccount = await connection.getAccountInfo(guardianPDA);\n        if (newGuardianAccount) {\n          console.log(\"=== ADD GUARDIAN === Guardian đã được thêm thành công!\");\n          console.log(`=== ADD GUARDIAN === Data size: ${newGuardianAccount.data.length} bytes`);\n          \n          // Kiểm tra discriminator\n          const discriminator = newGuardianAccount.data.slice(0, 8);\n          console.log(`=== ADD GUARDIAN === Discriminator: ${Buffer.from(discriminator).toString('hex')}`);\n        } else {\n          console.log(\"=== ADD GUARDIAN === Guardian không được tìm thấy sau khi thêm!\");\n          setTransactionStatus(prev => prev + '\\n\\nCẢNH BÁO: Guardian có vẻ như chưa được khởi tạo trên blockchain mặc dù transaction đã thành công!');\n        }\n        \n        // Cập nhật danh sách guardian\n        await getExistingGuardianIds();\n        \n        // Cập nhật số dư của ví PDA\n        await loadPdaBalance(multisigAddress);\n        \n        // Reset form\n        setNewGuardianName('');\n        setNewRecoveryPhrase('');\n      } catch (webAuthnError: any) {\n        console.error(\"=== ADD GUARDIAN === Lỗi khi tạo khóa WebAuthn:\", webAuthnError);\n        setTransactionStatus(`Lỗi khi tạo khóa WebAuthn: ${webAuthnError.message || 'Không xác định'}. Vui lòng thử lại.`);\n        return;\n      }\n    } catch (error: any) {\n      console.error(\"=== ADD GUARDIAN === Lỗi khi thêm guardian mới:\", error);\n      setTransactionStatus(`Lỗi khi thêm guardian mới: ${error.message}`);\n    }\n  };\n\n  // Hàm để nạp SOL vào ví multisig\n  const depositToMultisig = async () => {\n    try {\n      // Kiểm tra xem ví đã được tạo chưa\n      if (!multisigAddress) {\n        setTransactionStatus('Vui lòng tạo ví trước khi nạp tiền.');\n        return;\n      }\n      \n      // Kiểm tra xem có fee payer hay không\n      if (!projectFeePayerKeypair) {\n        setTransactionStatus('Không tìm thấy fee payer của dự án. Vui lòng thử lại sau.');\n        return;\n      }\n      \n      // Kiểm tra số tiền hợp lệ\n      if (!depositAmount || depositAmount <= 0) {\n        setTransactionStatus('Vui lòng nhập số tiền hợp lệ để nạp.');\n        return;\n      }\n      \n      // Kiểm tra số dư của fee payer\n      const feePayerBalance = await connection.getBalance(projectFeePayerKeypair.publicKey);\n      const lamportsToSend = depositAmount * LAMPORTS_PER_SOL;\n      \n      if (feePayerBalance < lamportsToSend + 5000) { // 5000 lamports cho phí giao dịch\n        setTransactionStatus(`Số dư fee payer không đủ. Hiện tại: ${feePayerBalance / LAMPORTS_PER_SOL} SOL`);\n        return;\n      }\n      \n      setTransactionStatus(`Đang nạp ${depositAmount} SOL vào ví...`);\n      \n      // Tạo transaction chuyển tiền\n      const transaction = new Transaction().add(\n        SystemProgram.transfer({\n          fromPubkey: projectFeePayerKeypair.publicKey,\n          toPubkey: multisigAddress,\n          lamports: lamportsToSend\n        })\n      );\n      \n      // Cấu hình transaction\n      transaction.feePayer = projectFeePayerKeypair.publicKey;\n      transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;\n      \n      // Ký và gửi transaction\n      const signature = await connection.sendTransaction(\n        transaction,\n        [projectFeePayerKeypair]\n      );\n      \n      await connection.confirmTransaction(signature);\n      \n      // Cập nhật số dư\n      await loadPdaBalance(multisigAddress);\n      await loadFeePayerBalance(projectFeePayerKeypair);\n      \n      setTransactionStatus(`Đã nạp thành công ${depositAmount} SOL vào ví! Signature: ${signature}`);\n    } catch (error: any) {\n      console.error('Lỗi khi nạp tiền vào ví:', error);\n      setTransactionStatus(`Lỗi khi nạp tiền: ${error.message}`);\n    }\n  };\n\n  \n\n  // Tự động cập nhật danh sách guardians khi multisigAddress thay đổi\n  useEffect(() => {\n    if (multisigAddress) {\n      // Load lại danh sách guardian IDs\n      getExistingGuardianIds();\n      \n      // Load số dư của PDA\n      loadPdaBalance(multisigAddress);\n    }\n  }, [multisigAddress]);\n\n  // Hàm để kiểm tra guardian ID cụ thể\n  const testGuardianInfo = async (id: number) => {\n    if (!multisigAddress) {\n      setTransactionStatus('Ví chưa được khởi tạo');\n      return;\n    }\n    \n    setTransactionStatus(`Đang kiểm tra chi tiết Guardian ID ${id}...`);\n    \n    try {\n      // Tính PDA \n      const guardianPDA = await findGuardianAddress(id);\n      if (!guardianPDA) {\n        setTransactionStatus(`Không thể tính PDA cho Guardian ID ${id}`);\n        return;\n      }\n      \n      console.log(`=== TEST === Đang kiểm tra chi tiết Guardian ID ${id} tại ${guardianPDA.toString()}`);\n      \n      const guardianAccount = await connection.getAccountInfo(guardianPDA);\n      if (!guardianAccount) {\n        console.log(`=== TEST === Account không tồn tại tại địa chỉ ${guardianPDA.toString()}`);\n        setTransactionStatus(`Guardian ID ${id} không tồn tại trên blockchain`);\n        return;\n      }\n      \n      console.log(`=== TEST === Account tồn tại!`);\n      console.log(`=== TEST === Owner: ${guardianAccount.owner.toString()}`);\n      console.log(`=== TEST === Data size: ${guardianAccount.data.length} bytes`);\n      \n      // Kiểm tra discriminator\n      const discriminator = guardianAccount.data.slice(0, 8);\n      console.log(`=== TEST === Discriminator: ${Buffer.from(discriminator).toString('hex')}`);\n      \n      // Bỏ qua 8 byte discriminator\n      const data = guardianAccount.data.slice(8);\n      \n      try {\n        // Wallet (32 bytes)\n        const walletBytes = data.slice(0, 32);\n        const wallet = new PublicKey(walletBytes);\n        console.log(`=== TEST === Wallet: ${wallet.toString()}`);\n        \n        // Guardian ID (8 bytes)\n        const guardianIdBytes = data.slice(32, 40);\n        let guardianId = BigInt(0);\n        for (let i = 0; i < 8; i++) {\n          guardianId |= BigInt(guardianIdBytes[i]) << BigInt(8 * i);\n        }\n        console.log(`=== TEST === Guardian ID parsed: ${guardianId}`);\n        \n        // Name\n        const nameLength = new DataView(data.buffer, data.byteOffset + 40, 4).getUint32(0, true);\n        console.log(`=== TEST === Name length: ${nameLength}`);\n        \n        // Nếu name length hợp lệ, tiếp tục parse\n        if (nameLength <= 100) {\n          const nameBytes = data.slice(44, 44 + nameLength);\n          const name = new TextDecoder().decode(nameBytes);\n          console.log(`=== TEST === Name: ${name}`);\n          \n          setTransactionStatus(`Guardian ID ${id} tồn tại!\\n- PDA: ${guardianPDA.toString()}\\n- Wallet: ${wallet.toString()}\\n- Name: ${name}\\n- Guardian ID: ${guardianId}`);\n        } else {\n          console.log(`=== TEST === Name length không hợp lệ`);\n          setTransactionStatus(`Guardian ID ${id} tồn tại nhưng có cấu trúc dữ liệu không hợp lệ`);\n        }\n      } catch (parseError) {\n        console.error(`=== TEST === Lỗi khi parse dữ liệu:`, parseError);\n        setTransactionStatus(`Guardian ID ${id} tồn tại nhưng không thể parse dữ liệu: ${parseError}`);\n      }\n      \n    } catch (error: any) {\n      console.error(`=== TEST === Lỗi:`, error);\n      setTransactionStatus(`Lỗi khi kiểm tra: ${error.message}`);\n    }\n  };\n\n  // Hàm đăng nhập vào ví đã tạo\n  const loginToWallet = async () => {\n    try {\n      setIsLoggingIn(true);\n      setTransactionStatus('Đang đăng nhập vào ví...\\n\\nBước 1: Đang yêu cầu xác thực WebAuthn...');\n      \n      // 1. Yêu cầu người dùng xác thực với thiết bị (không cần nhập credential ID cụ thể)\n      try {\n        // Gọi hàm getWebAuthnAssertionForLogin với allowEmpty=true để cho phép người dùng chọn từ bất kỳ credential nào\n        const assertionResult = await getWebAuthnAssertionForLogin('', true);\n        \n        if (!assertionResult.success || !assertionResult.rawId) {\n          throw new Error(assertionResult.error || 'Không thể xác thực với thiết bị');\n        }\n        \n        // Lấy thông tin credential từ phản hồi\n        const credentialRawData = assertionResult.rawId;\n        \n        // Chuyển rawId thành hex để sử dụng làm key trong bảng webauthn_credentials\n        const credentialIdHex = Buffer.from(credentialRawData).toString('hex');\n        console.log(\"Credential ID (hex):\", credentialIdHex);\n        \n        // Chuyển rawId thành base64 để sử dụng trong blockchain\n        const rawIdBase64 = Buffer.from(credentialRawData).toString('base64');\n        console.log(\"Raw credential ID (base64):\", rawIdBase64);\n        \n        setTransactionStatus(prev => prev + '\\nXác thực WebAuthn thành công!\\n\\nBước 2: Đang tìm thông tin ví...');\n        \n        // 2. Truy vấn thông tin ví từ bảng webauthn_credentials\n        const credentialMapping = await getWalletByCredentialId(credentialIdHex);\n        \n        if (credentialMapping) {\n          // Nếu tìm thấy trong bảng ánh xạ\n          setTransactionStatus(prev => prev + `\\nĐã tìm thấy thông tin ví trong database!`);\n          \n          // Chuyển đổi từ chuỗi sang PublicKey\n          const walletAddressFromDB = new PublicKey(credentialMapping.walletAddress);\n          console.log(\"Wallet address from database:\", walletAddressFromDB.toString());\n          \n          // 3. Kiểm tra xem ví có tồn tại trên blockchain không\n          const walletAccount = await connection.getAccountInfo(walletAddressFromDB);\n          \n          if (!walletAccount) {\n            setTransactionStatus(`Ví tìm thấy trong database không tồn tại trên blockchain. Địa chỉ: ${walletAddressFromDB.toString()}`);\n            setIsLoggingIn(false);\n            return;\n          }\n          \n          // 4. Cập nhật state với thông tin ví\n          setMultisigAddress(walletAddressFromDB);\n          setCredentialId(rawIdBase64); // Lưu credential ID gốc\n          \n          setTransactionStatus(prev => prev + `\\nĐã tìm thấy ví tại địa chỉ: ${walletAddressFromDB.toString()}\\n\\nBước 3: Đang tải thông tin ví...`);\n        } else {\n          // Nếu không tìm thấy trong bảng ánh xạ, sử dụng phương pháp tính toán cũ\n          setTransactionStatus(prev => prev + '\\nKhông tìm thấy thông tin trong database, đang tính toán địa chỉ ví...');\n          \n          // Tính địa chỉ ví từ credential ID\n          const multisigPDA = getMultisigPDA(rawIdBase64);\n          console.log(\"Computed Multisig PDA:\", multisigPDA.toString());\n          \n          // Kiểm tra xem ví có tồn tại không\n          const walletAccount = await connection.getAccountInfo(multisigPDA);\n          \n          if (!walletAccount) {\n            setTransactionStatus(`Không tìm thấy ví với credential này. Có thể bạn cần tạo ví mới.`);\n            setIsLoggingIn(false);\n            return;\n          }\n          \n          setTransactionStatus(prev => prev + `\\nĐã tìm thấy ví tại địa chỉ: ${multisigPDA.toString()}\\n\\nBước 3: Đang tải thông tin ví...`);\n          \n          // Cập nhật state với thông tin ví\n          setMultisigAddress(multisigPDA);\n          setCredentialId(rawIdBase64); // Lưu credential ID gốc\n        }\n        \n        // 5. Tìm guardian PDA\n        await findGuardianAddress(1); // Tìm guardian chính (owner)\n        \n        // 6. Tải số dư và danh sách guardian\n        await loadPdaBalance(multisigAddress!);\n        await getExistingGuardianIds();\n        \n        // 7. Hoàn thành đăng nhập\n        setIsLoggedIn(true);\n        setIsLoggingIn(false);\n        setTransactionStatus(`Đăng nhập thành công!\\n\\nĐịa chỉ ví: ${multisigAddress!.toString()}\\nSố guardian: ${existingGuardians.length}`);\n        \n        // 8. Ẩn form đăng nhập\n        setShowLoginForm(false);\n      } catch (webAuthnError: any) {\n        console.error(\"Lỗi khi xác thực WebAuthn:\", webAuthnError);\n        setTransactionStatus(`Lỗi khi xác thực: ${webAuthnError.message}`);\n        setIsLoggingIn(false);\n      }\n    } catch (error: any) {\n      console.error('Lỗi khi đăng nhập:', error);\n      setTransactionStatus(`Lỗi khi đăng nhập: ${error.message}`);\n      setIsLoggingIn(false);\n    }\n  };\n\n  // Hàm tạo mã mời ngẫu nhiên\n  const generateRandomCode = (length: number): string => {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    const randomValues = new Uint8Array(length);\n    crypto.getRandomValues(randomValues);\n    for (let i = 0; i < length; i++) {\n      result += chars.charAt(randomValues[i] % chars.length);\n    }\n    return result;\n  };\n\n  // Hàm tạo link mời guardian mới\n  const generateGuardianInvite = async () => {\n    try {\n      // Kiểm tra ví đã được tạo chưa\n      if (!multisigAddress) {\n        setTransactionStatus('Vui lòng tạo ví trước khi mời guardian.');\n        return;\n      }\n      \n      const existingIds = await getExistingGuardianIds();\n      const newGuardianId = generateNewGuardianId(existingIds);\n      const inviteCode = generateRandomCode(8);\n      const ngrokUrl = process.env.REACT_APP_NGROK_URL || window.location.origin;\n      const inviteLink = `${ngrokUrl}/#/guardian-signup/${inviteCode}`;\n      \n      setInviteCode(inviteCode);\n      setInviteLink(inviteLink);\n      setShowQRCode(true);\n\n      try {\n        await saveInvitation({\n          multisigAddress: multisigAddress.toString(),\n          guardianId: newGuardianId,\n          inviteCode,\n          status: 'pending',\n          ownerId: projectFeePayerKeypair?.publicKey.toString() || ''\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi lưu vào Firebase:\", error)\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n        setTransactionStatus(`Đã tạo link mời guardian: ${inviteLink}\\nLưu ý: Có lỗi khi lưu thông tin: ${errorMessage}`);\n        return inviteLink;\n      }\n      \n      setTransactionStatus(`Đã tạo link mời guardian: ${inviteLink}`);\n      \n      return inviteLink;\n    } catch (error: any) {\n      console.error(\"Lỗi khi tạo link mời guardian:\", error);\n      setTransactionStatus(`Lỗi khi tạo link mời guardian: ${error.message}`);\n      return null;\n    }\n  };\n\n  const loadPendingInvites = async () => {\n    try {\n      if (!projectFeePayerKeypair || !multisigAddress) return;\n      \n      const ownerId = projectFeePayerKeypair.publicKey.toString();\n      // Chỉ lọc guardian của chính ví multisig hiện tại\n      const multisigAddressStr = multisigAddress.toString();\n      const invitesList = await getPendingInvites(ownerId, multisigAddressStr);\n      setPendingInvites(invitesList);\n      \n      if (invitesList.length > 0) {\n        console.log(`Tìm thấy ${invitesList.length} guardian đang chờ hoàn tất cho ví ${multisigAddressStr}. Mã mời: ${invitesList.join(', ')}`);\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi tải danh sách mã mời:\", error);\n    }\n  };\n\n \n  useEffect(() => {\n    if (projectFeePayerKeypair && multisigAddress) {\n      loadPendingInvites();\n    }\n  }, [projectFeePayerKeypair, multisigAddress]);\n\n  // Hàm để lấy thông tin guardian đã đăng ký\n  const fetchGuardianDataFromDatabase = async (inviteCode: string) => {\n    try {\n      return await getGuardianData(inviteCode);\n    } catch (error) {\n      console.error(\"Lỗi khi lấy dữ liệu guardian:\", error);\n      return null;\n    }\n  };\n\n  // Hàm để lấy thông tin invitation\n  const fetchInviteFromDatabase = async (inviteCode: string) => {\n    try {\n      return await getInvitation(inviteCode);\n    } catch (error) {\n      console.error(\"Lỗi khi lấy dữ liệu invite:\", error);\n      return null;\n    }\n  };\n\n  // Hàm để cập nhật trạng thái guardian\n  const updateGuardianStatusInDatabase = async (inviteCode: string, status: string, txSignature?: string) => {\n    try {\n      await updateGuardianStatus(inviteCode, status as any, txSignature);\n    } catch (error) {\n      console.error(\"Lỗi khi cập nhật trạng thái guardian:\", error);\n    }\n  };\n\n\n  // Hàm kiểm tra thông tin guardians trong database\n  const checkGuardiansInDatabase = async () => {\n    try {\n      setTransactionStatus('Đang kiểm tra dữ liệu guardians từ Firestore...');\n      \n      if (!projectFeePayerKeypair || !multisigAddress) {\n        setTransactionStatus('Cần có thông tin fee payer và multisig address để kiểm tra.');\n        return;\n      }\n      \n      const ownerId = projectFeePayerKeypair.publicKey.toString();\n      const multisigAddressStr = multisigAddress.toString();\n      \n      // Lấy danh sách invitations đang chờ CHỈ của ví hiện tại\n      const pendingInvites = await getPendingInvites(ownerId, multisigAddressStr);\n      console.log(`Danh sách mã mời đang chờ cho ví ${multisigAddressStr}:`, pendingInvites);\n      \n      if (pendingInvites.length === 0) {\n        setTransactionStatus(`Không tìm thấy mã mời nào đang chờ xử lý cho ví ${multisigAddressStr}.`);\n        return;\n      }\n      \n      // Kiểm tra thông tin từng guardian\n      let resultMessage = 'Thông tin guardians từ database:\\n\\n';\n      \n      for (const inviteCode of pendingInvites) {\n        // Lấy thông tin invitation\n        const inviteData = await getInvitation(inviteCode);\n        if (!inviteData) {\n          resultMessage += `Mã mời ${inviteCode}: Không tìm thấy thông tin invitation.\\n`;\n          continue;\n        }\n        \n        // Lấy thông tin guardian\n        const guardianData = await getGuardianData(inviteCode);\n        if (!guardianData) {\n          resultMessage += `Mã mời ${inviteCode}: Invitation tồn tại nhưng chưa có thông tin guardian.\\n`;\n          continue;\n        }\n        \n        // Hiển thị thông tin\n        resultMessage += `Mã mời: ${inviteCode}\\n`;\n        resultMessage += `Guardian ID: ${guardianData.guardianId}\\n`;\n        resultMessage += `Tên guardian: ${guardianData.guardianName}\\n`;\n        resultMessage += `Trạng thái: ${guardianData.status}\\n`;\n        resultMessage += `WebAuthn ID: ${guardianData.webauthnCredentialId.substring(0, 20)}...\\n\\n`;\n      }\n      \n      setTransactionStatus(resultMessage);\n    } catch (error) {\n      console.error(\"Lỗi khi kiểm tra thông tin guardians:\", error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      setTransactionStatus(`Lỗi khi kiểm tra thông tin guardians: ${errorMessage}`);\n    }\n  };\n\n  // Hoàn tất quá trình đăng ký guardian dựa trên mã mời\n  const completeGuardianSetup = async (inviteCode: string) => {\n    try {\n      setTransactionStatus(`Đang hoàn tất quá trình đăng ký guardian với mã mời: ${inviteCode}...`);\n      \n      // 1. Lấy thông tin guardian\n      const guardianData = await getGuardianData(inviteCode);\n      if (!guardianData) {\n        setTransactionStatus('Không tìm thấy thông tin guardian. Vui lòng đảm bảo guardian đã hoàn tất đăng ký.');\n        return;\n      }\n      \n      if (guardianData.status !== 'ready') {\n        setTransactionStatus(`Guardian có trạng thái không hợp lệ: ${guardianData.status}`);\n        return;\n      }\n      \n      // 2. Thêm guardian vào blockchain\n      setTransactionStatus(prev => prev + '\\n\\nĐang thêm guardian vào blockchain...');\n      \n      // Tạo multisig PDA từ địa chỉ multisig\n      const multisigPubkey = new PublicKey(guardianData.multisigAddress);\n      \n      // Tạo WebAuthn public key từ dữ liệu lưu trữ\n      const webauthnPubkey = Buffer.from(new Uint8Array(guardianData.webauthnPublicKey));\n      \n      // Chuẩn bị dữ liệu guardian\n      const guardianIndex = guardianData.guardianId;\n      const guardianName = guardianData.guardianName;\n      const guardianType = 0; // 0 = Guardian thường\n      const recoveryHash = Uint8Array.from(guardianData.hashedRecoveryBytes);\n      \n      // Thêm guardian vào blockchain\n      if (projectFeePayerKeypair) {\n        // Tạo transaction\n        const tx = new Transaction();\n        \n        // Tìm PDA cho guardian\n        const guardianIdBigInt = BigInt(guardianIndex);\n        const guardianIdBytes = bigIntToLeBytes(guardianIdBigInt);\n        \n        const [guardianPDA] = await PublicKey.findProgramAddress(\n          [\n            Buffer.from(\"guardian\"),\n            multisigPubkey.toBuffer(),\n            guardianIdBytes\n          ],\n          PROGRAM_ID\n        );\n        \n        const addGuardianDiscriminator = new Uint8Array([167, 189, 170, 27, 74, 240, 201, 241]);\n        \n        // Chuẩn bị tên guardian\n        const guardianNameBuffer = Buffer.from(guardianName);\n        const guardianNameLenBuffer = Buffer.alloc(4);\n        guardianNameLenBuffer.writeUInt32LE(guardianNameBuffer.length, 0);\n        \n        // Đặt is_owner = false vì đây là guardian member, không phải owner\n        const isOwnerByte = new Uint8Array([1]); // false = 0\n        \n        // Cấu hình webauthn_pubkey là Some(webauthnPubkey)\n        const hasWebauthn = new Uint8Array([1]); // Some variant\n        \n        // Tạo dữ liệu instruction\n        const instructionData = concatUint8Arrays(\n          addGuardianDiscriminator,\n          guardianIdBytes,\n          bufferToUint8Array(guardianNameLenBuffer),\n          bufferToUint8Array(guardianNameBuffer),\n          recoveryHash,\n          isOwnerByte,\n          hasWebauthn,\n          bufferToUint8Array(webauthnPubkey)\n        );\n        \n        const addGuardianIx = new TransactionInstruction({\n          keys: [\n            { pubkey: multisigPubkey, isSigner: false, isWritable: true },\n            { pubkey: guardianPDA, isSigner: false, isWritable: true },\n            { pubkey: projectFeePayerKeypair.publicKey, isSigner: false, isWritable: false },\n            { pubkey: projectFeePayerKeypair.publicKey, isSigner: true, isWritable: true },\n            { pubkey: SystemProgram.programId, isSigner: false, isWritable: false }\n          ],\n          programId: PROGRAM_ID,\n          data: Buffer.from(instructionData)\n        });\n        \n        tx.add(addGuardianIx);\n        \n        // Gửi transaction\n        setTransactionStatus(prev => prev + '\\nĐang gửi transaction...');\n        const signature = await sendAndConfirmTransaction(\n          connection,\n          tx,\n          [projectFeePayerKeypair],\n          {\n            commitment: 'confirmed',\n            skipPreflight: true,\n          }\n        );\n        \n        // Xác nhận transaction đã thành công\n        setTransactionStatus(prev => prev + '\\nĐang xác nhận transaction...');\n        await connection.confirmTransaction(signature, 'confirmed');\n        \n        // Cập nhật trạng thái guardian\n        await updateGuardianStatus(inviteCode, 'completed', signature);\n        \n        // Thông báo kết quả\n        setTransactionStatus(`Guardian đã được thêm thành công vào blockchain!\n- Tên: ${guardianData.guardianName}\n- ID: ${guardianData.guardianId} \n- Địa chỉ: ${guardianPDA.toString()}\n- Signature: ${signature}\n\nGuardian đã sẵn sàng để sử dụng trong ví multisig của bạn.`);\n        \n        // Xóa dữ liệu guardian từ database sau khi hoàn tất\n        setTransactionStatus(prev => prev + '\\n\\nĐang xóa dữ liệu guardian từ database...');\n        console.log(`Bắt đầu xóa dữ liệu guardian với mã mời: ${inviteCode}`);\n        const deleteResult = await deleteGuardianData(inviteCode);\n        \n        if (deleteResult) {\n          console.log(`✅ ĐÃ XÓA THÀNH CÔNG dữ liệu guardian, invitation và lookup với mã mời: ${inviteCode}`);\n          \n          // Cập nhật thông báo thành công rõ ràng hơn\n          setTransactionStatus(`✅ HOÀN TẤT THÀNH CÔNG!\n          \n          Guardian \"${guardianData.guardianName}\" (ID: ${guardianData.guardianId}) đã được thêm thành công vào ví.\n          \n          Địa chỉ Guardian: ${guardianPDA.toString()}\n          Signature: ${signature}\n          \n          ✅ Dữ liệu đã được xóa khỏi database để bảo vệ quyền riêng tư.\n          \n          ✅ Guardian hiện đã sẵn sàng sử dụng và đã được ẩn khỏi danh sách chờ.`);\n          \n          // Bỏ mã mời đã sử dụng khỏi danh sách\n          setPendingInvites(prev => prev.filter(code => code !== inviteCode));\n          \n        } else {\n          console.error(`❌ KHÔNG THỂ XÓA dữ liệu guardian với mã mời: ${inviteCode}`);\n          setTransactionStatus(prev => prev + '\\n❌ Không thể xóa dữ liệu guardian từ database.');\n        }\n        \n        // Làm mới danh sách guardian và cập nhật UI\n        await getExistingGuardianIds();\n        await loadPendingInvites();\n        \n        // Cập nhật số dư của ví\n        if (multisigAddress) {\n          await loadPdaBalance(multisigAddress);\n        }\n      } else {\n        setTransactionStatus('Lỗi: Fee payer không khả dụng');\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi hoàn tất quá trình đăng ký guardian:\", error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      setTransactionStatus(`Lỗi khi hoàn tất quá trình đăng ký guardian: ${errorMessage}`);\n    }\n  };\n\n  return (\n    <div className=\"App\">\n      <header className=\"bg-blue-600 text-white p-4 mb-4\">\n        <h1 className=\"text-2xl font-bold\">Moon Wallet - Quản lý Ví Đa Chữ Ký</h1>\n      </header>\n      <div className=\"container mx-auto p-4 flex flex-col\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div className=\"p-4 bg-white rounded shadow\">\n            <h2 className=\"text-xl font-bold mb-4\">Quản lý Ví</h2>\n            \n            {/* Form để tạo ví mới */}\n            <div className=\"mb-4\">\n              <input\n                type=\"text\"\n                value={recoveryPhrase}\n                onChange={(e) => setRecoveryPhrase(e.target.value)}\n                placeholder=\"Recovery Phrase (tối thiểu 8 ký tự)\"\n                className=\"w-full p-2 border rounded mb-2\"\n              />\n            \n            </div>\n            \n            {/* Phần đăng nhập ví, hiển thị khi chưa tạo ví hoặc chưa đăng nhập */}\n            {!multisigAddress && (\n              <div className=\"login-section\">\n                <h2>Ví Moon Wallet</h2>\n                \n                <div className=\"wallet-actions\">\n                  <button \n                    onClick={loginToWallet}\n                    className=\"btn btn-primary\"\n                    disabled={isLoggingIn}\n                  >\n                    {isLoggingIn ? 'Đang đăng nhập...' : 'Đăng nhập bằng WebAuthn'}\n                  </button>\n                  \n                  \n                </div>\n              </div>\n            )}\n            \n            <div className=\"connection-info\">\n              <h2>Thông tin kết nối</h2>\n              <p>Đang kết nối tới: <strong>{RPC_ENDPOINT}</strong></p>\n              <p>Program ID: <strong>{PROGRAM_ID_STRING}</strong></p>\n              <p>Fee Payer: <strong>{projectFeePayerKeypair ? projectFeePayerKeypair.publicKey.toString() : 'Chưa khởi tạo'}</strong></p>\n              <p>Số dư Fee Payer: <strong>{isLoadingFeePayerBalance ? 'Đang tải...' : `${feePayerBalance} SOL`}</strong></p>\n              <div className=\"button-row\">\n                <button \n                  onClick={requestAirdrop}\n                  disabled={isLoadingFeePayerBalance}\n                >\n                  Airdrop 2 SOL cho Fee Payer\n                </button>\n              </div>\n              <div className=\"info-text\">\n                Fee payer của dự án cần có SOL để trả phí giao dịch. Nếu số dư = 0, vui lòng Airdrop trước khi tạo ví hoặc thêm guardian.\n              </div>\n            </div>\n            \n            <div className=\"wallet-info\">\n              <h2>Thông tin ví Moon Wallet</h2>\n              <p>Multisig PDA: {multisigAddress ? multisigAddress.toString() : 'Chưa tạo ví'}</p>\n              <p>Số dư Ví: <strong>{isLoadingPdaBalance ? 'Đang tải...' : `${pdaBalance} SOL`}</strong></p>\n              <p>Guardian PDA: {guardianPDA ? guardianPDA.toString() : 'Chưa có guardian'}</p>\n              <div className=\"button-row\">\n                <button onClick={getWalletInfo}>Xem thông tin ví</button>\n                <div className=\"guardian-selection\">\n                  <select \n                    value={selectedGuardianId} \n                    onChange={(e) => setSelectedGuardianId(parseInt(e.target.value))}\n                    style={{ margin: '0 10px', padding: '8px' }}\n                  >\n                    {existingGuardians.map(id => (\n                      <option key={id} value={id}>Guardian ID {id}</option>\n                    ))}\n                  </select>\n                  <button \n                    onClick={getGuardianInfo}\n                    disabled={!multisigAddress || existingGuardians.length === 0}\n                  >\n                    Xem thông tin guardian\n                  </button>\n                </div>\n                <button \n                  onClick={() => {\n                    if (multisigAddress) {\n                      loadPdaBalance(multisigAddress);\n                      getExistingGuardianIds();\n                    }\n                  }}\n                  disabled={isLoadingPdaBalance || !multisigAddress}\n                >\n                  Cập nhật dữ liệu\n                </button>\n              </div>\n              \n              {/* Thêm TransferForm khi đã đăng nhập vào ví */}\n              {multisigAddress && credentialId && selectedGuardianId && (\n                <div className=\"transfer-section mt-4\">\n                  <TransferForm \n                    walletAddress={multisigAddress.toString()}\n                    credentialId={credentialId}\n                    guardianId={selectedGuardianId}\n                    onTransferSuccess={() => {\n                      // Cập nhật số dư sau khi chuyển tiền thành công\n                      if (multisigAddress) {\n                        loadPdaBalance(multisigAddress);\n                      }\n                    }}\n                  />\n                </div>\n              )}\n            </div>\n            \n            <div className=\"create-wallet-section\">\n              <h2>Tạo ví Moon Wallet</h2>\n              \n              <p className=\"info-text\">Dự án sẽ trả phí giao dịch tạo ví. Bạn không cần có SOL.</p>\n              \n              <div className=\"input-group\">\n                <label>Tên ví: </label>\n                <input \n                  type=\"text\" \n                  value={walletName} \n                  onChange={(e) => setWalletName(e.target.value)} \n                  maxLength={32}\n                  placeholder=\"Nhập tên cho ví của bạn\"\n                />\n              </div>\n              \n              <div className=\"input-group\">\n                <label>Recovery Key: <span className=\"required\">*</span></label>\n                <input \n                  type=\"text\" \n                  value={recoveryPhrase} \n                  onChange={(e) => setRecoveryPhrase(e.target.value)} \n                  placeholder=\"Nhập recovery key (ít nhất 8 ký tự)\"\n                  style={{width: '300px'}}\n                  required\n                />\n                {recoveryPhrase && recoveryPhrase.length < 8 && (\n                  <p className=\"error-message\">Recovery key phải có ít nhất 8 ký tự</p>\n                )}\n              </div>\n              \n              <div className=\"input-group\">\n                <label>Threshold: </label>\n                <input \n                  type=\"number\" \n                  min=\"1\" \n                  max=\"8\" \n                  value={threshold} \n                  onChange={(e) => setThreshold(parseInt(e.target.value))} \n                />\n              </div>\n              \n              <div className=\"input-group\">\n                <label>Tên Guardian: </label>\n                <input \n                  type=\"text\" \n                  value={guardianName} \n                  onChange={(e) => setGuardianName(e.target.value)} \n                  maxLength={32}\n                  placeholder=\"Tên cho guardian đầu tiên (mặc định: Owner)\"\n                />\n              </div>\n              \n              <button \n                onClick={createWalletWithWebAuthn} \n                disabled={isLoadingBalance || !recoveryPhrase || recoveryPhrase.length < 8}\n                className=\"create-wallet-button\"\n              >\n                Tạo ví Moon Wallet\n              </button>\n              \n              {credentialId && (\n                <div className=\"credential-info\">\n                  <p>Credential ID: {credentialId.slice(0, 10)}...</p>\n                </div>\n              )}\n            </div>\n            \n            {/* Thêm phần UI cho việc thêm guardian mới */}\n            {multisigAddress && (\n              <div className=\"add-guardian-section\">\n                <h2>Quản lý Guardian</h2>\n                \n                <div className=\"existing-guardians\">\n                  <p><strong>Các Guardian hiện có:</strong></p>\n                  {existingGuardians.length > 0 ? (\n                    <ul className=\"guardian-list\">\n                      {existingGuardians.map(id => (\n                        <li key={id} className=\"guardian-item\">\n                          Guardian ID {id}\n                          {id === 1 && \" (Owner)\"}\n                        </li>\n                      ))}\n                    </ul>\n                  ) : (\n                    <p>Chưa có Guardian nào</p>\n                  )}\n                </div>\n\n                <div className=\"guardian-actions\">\n                  <button \n                    onClick={generateGuardianInvite}\n                    className=\"primary-button\"\n                  >\n                    Tạo lời mời Guardian mới\n                  </button>\n                  \n                  <button \n                    onClick={() => {\n                      setShowInviteInput(!showInviteInput);\n                      loadPendingInvites();\n                    }}\n                    className=\"toggle-button\"\n                  >\n                    {showInviteInput ? 'Ẩn form nhập mã mời' : 'Hoàn tất đăng ký Guardian'}\n                  </button>\n                  \n                  <button \n                    onClick={getExistingGuardianIds}\n                    className=\"update-button\"\n                  >\n                    Cập nhật danh sách guardian\n                  </button>\n                </div>\n                \n                {/* Form tạo mã mời */}\n                {showQRCode && inviteLink && (\n                  <div className=\"invite-container\">\n                    <h3>Link mời Guardian</h3>\n                    <div className=\"qr-code\">\n                      <QRCodeSVG \n                        value={inviteLink}\n                        size={200}\n                        level=\"H\"\n                        includeMargin={true}\n                      />\n                    </div>\n                    <div className=\"invite-info\">\n                      <p>Link mời: <a href={inviteLink} target=\"_blank\" rel=\"noopener noreferrer\">{inviteLink}</a></p>\n                      <p>Mã mời: <strong>{inviteCode}</strong></p>\n                      <p className=\"note\">Gửi link này cho người bạn muốn thêm làm guardian. Họ sẽ hoàn thành quá trình đăng ký và sau đó bạn có thể hoàn tất việc thêm guardian bằng mã mời.</p>\n                    </div>\n                    <button onClick={() => {\n                      setShowQRCode(false);\n                      setInviteLink('');\n                      setInviteCode('');\n                    }}>Đóng</button>\n                  </div>\n                )}\n                \n                {/* Form nhập mã mời đã đăng ký */}\n                {showInviteInput && (\n                  <div className=\"invite-input-container\">\n                    <h3>Hoàn tất đăng ký Guardian</h3>\n                    \n                    {pendingInvites.length > 0 ? (\n                      <div className=\"pending-invites\">\n                        <p>Các mã mời đang chờ xử lý:</p>\n                        <div className=\"invite-codes\">\n                          {pendingInvites.map(code => (\n                            <div key={code} className=\"invite-code-item\">\n                              <span className=\"code\">{code}</span>\n                              <button \n                                onClick={() => completeGuardianSetup(code)}\n                                className=\"complete-button\"\n                              >\n                                Hoàn tất\n                              </button>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    ) : (\n                      <p>Không có mã mời nào đang chờ xử lý.</p>\n                    )}\n                    \n                    <div className=\"manual-input\">\n                      <p>Hoặc nhập mã mời thủ công:</p>\n                      <input \n                        type=\"text\" \n                        placeholder=\"Nhập mã mời\" \n                        value={inviteCode}\n                        onChange={(e) => setInviteCode(e.target.value)}\n                        className=\"invite-input\"\n                      />\n                      <button \n                        onClick={() => inviteCode && completeGuardianSetup(inviteCode)}\n                        disabled={!inviteCode}\n                        className=\"complete-button\"\n                      >\n                        Hoàn tất đăng ký\n                      </button>\n                    </div>\n                  </div>\n                )}\n                \n                <div className=\"guardian-test-actions mt-3\" style={{ display: 'flex', gap: '10px', marginBottom: '15px' }}>\n                  <button onClick={() => testGuardianInfo(1)} className=\"btn btn-sm btn-info\">Kiểm tra Guardian 1</button>\n                  <button onClick={() => testGuardianInfo(2)} className=\"btn btn-sm btn-info\">Kiểm tra Guardian 2</button>\n                  <button onClick={() => testGuardianInfo(3)} className=\"btn btn-sm btn-info\">Kiểm tra Guardian 3</button>\n                </div>\n              </div>\n            )}\n            \n            {/* Chức năng nạp tiền vào ví multisig */}\n            <div className=\"card mb-3\">\n              <div className=\"card-header bg-primary text-white\">\n                <h5 className=\"mb-0\">Nạp tiền vào ví Multisig</h5>\n              </div>\n              <div className=\"card-body\">\n                <div className=\"form-group mb-3\">\n                  <label htmlFor=\"depositAmount\">Số lượng SOL:</label>\n                  <input\n                    type=\"number\"\n                    id=\"depositAmount\"\n                    className=\"form-control\"\n                    step=\"0.01\"\n                    min=\"0.01\"\n                    value={depositAmount}\n                    onChange={(e) => setDepositAmount(parseFloat(e.target.value))}\n                    placeholder=\"Nhập số lượng SOL\"\n                  />\n                </div>\n                <button \n                  className=\"btn btn-primary w-100\"\n                  onClick={depositToMultisig}\n                  disabled={!multisigAddress}\n                >\n                  Nạp tiền vào ví\n                </button>\n              </div>\n            </div>\n            \n            {transactionStatus && (\n              <div className=\"transaction-status\">\n                <h3>Trạng thái giao dịch</h3>\n                <p style={{whiteSpace: 'pre-line'}}>{transactionStatus}</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}